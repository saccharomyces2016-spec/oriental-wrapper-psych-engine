# P0-5 結案報告：通用玄學介面協議 (UMIP)

**Project Code:** XUANCE-P0-5  
**Status:** CANONIZED / REVISION-LOCKED (P0-5 Scope)  
**Date:** 2026-01-10  
**版本:** v1.0（統整 GPT + Gemini 版本）

---

## ⚠️ Governance Note（依據 P0-5 Task Packet v2.0）

**本文件在「P0-5 範圍內」視為當前可執行的決策定案**，作為工程實作與驗收的唯一規格依據。

**彈性空間聲明**：
- 本文件**不構成永久凍結**：允許後續版本（UMIP v2+）迭代
- 在 **P0-5 開發期間不得隨意變更**，以避免驗收爭議
- 若需重大調整，需先更新本文件並獲得批准

**追蹤性聲明**：
- 本結案報告對齊 `P0-5_TASK_PACKET.md` v2.0
- 與 P0-4.5 分流系統設計的變更關係已明確標註（見下文）
- 所有關鍵決策點皆有明確說明

---

## 一、決策總綱 (Executive Summary)

**P0-5 的最終產出不是單一 UI 原型，而是一套可跨 Facet 重用、可被工程驗收的「通用玄學介面協議」（Universal Metaphysical Interface Protocol, UMIP）。**

### 核心架構原則

UMIP 確立**「後端科學極大化、前端玄學極致化」**的二元架構：

- **內核（不可見）**：心理/行為科學結構、分流、計分、風險鏈、Golden Tests（皆屬內部）
- **外殼（可見）**：使用者只感知到「玄學系統」與「問卦儀式」，不得暴露心理學/現代科學語彙

### 核心決策變更（P0-5 Scope）

1. **去問卷化**：廢除量表/滑桿/表單式列表，改為「儀式性交互」與「單一物象選擇」
2. **儀式介面定案**：Stage 2 採用「萬象羅盤（Radial Compass）」作為具體實作形態
   - ⚠️ **重要變更聲明**：此為對 P0-4.5 設計的**有意識進化**
   - 原 P0-4.5：Stage 2 = 符號雲/物象群（Symbol Cloud），Stage 3 = 萬象羅盤（Phenomenon Compass）
   - P0-5 決策：將「萬象羅盤」提前至 Stage 2，作為物象選擇的具體實作形態（詳見第 4 章）
   - **彈性空間**：若後續版本驗證此變更不合適，可回調至 P0-4.5 設計
3. **隱喻解耦（Metaphor-Agnostic）**：UI 變成讀取 `theme_config` 的通用播放器；更換 Facet JSON 即可切換視覺宇宙
4. **L4 姿態化**：建議層從「待辦/解法」轉型為「姿態/儀式」，並受 R4 高風險模板強制覆蓋
5. **CN/EN 硬性要求提升**：CN/EN 即時切換列入 P0-5 MVP Gate 與驗收硬條件（對齊任務包 9.1）

---

## 二、絕對紅線與硬規則 (Iron Rules)

以下為 UI 開發與驗收的最高標準，任何違反皆視為 Bug。

### 2.1 互動紅線 (Interaction Red Lines)

- **一屏一問（One Screen, One Query）**：禁止捲動式長問卷；每題為獨立「叩問」畫面
- **禁止量化暗示**：UI 嚴禁出現 1–10、0%–100%、進度量表、Likert（同意/不同意）
- **具象化選項**：選項必須是「狀態/畫面/象」，不得引導使用者「評分自己」

### 2.2 數據遮罩紅線 (Data Masking)

- **黑箱原則**：前端 UI **永遠不可接收/不可顯示**任何未轉譯的內部心理量化資料（如 Severity、Attribution、Coping）
- **僅供顯影**：UI 只讀取 `compiled_facet.json` 的「對外封裝輸出」（如 `narrative_text`、`visual_assets`、`theme_config` 等）

### 2.3 安全與合規紅線 (Safety Protocols)

- **高風險強制覆蓋**：當回傳 `risk_level: HIGH` 時，UI 必須忽略動態 L4，**強制渲染** R4 指定的靜態安全模板（Template A/B）
  - CN：「宜暫停自判，轉向外部守護者。」
  - EN：「Seek an external keeper of balance.」
- **非指令化呈現**：禁止 checkbox、bullet points、To-Do 清單樣式；必須以卡片/籤詩/箴言呈現

---

## 三、通用玄學介面架構 (UMIP Architecture)

### 3.1 資料驅動視覺 (JSON-Driven Visuals)

UI 不得硬編碼任何單一隱喻（如農耕、倉廩）；必須讀取 Facet JSON 的 `theme_config` 以決定視覺皮層：

```json
"theme_config": {
  "metaphor_id": "agriculture_v1",
  "assets": {
    "background": "path/to/bg.jpg",
    "particles": "path/to/particles.json",
    "border": "path/to/border.svg"
  },
  "typography": {
    "primary_font": "calligraphy_font",
    "secondary_font": "serif_font",
    "color_palette": ["#2C1810", "#D4AF37", "#8B4513"]
  }
}
```

**結論**：更換 Facet JSON（或其 `theme_config`）＝可在不改前端程式碼情況下切換整體視覺宇宙。

### 3.2 Theme Config Fail-soft 原則（容錯機制）

- **缺值回退**：若 `theme_config` 缺失，UI 必須降級使用內建「中性玄學皮層（Neutral Ritual Skin）」
- **資產容錯**：任何視覺資產載入失敗不得阻斷流程，只能停用該效果
- **邏輯隔離**：`theme_config` 僅控制視覺皮層，嚴禁影響文案結構與敘事順序

---

## 四、四階段全像漏斗實作規格 (The 4-Stage Holographic Funnel)

依據任務包 v2.0 的收斂策略，P0-5 以「可運作、可測試」為主，允許 Stage 1 延後，但需保留可擴展接口。

### Stage 1：八卦定方位 (The Wheel)

- **P0-5 策略**：若資源允許則實作；否則可由 Stage 2 直接啟動（仍需預留接口）
- **UI**：八卦轉輪或星圖（占位即可）
- **彈性空間**：若時間不足，可簡化為「直接進入 Stage 2」的入口

### Stage 2：萬象定物象 (The Phenomenon Compass) — **P0-5 核心實作**

#### ⚠️ 重要變更聲明（相對於 P0-4.5 設計）

**原 P0-4.5 設計**：
- Stage 2：六親定物象（The Context Lock）— 符號雲/物象群（Symbol Cloud）
- Stage 3：萬象定歸因（The Attribution Matrix）— 萬象羅盤/星盤（Phenomenon Compass）

**P0-5 決策變更**：
- 將「萬象羅盤（Radial Compass）」提前至 Stage 2，作為「六親定物象」的具體 UI 實作形態
- **原因**：羅盤式界面更符合「儀式性交互」要求，避免列表/符號雲的「問卷感」
- **彈性空間**：若後續版本驗證此變更不合適，可回調至 P0-4.5 的「符號雲」設計

#### UI 實作規格

**定義**：Stage 2 在任務包中原描述為「六親定物象（選擇問題領域）」；UMIP 將其 UI 實作定案進化為「萬象羅盤」，並明確宣告**羅盤取代列表/符碼雲**，避免工程誤解。

**UI 結構**：放射狀羅盤／星盤介面（Radial Symbol Map）

**元素規格**：
- 盤面呈現 **20–30 個微縮符碼**（例：印、官、財、煞、馬、權、情、緣、傷、貴…）
- 符碼分布於**同心圓軌道**上（3–5 層軌道）
- 每個符碼可配置視覺樣式（圖示、顏色、動畫）

**操作邏輯**：
- **指令**：「凝視盤面，點擊此刻映入眼簾的 [N] 個徵兆。」（N 可設定為 2–3）
- **選取**：點擊後符碼點亮，並吸附/飛入中央太極區形成選集
- **確認**：選取完成後進入 Stage 3

**RWD 適配**：
- **桌面端**：完整羅盤顯示
- **手機端**：可撥動轉輪/旋盤模式取代縮小盤面
- **平板端**：適配中間尺寸

**禁止**：嚴禁矩形 Card Grid、List View、表單式清單、符號雲散佈（除非作為視覺效果，非互動主體）

### Stage 3：投射定歸因 (Projective Assessment)

- **UI**：投射卡片，一題一頁
- **互動**：直覺選擇（象/狀態），不得出現數值評分
- **與任務包對齊**：對應任務包「Stage 3：萬象定歸因（具體題目回答）」

### Stage 4：命盤綜合與斷語 (The Reading)

- **UI**：結果頁分層揭示 L1–L4（見第 5 章）
- **與任務包對齊**：對應任務包「Stage 4：命盤綜合與斷語（結果呈現）」

---

## 五、結果頁面呈現規格 (Results Presentation)

結果頁不是「報告」，而是「批命」。揭示節奏必須遵循 **L1 → L2 → L3 → L4** 順序。

### L1：天象／定調 (The Atmosphere)

- **UI**：全螢幕背景氛圍變化
- **文案要求**：設定氣象/格局/基調（例如：「此時天象為大旱，倉廩微裂...」）
- **多樣性要求**：同 Outcome Band 下至少 **3 組天象描述**，前端可隨機輪播
- **與任務包對齊**：對應任務包「L1（Opening）：開場語境，設定氣象/格局/基調」

### L2：物象／主敘事 (The Manifestation)

- **UI**：核心視覺焦點
- **文案要求**：核心狀態描述，使用**高銳利度名詞**（如裂痕、發霉、潰決），避免抽象形容詞
- **範例**：「溝渠淤積，水流不轉，倉門緊鎖...」
- **與任務包對齊**：對應任務包「L2（主敘事）：核心狀態描述，用具體名詞而非抽象形容詞」

### L3：干擾／盲點 (The Fog)

- **UI**：次級資訊層
- **互動要求**：必須由使用者**主動揭示**（點擊/長按/展開），隱喻「撥霧」
- **文案要求**：警示可能存在的誤判或干擾因素（例如：「熱浪虛景，山林迷霧遮眼，勿誤逐鬼火...」）
- **與任務包對齊**：對應任務包「L3（干擾/誤判）：警示可能存在的誤判或干擾因素」

### L4：姿態／儀式 (The Stance)

- **UI**：籤詩/錦囊式卡片
- **語氣限制**：只允許「宜… / 不宜… / 守… / 攻…」姿態語氣；不得呈現成待辦或命令
- **範例（正確）**：
  - 「宜止息播種，先護根，守中養根，避風保本。」
  - 「可嘗試疏通溝渠，但需注意天象變化，不宜強行開墾。」
- **範例（錯誤，需避免）**：
  - 「建議你立刻停止投資，尋求專業幫助。」
  - 「你應該辭職，換一個工作環境。」

#### 高風險鎖定（必做）

當 `risk_level: HIGH` 時鎖定 L4，顯示安全語句：

- **CN**：「宜暫停自判，轉向外部守護者。」
- **EN**：「Seek an external keeper of balance.」

**技術要求**：UI 必須能夠識別 `risk_level: HIGH`，並**強制覆寫**動態生成的 L4，使用 R4 指定的靜態安全模板（Template A/B）

**與任務包對齊**：對應任務包「高風險情況的特殊處理：當 R4 觸發高風險時，L4 必須強制使用固定模板（模板 A 或模板 B）」

---

## 六、P0-5 最小可交付合格線 (MVP Gate)

P0-5 被視為「完成」，必須同時滿足以下 **6 項**驗收標準（對齊任務包 v2.0 的 9.1「功能完整性最低要求」）。

### 驗收標準（硬性）

1. **資料串接**：UI 可正確載入並解析任一符合 Schema 的 `compiled_facet.json`
   - 支援 `income_expansion_pressure` 和 `relationship_imbalance`
   - 具備基本的容錯能力（fallback 值）

2. **CN/EN 雙語即時切換（硬性要求，對齊任務包 9.1）**：
   - 必須支援**即時切換**，不需重新載入頁面（no reload）
   - 所有文字（題目、結果、按鈕、UI 標籤）都需即時更新
   - **英文敘事需具原生語感**（不得逐字翻譯腔）
   - 數據結構中應包含 `zh` 和 `en` 欄位，UI 根據當前語言選擇對應欄位
   - **測試方法**：手動切換語言，驗證所有文本即時更新且無遺漏

3. **儀式介面（Stage 2 硬性）**：成功實作「萬象羅盤（Radial Compass）」並可完成選取流程
   - 至少支援 2–3 個符碼選取
   - 選取後符碼正確點亮並吸附至中央
   - 手機端旋盤適配基本可用

4. **結果呈現**：Stage 4 結果頁完整呈現 L1–L4；且所有開發用數據皆不可見（遵守遮罩紅線）
   - Severity、Attribution、Coping 等內部數值僅開發模式可見
   - 不得對外顯示任何未轉譯的內部數據

5. **風險覆蓋**：可人工模擬 `risk_level = HIGH`，並驗證 L4 會被安全模板強制覆寫
   - 高風險時 L4 必須顯示安全語句（CN/EN 對應版本）
   - 動態生成的 L4 必須被忽略

6. **視覺解耦**：不改前端程式碼情況下，僅修改 JSON `theme_config` 即可切換基本視覺元素（至少背景/字體/配色任一生效）
   - 證明 UI 框架具備隱喻解耦能力
   - 至少驗證一組完整的 `theme_config` 切換

### 不包含於 P0-5 合格線的項目

以下項目**不影響 P0-5 合格判定**，可延後至後續階段：

- ❌ 動畫細膩度優化
- ❌ 完整 Stage 1 八卦轉輪實作（若時間不足）
- ❌ 支付/帳號系統
- ❌ 跨 Facet 選擇 UI
- ❌ 使用者資訊收集的完整驗證（可先做基本表單）
- ❌ 豐富的視覺效果與動畫（基本動畫可保留）
- ❌ 結果分享功能

---

## 七、下一步行動 (Next Steps)

### 7.1 工程端 (Engineering)

- [ ] **建立 UMIP_Schema_v1.json**（含 `theme_config`、`i18n` 欄位與必要 fallback 約束）
- [ ] **開發 Stage 2「Radial Compass」元件**與手機端旋盤適配
- [ ] **實作 i18n 機制**：確保所有靜態/動態文本皆可 CN/EN 即時切換（不 reload）
- [ ] **實作高風險覆蓋機制**：驗證 `risk_level: HIGH` 時 L4 強制覆寫
- [ ] **實作 theme_config 讀取與容錯**：驗證視覺解耦能力

### 7.2 設計端 (Design)

- [ ] **產出「無隱喻線框圖（Metaphor-Free Wireframe）」**：證明 UI 可套用農耕/海洋/星際等不同皮層仍成立
- [ ] **製作 Stage 2 羅盤互動原型**：驗證放射狀布局與互動邏輯
- [ ] **執行英文排版溢出檢查（Overflow Check）**：確保 CN/EN 切換時無排版問題

### 7.3 內容端 (Content)

- [ ] **R2/R3 補齊 L1 天象文案池**（同 Band ≥3 組），並提供 CN/EN 對應版本
- [ ] **驗證 L4 姿態化語氣**：確保所有建議層文案符合「宜/不宜/守/攻」語感

---

## 八、附錄：與任務包 v2.0 的一致性聲明 (Traceability)

本 UMIP v1.0 結案稿與 `P0-5_TASK_PACKET.md` v2.0 的對齊關係如下：

### 8.1 功能完整性對齊

| 任務包要求（9.1） | UMIP 驗收標準 | 狀態 |
|------------------|--------------|------|
| 能夠讀取 compiled facet JSON | 驗收標準 #1 | ✅ 已對齊 |
| 能夠渲染題目並收集使用者回答 | Stage 3 規格 | ✅ 已對齊 |
| 能夠計算 score 並選擇對應的 outcome band | 數據處理邏輯（隱含） | ✅ 已對齊 |
| 能夠顯示結果頁面（包含 L1–L4 敘事、建議、風險鏈） | Stage 4 規格、第 5 章 | ✅ 已對齊 |
| **能夠支援 CN/EN 即時切換** | **驗收標準 #2（硬性要求）** | ✅ **已強化** |

### 8.2 關鍵決策點對齊

- **CN/EN 即時切換**：已上升至 **MVP Gate 硬性驗收條款**（對齊任務包 4.3、9.1）
- **Stage 2 UI 定義**：以「萬象羅盤」作為 Stage 2 的最終實作型態，取代任務包原描述的「列表/符碼雲語義」，避免工程誤解
  - ⚠️ **變更說明**：此為對 P0-4.5 設計的有意識進化，已在第 4 章明確說明
- **收斂策略**：符合任務包 v2.0「可運作、可測試、可持續調整」原則，允許延後非 MVP 項目，並保留接口

### 8.3 設計要求對齊

- **去問卷化**：符合任務包「題目必須像問卦而非測驗」要求
- **數據遮罩**：符合任務包「不會暴露內部結構」要求
- **高風險覆蓋**：符合任務包「高風險結果正確使用 R4 固定模板」要求
- **L4 姿態化**：符合任務包「L4 行動建議的姿態，而非具體決策指令」要求

---

## 九、彈性空間與回調機制 (Flexibility & Rollback)

### 9.1 明確的彈性空間

本結案報告在以下方面保留彈性空間，允許後續版本調整：

- **Stage 1 實作策略**：若時間不足，可簡化為「直接進入 Stage 2」的入口
- **Stage 2 UI 形態**：若後續版本驗證「萬象羅盤」不合適，可回調至 P0-4.5 的「符號雲」設計
- **視覺風格細節**：具體配色方案、字體選擇、動畫效果可在後續版本優化
- **技術實現方式**：前端框架選擇、數據綁定方式可在後續版本調整

### 9.2 回調機制

若需回調至 P0-4.5 設計，需：

1. **更新本文件**：明確標註回調原因與影響範圍
2. **更新任務包索引**：記錄版本變更歷史
3. **獲得批准**：重大回調需經過審核流程

### 9.3 版本迭代聲明

- **UMIP v1.0**：本版本（P0-5 範圍內定案）
- **UMIP v2.0+**：允許後續版本迭代，但需明確標註變更內容與原因

---

## 十、結案確認 (Closure Confirmation)

### 10.1 審核結論

**作為總工程師 + 總指揮，我已審核本結案報告，確認：**

- ✅ **符合任務包 v2.0 要求**：所有關鍵要求已對齊並強化（特別是 CN/EN 即時切換）
- ✅ **關鍵決策點明確**：Stage 2 UI 形態變更已明確說明，保留彈性空間
- ✅ **驗收標準清晰**：6 項 MVP Gate 標準具體可驗證
- ✅ **追蹤性完整**：與任務包的對齊關係已明確標註
- ✅ **彈性機制健全**：保留回調與迭代空間

### 10.2 結案宣告

**本文件已確認完畢，可寫入 Canon，並作為 P0-5 開發與驗收的唯一依據。**

**結案日期**：2026-01-10  
**結案版本**：UMIP v1.0  
**狀態**：CANONIZED / REVISION-LOCKED (P0-5 Scope)

---

**— 本結案報告遵循 `docs/governance/CURSOR_GPT_GEMINI_COLLABORATION_FRAMEWORK.md` 與 `docs/governance/CURSOR_FILE_PLACEMENT_RULE.md` 規範。**

