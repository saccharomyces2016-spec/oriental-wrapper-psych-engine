# P0-12 階段二-4 v3 版本追問包

**建立日期**：2026-01-12  
**追問對象**：P0-12 階段二-4 最終結案報告 v3（完整權威版）  
**追問原因**：部分內容不符合追問包要求，需要補充  
**文件狀態**：WORKING DOCUMENT（不鎖定，可回滾）

---

## 一、追問摘要

根據嚴格審核，v3 版本的部分內容符合要求，但以下關鍵部分需要補充：

1. ❌ **規則文件不完整**：僅有 4 個規則範例，需要完整的規則清單（至少 30-40 條規則）
2. ❌ **驗證機制缺少具體範例**：缺少驗證邏輯的詳細說明和驗證範例
3. ❌ **規則應用指南不完整**：僅有高層次步驟，缺少詳細說明和範例
4. ❌ **整合報告不完整**：僅有高層次說明，缺少提取過程、轉換記錄、驗證結果

---

## 二、符合要求的部分（可寫入文本）

以下部分已經通過審核，可以直接寫入文本：

1. ✅ **buildGuidance.js 決策邏輯分析（1.1-1.4）**：完整的決策邏輯分析
2. ✅ **guidancePrinciples 全量提取（2.1-2.3）**：完整的 40 條原則提取和映射

---

## 三、需要補充的部分（詳細要求）

### 3.1 完整的規則文件（核心要求）

#### 3.1.1 問題描述

v3 版本 3.1 節僅有 4 個規則範例（RISK_LOCK_001、THEME_PRIORITY_002、CHAIN_GATE_003、ACTION_LIMIT_004），但根據追問包要求，應該包含所有提取的規則的清單。

#### 3.1.2 需要補充的內容

**1. 完整的規則清單**

需要包含以下所有規則：

**從 buildGuidance.js 提取的決策規則**（至少 5-10 條）：
- Theme 優先規則
- Domain Fallback 規則
- Recommendations 生成規則（buildRecommendationsFromPrinciples、buildRecommendationsByTheme、pickRecommendationsFromDomain）
- Risk Chain 生成規則
- Warning 生成規則
- Age Band 選擇規則

**從 guidancePrinciples 提取的決策規則**（至少 10 條）：
- 每個 Mother Theme 對應的決策規則（10 個 Mother Theme）

**從 intervention_boundary_matrix 提取的規則**（至少 3 條）：
- Boundary 1（Low Band）規則
- Boundary 2（Mid Band）規則
- Boundary 3（High Band）規則

**從報告 1.1-1.3 節提到的規則**（至少 6 條）：
- L2/L3 敘事觸發規則（Low/Mid/High，3 條）
- L4 風險阻斷規則（Low/Mid/High，3 條）

**AI 約束規則**（至少 5 條）：
- NO RE-INTERPRETATION 規則
- IMMUTABLE RISK 規則
- NO HALLUCINATION 規則
- METAPHYSICAL PURITY 規則
- BILINGUAL ALIGNMENT 規則

**驗證規則**（至少 4 條）：
- Risk Consistency 規則
- Vocabulary Check 規則
- Action Integrity 規則
- Hexagram Fidelity 規則

**總計應該有至少 30-40 條規則**。

**2. 規則分類和組織**

需要按照以下方式分類和組織：
- 按照規則類型分類（決策規則、呈現規則、介入邊界規則、AI 約束規則、驗證規則等）
- 按照適用層級分類（L1、L2、L3、L4、Global）
- 按照風險等級分類（Low、Mid、High）

**3. 規則的適用條件和邏輯說明**

需要說明：
- 每個規則的觸發條件
- 每個規則的邏輯說明
- 每個規則的應用場景

#### 3.1.3 預期產出

1. **完整的規則文件**（JSON 格式）：
   - 包含所有提取的規則（至少 30-40 條）
   - 規則的結構定義
   - 規則的適用條件和邏輯說明
   - 規則分類和組織

2. **規則索引文件**（可選，Markdown）：
   - 規則的索引表
   - 規則的快速查找指南

---

### 3.2 驗證機制的詳細說明和範例（核心要求）

#### 3.2.1 問題描述

v3 版本 4.2 節僅有失敗處理表格，缺少驗證邏輯的詳細說明和驗證範例。

#### 3.2.2 需要補充的內容

**1. 每個驗證步驟的具體驗證邏輯**

需要詳細說明每個驗證步驟的具體驗證邏輯：

**Payload Schema 驗證**：
- 如何驗證？（驗證的方法）
- 驗證的標準是什麼？（Schema 定義、必需欄位、資料類型等）
- 驗證的工具是什麼？（JSON Schema 驗證器、自定義驗證函數等）

**Risk Level Lock 檢查**：
- 如何檢查？（檢查的方法）
- 檢查的標準是什麼？（Risk Level 是否與計算結果一致、是否被 AI 修改等）
- 檢查的工具是什麼？（比較函數、驗證函數等）

**Action Count 檢查**：
- 如何檢查？（檢查的方法）
- 檢查的標準和閾值是什麼？（Low ≤ 2、Mid ≤ 3、High ≤ 3 等）
- 檢查的工具是什麼？（計數函數、驗證函數等）

**Forbidden / Required Vocabulary 掃描**：
- 如何掃描？（掃描的方法）
- 掃描的標準是什麼？（禁用詞列表、必用詞列表等）
- 掃描的工具和方法是什麼？（字串匹配、正則表達式、詞彙庫比對等）

**Chain–Band 一致性檢查**：
- 如何檢查？（檢查的方法）
- 檢查的標準是什麼？（Low Risk 是否有 Chain、High Risk 是否有 Chain 等）
- 檢查的工具是什麼？（驗證函數等）

**2. 驗證範例**

需要提供驗證範例：

**通過的情況範例**：
- 完整的驗證過程（輸入、驗證步驟、輸出）
- 至少 1-2 個範例

**失敗的情況範例**：
- 完整的驗證過程和失敗原因（輸入、驗證步驟、失敗原因、失敗位置）
- 至少 2-3 個範例（不同類型的失敗）

**處理過程範例**：
- 如何處理失敗的情況（錯誤處理、重試邏輯、修正方法等）
- 至少 1-2 個範例

#### 3.2.3 預期產出

1. **驗證機制詳細說明文件**（Markdown）：
   - 每個驗證步驟的具體驗證邏輯說明
   - 驗證的標準和閾值
   - 驗證的方法和工具
   - 驗證範例（通過的情況、失敗的情況、處理過程）

---

### 3.3 規則應用指南的詳細說明和範例（核心要求）

#### 3.3.1 問題描述

v3 版本 5 節僅有 5 個高層次步驟，缺少詳細的應用場景說明、使用方法說明、規則應用範例、規則組合和衝突處理。

#### 3.3.2 需要補充的內容

**1. 規則的應用場景說明**

需要說明：
- 每個規則在什麼場景下使用（具體場景描述）
- 如何判斷規則的適用條件（判斷邏輯、判斷標準）
- 規則的觸發條件（觸發條件、觸發時機）

**2. 規則的使用方法說明**

需要說明：
- 如何使用規則（詳細步驟，不僅僅是高層次步驟）
- 規則的輸入輸出（輸入格式、輸出格式、輸入輸出範例）
- 規則的組合方式（如何組合多個規則、組合的邏輯、組合的優先級）
- 規則的優先級和衝突處理（優先級定義、衝突判斷、衝突處理方法）

**3. 規則應用範例**

需要提供規則應用範例：

**規則應用的範例**（不同場景）：
- 至少 2-3 個不同場景的範例（例如：Low Risk 場景、Mid Risk 場景、High Risk 場景）

**規則組合應用的範例**：
- 至少 1-2 個規則組合應用的範例（例如：多個規則同時應用的情況）

**規則衝突處理的範例**：
- 至少 1-2 個規則衝突處理的範例（例如：規則衝突的情況、如何處理衝突）

#### 3.3.3 預期產出

1. **規則應用指南詳細說明文件**（Markdown）：
   - 規則的應用場景說明
   - 規則的使用方法說明（詳細步驟）
   - 規則的輸入輸出說明
   - 規則的組合方式和優先級說明
   - 規則的衝突處理說明
   - 規則應用範例（不同場景、規則組合、規則衝突處理）

---

### 3.4 整合報告的詳細說明（核心要求）

#### 3.4.1 問題描述

v3 版本 6 節僅有 3 行高層次說明，缺少提取過程說明、規則轉換記錄（具體轉換過程和範例）、驗證結果。

#### 3.4.2 需要補充的內容

**1. 提取過程說明**

需要說明：
- 如何提取規則（提取的步驟，詳細步驟）
- 提取的工具和方法（使用的工具、方法、技術）
- 提取的難點和解決方案（遇到的困難、如何解決）

**2. 規則轉換記錄**

需要說明：
- 如何將 Legacy 規則轉換為 Stage 4 規則（具體轉換過程，詳細步驟）
- 轉換的邏輯是什麼（轉換的邏輯、轉換的原則）
- 轉換的範例（至少 2-3 個具體的轉換過程範例，包括：
  - Legacy 規則（原文）
  - Stage 4 規則（轉換後）
  - 轉換過程（如何轉換）
  - 轉換的決策和取捨（為什麼這樣轉換）
- 轉換過程中的決策和取捨（轉換的決策、取捨的原因）

**3. 驗證結果**

需要提供：
- 驗證結果（驗證的方法和結果，驗證的統計資料、驗證的通過率等）
- 驗證的範例（至少 1-2 個驗證的範例）
- 驗證中發現的問題和解決方案（發現的問題、如何解決）

#### 3.4.3 預期產出

1. **整合報告詳細說明文件**（Markdown）：
   - 提取過程說明（詳細步驟、工具和方法、難點和解決方案）
   - 規則轉換記錄（具體轉換過程、轉換邏輯、轉換範例、決策和取捨）
   - 驗證結果（驗證方法和結果、驗證範例、發現的問題和解決方案）

---

## 四、參考資料

### 4.1 追問包要求

- `P0-12_SCIENTIFIC_ENGINE_COMPLETION/P0-12_PHASE2-4_FOLLOWUP_WITH_BACKGROUND.md`

### 4.2 審核報告

- `P0-12_SCIENTIFIC_ENGINE_COMPLETION/P0-12_PHASE2-4_AUDIT_REPORT.md`
- `P0-12_SCIENTIFIC_ENGINE_COMPLETION/P0-12_PHASE2-4_V3_AUDIT_REPORT.md`

### 4.3 v3 版本報告

- P0-12 階段二-4 最終結案報告 v3（完整權威版）

---

## 五、重要提醒

1. **所有資料保持可回滾、不凍結**：所有補充的內容都標記為 WORKING DOCUMENT（不鎖定，可回滾）
2. **文本作為唯一依據**：所有補充的內容都記錄在文本中
3. **完整的背景資料**：本追問包已包含所有必要的背景資料和要求，顧問團隊無需訪問其他檔案即可完成補充

---

**文件狀態**：WORKING DOCUMENT（不鎖定，可回滾）  
**最後更新**：2026-01-12  
**追問狀態**：等待顧問團隊補充
