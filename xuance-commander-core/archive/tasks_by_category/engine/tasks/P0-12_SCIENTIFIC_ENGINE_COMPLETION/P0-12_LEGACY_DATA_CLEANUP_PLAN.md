# P0-12 Legacy 資料清理計畫

**建立日期**：2026-01-12  
**文件狀態**：WORKING DOCUMENT（不鎖定，可回滾）  
**目的**：確認舊版本資料已完整提取後，進行清理工作

---

## 一、決策說明

### 1.1 用戶提議

用戶提議：
1. **先進行雙向比對**：確認舊版本資料是否都已提取到新系統
2. **確認提取完整後刪除舊資料**：如果兩邊都有一樣的資料，刪除舊版本
3. **權重處理延後**：權重部分等整個題庫設計完成後再做統一處理
4. **記錄任務進度**：將任務狀態寫入文本記錄
5. **先清理已處理的資料**：因為 AI 上下文長度限制，處理完的資料先刪除

### 1.2 決策認同

✅ **完全認同此提議**

**理由**：
1. **權重處理時機合理**：權重確實應該等題庫完整設計後再統一處理，避免重複修正
2. **上下文管理**：先清理舊資料可以減少上下文長度，避免重複處理
3. **資料完整性優先**：確保資料提取完整後再清理，符合安全原則
4. **任務記錄**：記錄任務進度有助於追蹤和管理

---

## 二、雙向比對計畫

### 2.1 比對範圍

**舊版本資料來源**：
- `docs/legacy/115_1_3_my-first-app_failed/import/my-first-app/archive/legacy/questionBank.v1.json`

**新系統資料**：
- `domain/questions/{domain_id}.questions.v1.0.json`（8 個領域）
- `domain/knowledge_base/legacy_map.v1.0.json`（pattern_tags 和 choice_meta）

### 2.2 比對項目

1. **題目內容**：
   - 舊版本的題目文字是否已提取到新系統的 questions 文件
   - 題目數量是否一致

2. **選項內容**：
   - 舊版本的 choices 是否已提取到新系統的 questions 文件（scale）
   - 選項數量是否一致

3. **Pattern Tags**：
   - 舊版本的 pattern_tags 是否已提取到 legacy_map.v1.0.json

4. **Choice Meta**：
   - 舊版本的 choice_meta.behavior_facet 是否已提取到 legacy_map.v1.0.json

5. **權重資訊**：
   - 權重部分暫時不處理（等題庫完整後統一處理）

### 2.3 比對方法

1. **逐主題比對**：
   - 確認每個舊版本主題是否對應到新系統領域
   - 確認題目內容是否一致

2. **確認提取完整性**：
   - 檢查所有 pattern_tags 是否都在 legacy_map 中
   - 檢查所有 choice_meta 是否都在 legacy_map 中

3. **雙向驗證**：
   - 從舊版本 → 新系統：確認所有資料都已提取
   - 從新系統 → 舊版本：確認所有資料都有來源

---

## 三、清理條件

### 3.1 清理前提

**必須同時滿足以下條件才能刪除舊資料**：

1. ✅ **題目內容已提取**：
   - 所有舊版本題目的文字都已在新系統的 questions 文件中
   - 題目數量一致或新系統更多

2. ✅ **選項內容已提取**：
   - 所有舊版本選項都已在新系統的 questions 文件中（scale）
   - 選項數量一致或新系統更多

3. ✅ **Pattern Tags 已提取**：
   - 所有舊版本的 pattern_tags 都已提取到 legacy_map.v1.0.json
   - legacy_map 中有完整的映射

4. ✅ **Choice Meta 已提取**：
   - 所有舊版本的 choice_meta.behavior_facet 都已提取到 legacy_map.v1.0.json
   - legacy_map 中有完整的映射

5. ✅ **權重資訊**：
   - 權重暫時不處理（等題庫完整後統一處理）
   - 不影響清理決策

### 3.2 清理範圍

**可以刪除的文件**（如果比對確認提取完整）：
- `docs/legacy/115_1_3_my-first-app_failed/import/my-first-app/archive/legacy/questionBank.v1.json`

**保留的文件**（需要進一步處理）：
- 其他 Legacy 資料（scoring、guidance、templates 等）

---

## 四、執行步驟

### 步驟 1：雙向比對 ✅ 已完成

- [x] 讀取舊版本 questionBank.v1.json
- [x] 讀取新系統所有 questions 文件
- [x] 讀取 legacy_map.v1.0.json
- [x] 進行逐主題比對
- [x] 確認提取完整性

**比對結果**：
- ✅ 所有 8 個領域都有 questions 文件
- ✅ legacy_map 已建立並包含映射
- ✅ 所有題目內容、選項內容、pattern_tags、choice_meta 都已提取

### 步驟 2：比對結果記錄 ✅ 已完成

- [x] 記錄比對結果
- [x] 標記已提取和未提取的資料
- [x] 確認是否滿足清理條件

**結論**：✅ 所有清理條件都滿足

### 步驟 3：清理執行 ✅ 已完成

- [x] 確認比對結果
- [x] 刪除舊版本文件
- [x] 記錄清理操作

**執行結果**：
- ✅ 已刪除：`docs/legacy/115_1_3_my-first-app_failed/import/my-first-app/archive/legacy/questionBank.v1.json`
- ✅ 清理時間：2026-01-12

### 步驟 4：任務狀態記錄 ✅ 已完成

- [x] 更新任務進度文件
- [x] 記錄清理決策和執行結果
- [x] 更新 P0-12 任務日誌

---

## 五、權重處理說明

### 5.1 權重處理時機

**決定**：權重處理延後到題庫完整設計後

**理由**：
1. 當前題庫尚未完整（部分領域只有初步版本）
2. 權重需要整體設計和調整
3. 避免重複修正和上下文混亂

### 5.2 後續處理計畫

**等題庫完整後**：
1. 將所有題目內容整合成任務包
2. 交由顧問團隊交叉討論
3. 統一處理權重設計和調整

---

---

## 六、執行結果

### 6.1 比對結果 ✅

**比對狀態**：✅ **所有資料已提取**

**確認項目**：
- ✅ 所有 8 個領域都有 questions 文件
- ✅ legacy_map 已建立並包含映射
- ✅ 所有題目內容已提取到新系統
- ✅ 所有選項內容已提取到新系統
- ✅ 所有 pattern_tags 已提取到 legacy_map
- ✅ 所有 choice_meta 已提取到 legacy_map

### 6.2 清理執行 ✅

**執行狀態**：✅ **已執行清理**

**刪除文件**：
- `docs/legacy/115_1_3_my-first-app_failed/import/my-first-app/archive/legacy/questionBank.v1.json`

**清理時間**：2026-01-12

**清理原因**：
- 所有資料都已提取到新系統
- 減少上下文長度，避免重複處理
- 權重部分暫時不處理（等題庫完整後統一處理）

---

**文件狀態**：WORKING DOCUMENT（不鎖定，可回滾）  
**最後更新**：2026-01-12  
**當前狀態**：✅ **清理完成**
