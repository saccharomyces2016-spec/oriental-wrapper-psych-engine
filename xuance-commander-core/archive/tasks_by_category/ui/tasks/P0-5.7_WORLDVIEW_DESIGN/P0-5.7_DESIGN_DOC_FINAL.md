# P0-5.7 最小世界觀設計文檔 (Final Specification)

**文件編號**：P0-5.7_DESIGN_DOC_FINAL  
**建立日期**：2026-01-11  
**適用版本**：Stage 1–4 (MVP)  
**性質**：Design Specifications (Blocking for P0-5.6)  
**文件狀態**：已歸檔 (Archived for Implementation)  
**簽核**：Gemini (AI Thought Partner)

---

## 0. 結案摘要 (Executive Summary)

本文件定義系統在 Stage 1–4 的最小世界觀設計規格。設計核心在於解決「科學評估」與「玄學體驗」的共存矛盾，並規範 AI 在最終報告生成中的角色。

**核心交付目標**：
1.  **前端 (Client)**：使用者感知為「純粹的東方玄學儀式」，無心理學痕跡。
2.  **後端 (Server)**：執行「雙重計算」，以科學模型為驗證基準，玄學模型為演算表現。
3.  **AI 輸出 (Narrative)**：本機運算鎖定結果後，投遞給 AI 進行敘事擴寫，生成完整報告。
4.  **一致性 (Consistency)**：透過「受控隨機」與「單向資料流」，確保使用者看到的卦象、AI 寫出的報告，均精確對應其科學心理風險評估。

---

## 1. 設計核心哲學：虛實共構 (The Binary Reality)

### 1.1 核心命題：「儀式即計算」
所有互動操作（轉盤、羅盤、擲筊、展卷）在視覺上是「向天問卜」的儀式，但在數據層面上，這是使用者輸入特徵數據、系統進行即時運算與校準的過程。

### 1.2 視覺定調：「墨流運算 (Computational Ink)」
介面被定義為「宣紙」，互動回饋是「墨暈擴散」與「金石撞擊」。
* **關鍵詞**：沉穩 (Grounded)、流動 (Fluid)、神秘 (Arcane)、精確 (Precise)。
* **隱喻**：螢幕是載體，指尖是筆觸，數據的運算則是墨跡在紙纖維中的擴散與定型。

---

## 2. 核心機制：雙重計算與一致性 (Dual Calculation Canon)

本系統嚴格遵守「後端科學極大化，前端玄學極致化」原則。

### 2.1 雙引擎並行 (Dual Engines)
1.  **科學計算路徑 (Internal Validator)**：
    * 使用心理學量表與風險模型計算。
    * 產出：`Risk_Level`, `Score`, `Scientific_Advice`。
    * 地位：**絕對基準 (The Truth)**。
2.  **玄學計算路徑 (Presentation Layer)**：
    * 使用五行生剋與易經卦理進行推演。
    * 產出：`Hexagram_ID`, `Element_Tags`, `Metaphysical_Text`。
    * 地位：**表層呈現 (The Face)**。

### 2.2 一致性驗證邏輯 (Consistency Logic)
為了確保使用者不產生認知失調，系統執行以下邏輯：
1.  **計算**：科學引擎算出 `Risk: HIGH`。
2.  **篩選**：玄學引擎從 64 卦中，篩選出所有帶有「凶/悔/吝」屬性的卦象作為 `Candidate_Set`。
3.  **匹配**：玄學引擎根據使用者的 Stage 1-3 輸入（五行/方位），從 `Candidate_Set` 中挑選最符合的卦象。
4.  **鎖定**：將此結果（卦象 ID、變爻、風險等級）打包，作為不可變更的 Payload。

> **⚠️ 嚴格約束**：若玄學計算結果與科學結果衝突，**必須**調整玄學參數或重選卦象，**絕不可**修改科學評估結果。

---

## 3. 基礎視覺風格定義 (Visual Style Guide)

### 3.1 色彩系統 (Minimal Palette)
不使用宮廟色，採用「文人畫」與「金石學」色調。

* **基底 (Background)**：`Rice Paper White` (#F3F2EE)、`Ink Black` (#1A1A1A)。
* **能量/狀態 (Energy/State)**：`Cinnabar Red` (#B63728) 用於強調/火；`Bronze Gold` (#C5A065) 用於高亮/神聖。
* **輔助 (Auxiliary)**：`Jade Green` (#6A7F6E) 用於平衡；`Indigo Blue` (#3A4A5A) 用於深層資訊。

### 3.2 字體排印 (Typography)
* **儀式性文字**：**宋體/明體**（如：思源宋體、裝甲明朝）。
* **功能性文字**：**無襯線黑體**（如：Inter, Roboto, 思源黑體）。
* **排版原則**：**留白 (White Space)**，模仿傳統書畫布局。

### 3.3 介面材質 (Materiality)
* **容器**：使用「框線」、「印章」、「拓印」作為邊界，不使用 Card 陰影。
* **回饋**：點擊時產生「墨汁滲透」或「金石敲擊」的動態與音效。

---

## 4. Stage 1–4 互動方式定義 (Interaction Specs)

所有 Stage 均需支援 `theme_config` 換皮，以下定義其「預設玄學主題」的互動邏輯。

### Stage 1: 八卦定方位 (The Primordial Compass)
* **抽象元件**：`Selector_Radial`
* **UI 隱喻**：**先天八卦石盤**。
* **互動**：**Rotate (旋轉)** → **Snap (吸附)** → **Lock (鎖定)**。選中卦象發出金光，其餘沒入陰影。

### Stage 2: 五行定物象 (The Elemental Labyrinth)
* **抽象元件**：`Selector_Radial_Multiselect`
* **UI 隱喻**：**五行羅盤**。
* **互動**：**Beam (光束指針)** → **Select (多選)**。文字如活字印刷般凸起，選中元素間產生生剋連結線。

### Stage 3: 鑄爻定歸因 (Casting the Oracle)
* **抽象元件**：`Input_Charge_Release`
* **UI 隱喻**：**龜甲鑄爻**（或三枚銅錢）。
* **互動**：**Charge (蓄力)** → **Release (釋放)** → **Result (顯爻)**。
    * *Tech Note*: 蓄力動畫 `min_duration` 需設為 800ms+，以等待後端 API 計算結果。
    * *Render*: 銅錢落地正反面由後端決定，強制渲染為對應的陰/陽爻。

### Stage 4: 卦象顯影 (The Revelation)
* **抽象元件**：`Reveal_Scroll_Layered`
* **UI 隱喻**：**卷軸顯影**。
* **互動**：**Unroll (展開)** → **Development (顯影)**。左側 Root 與右側 Flow 墨跡交匯，暈染出最終建議。

---

## 5. AI 敘事生成層 (AI Narrative Layer)

本系統引入 AI 進行最終報告的生成，其運作必須遵守以下規範。

### 5.1 角色定位 (Role Definition)
* **AI 是敘事者 (Narrator)，不是運算者 (Calculator)。**
* AI 僅負責將本機引擎計算出的結構化數據，轉譯為具備文學性、同理心與玄學氛圍的自然語言報告。

### 5.2 資料流向 (Data Flow)
1.  **本機運算 (Local Calc)**：雙引擎完成計算，鎖定 `Risk_Level`, `Hexagram_ID`, `Changing_Line`, `Action_Points`。
2.  **Payload 建構**：系統將上述鎖定結果封裝為 JSON Context。
3.  **AI 生成 (Generation)**：將 JSON Context 傳送至 AI 模型（LLM），依據 Prompt 生成完整報告。
4.  **使用者呈現 (Presentation)**：前端顯示 AI 生成的文本。

### 5.3 嚴格約束 (Strict Constraints)

為了確保正確性與可審計性，AI 轉化版必須嚴格遵守以下規則：

#### 5.3.1 核心規則（必須遵守）

1. **禁止 AI 重新解卦**
   * ❌ AI 不得自行根據卦象 ID 進行網路搜索或自由聯想
   * ✅ AI 必須依據 Payload 中提供的 `Interpretation_Key` 進行擴寫
   * ✅ AI 必須使用 Payload 中的 `Hexagram_ID`、`Changing_Line` 等鎖定數據

2. **禁止 AI 修改風險等級**
   * ❌ 若本機判定為 HIGH Risk，AI 生成的語氣必須是警示性的，不得生成「其實沒關係」的安撫話語
   * ❌ AI 不得降低或提升本機計算的風險等級
   * ✅ AI 必須維持本機計算的風險等級，並以對應的語氣進行敘事

3. **禁止 AI 新增建議**
   * ❌ AI 僅能潤飾本機提供的 `Action_Points`，不得無中生有
   * ❌ AI 不得新增本機計算結果中不存在的建議或行動方案
   * ✅ AI 只能對本機提供的 `Action_Points` 進行文學性擴寫和潤飾

4. **必須遵守玄學語境規則**
   * ✅ AI 生成的文本必須保持「純玄學系統」的語境
   * ❌ 不得使用心理學名詞（如：焦慮、憂鬱、壓力等）
   * ❌ 不得暴露科學計算過程或現代科學背景
   * ❌ 不得說明「其實這是科學計算」
   * ✅ 必須使用易經、五行等玄學語彙進行敘事

5. **必須遵守雙語規則**
   * ✅ AI 生成必須支持 CN/EN 雙語
   * ✅ 中文版本必須像原生中文玄學系統，不得像翻譯
   * ✅ 英文版本必須像原生英文玄學產品，不得像翻譯
   * ✅ 必須根據 Payload 中的 `locale` 參數生成對應語言的文本

#### 5.3.2 提示詞規範 (Prompt Constraints)

AI 轉化版的 Prompt 必須包含以下要素：

1. **角色定義**：
   * AI 是「玄學敘事者」，不是運算者
   * AI 的任務是將結構化數據轉譯為玄學敘事

2. **數據約束**：
   * 必須明確告知 AI 只能使用 Payload 中的數據
   * 必須明確告知 AI 不得重新計算或修改風險等級

3. **語境約束**：
   * 必須明確告知 AI 保持「純玄學系統」語境
   * 必須明確列出禁用詞（心理學名詞、科學術語等）

4. **輸出格式**：
   * 必須明確定義輸出格式（L1-L4 分層結構）
   * 必須明確定義語言（CN/EN）

#### 5.3.3 驗證機制 (Validation Mechanism)

為確保 AI 轉化版的輸出符合規則，必須建立驗證機制：

1. **自動驗證**：
   * 檢查 AI 輸出是否包含禁用詞（心理學名詞、科學術語）
   * 檢查 AI 輸出是否與本機計算的風險等級一致
   * 檢查 AI 輸出是否使用了 Payload 中提供的數據

2. **人工審核**（必要時）：
   * 對於高風險案例，必須進行人工審核
   * 審核重點：風險等級一致性、語境正確性、建議有效性

---

## 6. 技術與實作約束 (Technical Constraints)

### 6.1 前端渲染 (Frontend)
* **動畫解耦**：所有動畫（轉盤、擲幣）必須與結果解耦。前端請求 API → 播放過場動畫 → 接收 API 結果 → 渲染對應的最終幀。
* **RWD**：Mobile First，圓形介面寬度佔螢幕寬度 90%-95%。

### 6.2 國際化 (i18n)
* **無文字圖檔**：所有介面上的文字必須是 Text Layer，支援 CN/EN 即時切換。
* **AI 多語系**：AI 生成層需在 Prompt 中指定輸出語言（`lang: "zh-TW"` 或 `lang: "en"`）。

### 6.3 配置化 (Configuration)
* **Theme Config**：所有顏色值、字體、背景紋理必須從 `theme_config` 讀取，不得硬編碼。

---

## 7. 驗收標準 (Acceptance Criteria)

1.  **儀式感驗收**：使用者操作過程流暢，動畫與音效配合精確，無「填寫表單」感。
2.  **一致性驗收**：
    * 後端回傳的 `Risk_Level` 與前端顯示的卦象吉凶屬性一致。
    * AI 生成的報告內容與本機計算的 `Risk_Level` 及建議方向一致（無幻覺）。
    * AI 生成的文本不包含心理學名詞或科學術語。
    * AI 生成的文本保持「純玄學系統」語境。
3.  **RWD 驗收**：在手機與桌機瀏覽器上，Stage 1-4 均可正常操作且無跑版。
4.  **AI 轉化版驗收**：
    * AI 輸出必須與本機計算結果一致（風險等級、建議方向）。
    * AI 輸出必須遵守玄學語境規則（無心理學名詞、無科學術語）。
    * AI 輸出必須支持 CN/EN 雙語，且像原生語言。

---

**文件狀態**：FINAL / ARCHIVED FOR IMPLEMENTATION  
**下一步**：根據本設計文檔進行 P0-5.6 功能實作
