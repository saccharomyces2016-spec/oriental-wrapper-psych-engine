# FOLDER_STRUCTURE_HEALTH_ANALYSIS（資料夾結構健康度分析）

## 狀態
- ACTIVE
- EDITABLE
- 建立日期：2026-01-09

---

## 目的
分析當前資料夾結構的健康度，評估是否有分錯的風險，並提供改進建議。

---

## 當前資料夾結構分析

### 主要資料夾層級（第一層）
1. **`docs/`**：文檔層（治理、領域、顧問、運營）
2. **`domain/`**：領域數據層（JSON 數據文件）
3. **`memory/`**：記憶層（狀態、索引、變更記錄）
4. **`tmp/`**：臨時文件層
5. **`out/`**：輸出文件層
6. **`logs/`**：日誌文件層
7. **`P0-X/`**：階段文件層（P0-3, P0-4, P0-5...）
8. **`tools/`**：工具腳本層
9. **`build/`**：構建腳本層
10. **`engine/`**：引擎代碼層
11. **`tests/`**：測試文件層
12. **`schemas/`**：Schema 定義層
13. **`charter/`**：憲章層
14. **`roadmap/`**：路線圖層
15. **`codex/`**：Codex 指令包層
16. **`prompts/`**：提示模板層
17. **`prototype/`**：原型代碼層
18. **`rules/`**：規則文件層
19. **`ideas/`**：想法收件箱層

### 資料夾分類邏輯

#### 按功能分類（Function-based）
- **治理相關**：`docs/governance/`
- **領域相關**：`docs/domain/`, `domain/`
- **顧問相關**：`docs/gem/`
- **任務相關**：`docs/ops/`
- **記憶相關**：`memory/`

#### 按生命週期分類（Lifecycle-based）
- **臨時文件**：`tmp/`
- **輸出文件**：`out/`
- **日誌文件**：`logs/`

#### 按階段分類（Phase-based）
- **階段文件**：`P0-X/`

---

## 健康度評估

### ✅ 優點

1. **清晰的職責分離**
   - 治理、領域、顧問、任務記錄都有明確的資料夾
   - 臨時、輸出、日誌文件分離清楚

2. **符合 Canon Path 原則**
   - 所有文件都在 `xuance-commander-core/` 下
   - 有明確的 Canon Path 定義

3. **可追溯性**
   - 文件位置與功能對應明確
   - 有完整的索引和路由機制

### ⚠️ 潛在風險

1. **資料夾數量較多（約 19 個主要資料夾）**
   - **風險**：可能導致文件分類困難，容易分錯
   - **緩解**：有 `FILE_ORGANIZATION_GUIDE.md` 提供明確指引

2. **部分資料夾功能可能重疊**
   - **風險**：某些文件可能同時符合多個資料夾的功能
   - **範例**：
     - `docs/domain/design/` vs `docs/domain/advisory/` vs `P0-X/`
     - `docs/governance/` vs `docs/domain/GOVERNANCE_RULES.md`
   - **緩解**：有明確的 Canon Path 規則和 SSOT 原則

3. **階段文件與領域文件可能重疊**
   - **風險**：P0-X 階段文件可能與 `docs/domain/` 內容重疊
   - **範例**：`P0-3/P0-3_CHARTER.md` vs `docs/domain/P0-3_SNAPSHOT_EXTRACT.md`
   - **緩解**：階段文件用於階段管理，領域文件用於領域規格

---

## 分錯風險評估

### 高風險區域

1. **領域文件 vs 階段文件**
   - **風險**：不清楚應該寫入 `docs/domain/` 還是 `P0-X/`
   - **判斷標準**：
     - 階段管理相關 → `P0-X/`
     - 領域規格相關 → `docs/domain/`
   - **建議**：在任務包中明確說明文件應該寫入的位置

2. **治理文件 vs 領域治理文件**
   - **風險**：不清楚應該寫入 `docs/governance/` 還是 `docs/domain/GOVERNANCE_RULES.md`
   - **判斷標準**：
     - 通用治理規則 → `docs/governance/`
     - 領域特定治理規則 → `docs/domain/GOVERNANCE_RULES.md`
   - **建議**：明確區分通用規則和領域規則

3. **顧問輸出 vs 領域規格**
   - **風險**：不清楚應該寫入 `docs/gem/runs/` 還是 `docs/domain/advisory/`
   - **判斷標準**：
     - 顧問原始輸出 → `docs/gem/runs/`
     - 採納後的領域規格 → `docs/domain/advisory/`
   - **建議**：明確區分「顧問輸出」和「採納後的規格」

### 中風險區域

1. **臨時文件 vs 輸出文件**
   - **風險**：不清楚應該寫入 `tmp/` 還是 `out/`
   - **判斷標準**：
     - 臨時審計、檢查 → `tmp/`
     - 工具生成的輸出 → `out/`
   - **建議**：明確區分「臨時」和「輸出」

---

## 改進建議

### 1. 建立文件分類決策樹（File Classification Decision Tree）

**決策流程**：
```
1. 是治理規則嗎？
   → 是 → docs/governance/
   → 否 → 繼續

2. 是領域規格嗎？
   → 是 → docs/domain/ 或 domain/
   → 否 → 繼續

3. 是顧問輸出嗎？
   → 是 → docs/gem/runs/
   → 否 → 繼續

4. 是階段管理文件嗎？
   → 是 → P0-X/
   → 否 → 繼續

5. 是臨時文件嗎？
   → 是 → tmp/
   → 否 → 繼續

6. 是工具輸出嗎？
   → 是 → out/
   → 否 → 繼續

7. 其他 → 需要明確分類
```

### 2. 強化文件寫入前檢查

**檢查清單**：
- [ ] 文件性質是否明確？
- [ ] 目標資料夾是否符合 Canon Path？
- [ ] 是否有重複或衝突的文件？
- [ ] 是否需要登記（見 `ARTIFACT_REGISTRY_RULE.md`）？

### 3. 建立文件分類驗證機制

**驗證方法**：
- 健康檢查腳本檢查文件位置是否符合規則
- 定期審計文件分類是否正確
- 發現分錯時立即修正

---

## 健康度結論

### 整體評估：✅ 健康，但有改進空間

**優點**：
- ✅ 資料夾結構清晰，職責分離明確
- ✅ 有完整的 Canon Path 規則
- ✅ 有文件組織指南

**改進空間**：
- ⚠️ 資料夾數量較多，需要更明確的分類決策樹
- ⚠️ 部分區域有重疊風險，需要更明確的判斷標準
- ⚠️ 需要強化文件寫入前檢查機制

**建議**：
- ✅ 建立文件分類決策樹（見上方）
- ✅ 在任務包中明確說明文件應該寫入的位置
- ✅ 強化健康檢查腳本，檢查文件分類是否正確

---

## 狀態
- ACTIVE
- EDITABLE
- 必須納入健康檢查流程



