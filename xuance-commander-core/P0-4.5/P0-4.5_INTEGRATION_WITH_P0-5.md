# P0-4.5 與 P0-5 的整合說明

## 狀態
- ACTIVE
- EDITABLE
- 建立日期：2026-01-10

---

## 整合策略

### 為什麼 P0-5 可以先完成，不需要等待 P0-4.5 的實作？

1. **P0-5 的目標**：
   - P0-5 是「最小 UI 串接」，主要是顯示已有的 compiled facet 內容
   - P0-5 的 Layer 3（Question Walk）是顯示 Facet 的題目，這些題目在 P0-2 已經設計完成
   - P0-5 的 Layer 5（Narrative Stage）是顯示結果，這些結果在 P0-3 和 P0-4 已經設計完成

2. **P0-4.5 的定位**：
   - P0-4.5 設計的是「前置分流系統」（Stage 1-4）
   - Stage 1-4 的目的是幫助使用者從「模糊困擾」收斂到「單一 Facet」
   - Stage 4 完成後，才進入 Facet 的題目問答（這部分 P0-5 已經設計）

3. **架構設計支持**：
   - P0-5 的 Layer 2（Facet Gate）目前設計為直接選擇 Facet（卡片式）
   - P0-5 的架構已經考慮了可擴充性（見 `P0-5_QUESTION_MODALITY_EXTENSIBILITY.md`）
   - P0-4.5 的 Stage 1-4 可以在 P0-5 之後，作為 Layer 2 的擴充實作

---

## 整合方案

### 方案 A：P0-5 先做基礎實作，P0-4.5 後續擴充（推薦）

**P0-5 階段**：
- Layer 2：直接實作簡單的 Facet 選擇（卡片式，選擇 `income_expansion_pressure` 或 `relationship_imbalance`）
- Layer 3-5：正常實作（題目問答、結果顯示）

**P0-5 之後**：
- 將 P0-4.5 的 Stage 1-4 作為 Layer 2 的擴充
- Stage 1-4 完成後，路由到對應的 Facet
- 然後進入 Layer 3-5（題目問答、結果顯示）

**優點**：
- ✅ P0-5 可以立即開始，不依賴 P0-4.5 的實作
- ✅ P0-5 先驗證基礎流程（Facet 題目問答 → 結果顯示）是否可運作
- ✅ P0-4.5 的分流系統可以基於 P0-5 的實際體驗進行調整
- ✅ 架構設計已經支持這種擴充方式

### 方案 B：P0-5 同時實作 P0-4.5（不推薦）

**問題**：
- ⚠️ 增加 P0-5 的複雜度和時間
- ⚠️ P0-4.5 的設計可能需要根據實際需求調整
- ⚠️ 可能會影響 P0-5 的 MVP 目標（驗證端到端流程）

---

## 數據流整合

### 當前 P0-5 的數據流（簡化版）
```
使用者選擇 Facet (Layer 2)
        ↓
Facet 題目問答 (Layer 3)
        ↓
結果顯示 (Layer 5)
```

### 整合 P0-4.5 後的數據流（完整版）
```
Stage 1: 八卦定方位 (Layer 2 擴充)
        ↓
Stage 2: 六親定物象 (Layer 2 擴充)
        ↓
Stage 3: 萬象定歸因 (Layer 2 擴充)
        ↓
Stage 4: 命盤綜合與斷語 → 路由到 Facet (Layer 2 擴充)
        ↓
Facet 題目問答 (Layer 3)
        ↓
結果顯示 (Layer 5)
```

---

## 實作建議

### P0-5 階段（當前）
1. **Layer 2 先做簡單版本**：
   - 卡片式選擇 `income_expansion_pressure` 或 `relationship_imbalance`
   - 保持架構可擴充性（預留接口，支持未來接入 Stage 1-4）

2. **Layer 3-5 正常實作**：
   - Layer 3：題目問答（使用 P0-2 設計的題目）
   - Layer 5：結果顯示（使用 P0-3 和 P0-4 設計的結果）

3. **驗證端到端流程**：
   - 確保從 Facet 選擇 → 題目問答 → 結果顯示的完整流程可運作

### P0-5 之後（擴充階段）
1. **將 P0-4.5 的 Stage 1-4 接入 Layer 2**：
   - Stage 1：八卦轉輪/八門卡片界面
   - Stage 2：符號雲/物象群界面
   - Stage 3：萬象羅盤/星盤界面
   - Stage 4：綜合斷語生成與路由邏輯

2. **保持向後兼容**：
   - 如果使用者跳過 Stage 1-4，可以直接選擇 Facet（保留 P0-5 的簡單版本作為備選）

---

## 狀態
- ACTIVE
- EDITABLE
- 建議採用方案 A：P0-5 先做基礎實作，P0-4.5 後續擴充



