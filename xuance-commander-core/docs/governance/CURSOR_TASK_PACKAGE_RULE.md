# CURSOR_TASK_PACKAGE_RULE（總指揮任務包規則）

## 相關規範文件

### 文件放置規範（必引用）
- **`CURSOR_FILE_PLACEMENT_RULE.md`**：Cursor 文件放置規則（每次任務前必引用）
  - 任務包位置規範：階段任務包應放在 `P<階段編號>/P<階段編號>_TASK_PACKET.md`
  - 顧問任務包位置：`docs/gem/briefs/TASK_PACKAGE_<Phase>_<Task>.md`
  - 顧問輸出位置：`docs/gem/runs/RUN_<Phase>_<Task>_<Role>_<Date>.md`

### 任務包模板
- **`codex/templates/TASK_PACKET_TEMPLATE.md`**：任務包模板（自動包含文件放置規範引用）

### 其他相關規範
- `AI_ROLES_CURSOR_ARCHITECTURE.md`：AI 角色架構（Cursor 架構版本）
- `CURSOR_FILE_PLACEMENT_RULE.md`：文件寫入位置規則（硬規則）
- `COMPLETE_TASK_PACKAGE_RULE.md`：完整任務包規則（已整合到本文件）

---

## 狀態
- ACTIVE（自 2026-01-10 起生效）
- EDITABLE
- NOT FROZEN（可隨時修正）

---

## 目的
定義總指揮（Cursor）如何產出任務包，以及任務執行者（GPT/GEM/GEMINI）如何執行任務包。

---

## 核心原則

### 任務包模式（Task Package Pattern）
- **總指揮（Cursor）**：產出任務包，包含完成任務所需的所有信息
- **任務執行者（GPT/GEM/GEMINI）**：執行任務包，產出內容（設計、規格、技術方案等）
- **總指揮（Cursor）**：接收輸出，審核並將資料寫入正確位置、分類管理

### 新架構（2026-01-10 更新）
- ✅ **Cursor 作為總指揮和總工程師**，擁有完整代碼庫可見性和決策權
- ✅ **GPT/GEM/GEMINI 作為單純任務執行者**，負責執行任務包
- ✅ **不再使用快照系統**，Cursor 直接讀取文件，任務包中包含所有必要的背景資料
- ✅ **純粹以任務包處理任務**的工作模式

---

## 任務包格式（必備項目）

每個任務包必須包含以下項目：

### 1. 任務目標（Task Goal）
- **一句話目標**：清楚說明任務要達成什麼
- **預期成果**：完成後應該產出什麼

### 2. 專案歷史摘要（Project History Summary）【必須包含｜2026-01-10 更新】

**目的**：讓任務執行者理解整體脈絡，避免重複走老路。

**必須包含**：
- 最近完成的任務（最近 3-5 個，每項 1-3 行摘要）
- 關鍵決策點（為什麼做這個決定）
- 項目整體狀態（當前階段、整體完成度、階段性目標、整體決策脈絡）
- 未來規劃摘要（短期任務清單、階段性規劃、決策點）
- 哪些方向已被否定或暫停（避免重複走老路）
**目的**：讓副指揮官和顧問師了解過去執行歷史、專案整體狀態、未來規劃，達到95%以上的資訊充足性。

#### 2.1 過去執行歷史（Past Execution History）
- **最近完成的任務**（最近 3-5 個）：
  - 任務名稱、完成狀態、關鍵成果、關鍵決策
  - 詳細記錄路徑引用（`docs/ops/TASK_RECORDS_INDEX.md`）
- **關鍵決策點**：
  - 為什麼做這個決定、基於什麼背景
  - 相關 ADR 或決策文件路徑
- **失敗經驗**（如果有）：
  - 過去遇到的問題、如何解決、學到的教訓

#### 2.2 專案整體狀態（Overall Project Status）
- **整體進度**：當前階段、整體完成度（參考 `roadmap/ROADMAP.md`）
- **階段性目標**：當前階段的目標、已完成、待完成（參考 `docs/ops/TASK_RECORDS_SUMMARY.md`）
- **整體決策脈絡**：為什麼現在要執行這個任務、與整體目標（`FULL/NORTH_STAR.md`）的關係
- **風險與挑戰**：整體項目面臨的風險、已知挑戰

#### 2.3 未來規劃摘要（Future Planning Summary）
- **短期任務清單**（接下來 1-2 週）：
  - 任務名稱、優先級（P0/P1/P2/P3）、預計時程
- **階段性規劃**：
  - 當前階段 → 下一個階段 → 目標
- **決策點**：
  - 哪些決策點需要特別注意、預計決策時間

### 3. 背景資料（Background）【擴充】
- **相關文件**：任務相關的文件路徑和內容摘要
- **現狀分析**（擴充）：
  - 當前狀態
  - 已完成項目（包含關鍵成果）
  - 待完成項目
  - 阻塞點（如果有阻塞，說明原因和影響）
- **相關任務**（擴充）：
  - 上游任務：哪些任務的完成導致這個任務
  - 下游任務：這個任務的完成會影響哪些任務
  - 並行任務：同時進行的相關任務

### 4. 任務內容（Task Content）
- **具體步驟**：需要執行的具體步驟
- **交付物**：需要產出的交付物清單
- **驗收標準**：如何判斷任務完成

### 5. 約束條件（Constraints）【必須包含歷史失敗警告】
- **硬性限制**：不可違反的規則
- **參考規範**：需要遵守的規範文件
- **禁區**：不可觸碰的領域
- **⚠️ 歷史失敗警告**（必須包含）：
  - **失敗模式 A：不使用文本記錄**（見 `docs/governance/LEGACY_REFERENCE_STRATEGY.md`）
    - 所有決策和產出都必須立即寫入文本，不得只存在對話中
    - 所有顧問輸出必須立即寫入 `docs/gem/runs/`
    - 所有決策必須立即寫入對應的 domain 文件或 ADR
  - **失敗模式 B：把決定權責都交給 AI**（見 `docs/governance/LEGACY_REFERENCE_STRATEGY.md`）
    - 使用者擁有最高主權，AI 不得自行訂死不可變的規則
    - 所有規則必須服務於終極目標（NORTH_STAR），若發現不一致，必須立即提出並修正
    - 規則/架構變更走 ADR + 使用者批准

### 6. 資源需求（Resources）
- **需要哪些顧問師**：R1/R2/R3/R4/R5 等
- **需要哪些文件**：參考文件清單
- **需要哪些工具**：使用的工具或腳本

### 7. 優先級與時程（Priority & Timeline）
- **優先級**：P0/P1/P2/P3
- **預計時程**：預計完成時間
- **依賴關係**：依賴哪些其他任務

---

## 任務包執行流程

### 階段 1：總指揮產出任務包
1. **分析當前狀態**：
   - 讀取相關文件
   - 分析當前進度
   - 識別待完成項目

2. **產出任務包**：
   - 根據最終目標決定任務優先級
   - 產出包含所有必要信息的任務包
   - 將任務包提供給副指揮官或顧問師

### 階段 2：副指揮官或顧問師執行任務
1. **接收任務包**：
   - 閱讀任務包內容
   - 確認理解任務要求
   - 如有疑問，提出問題

2. **執行任務**：
   - 根據任務包執行任務
   - 產出交付物
   - 提供專業意見和建議

3. **交付成果**：
   - 將輸出交付給總指揮
   - 說明產出內容和使用方式

### 階段 3：總指揮整合與管理
1. **接收輸出**：
   - 檢查交付物完整性
   - 驗證是否符合驗收標準

2. **寫入文本**：
   - 將資料寫入正確的 Canon 路徑
   - 做好分類和管理
   - 更新任務狀態

3. **更新進度**：
   - 更新任務記錄
   - 評估完成度
   - 決定下一步任務

---

## 副指揮官的職責

### 核心職責
1. **執行任務包**：
   - 根據任務包執行任務
   - 產出符合要求的交付物

2. **提供專業意見**：
   - 基於專業認知提出建議
   - 可以提出需要哪些顧問師支援
   - 可以提出需要討論的事項

3. **審核顧問輸出**：
   - 審核顧問師的產出
   - 提供採納/拒絕/修改的建議

### 可以主動提出的請求
1. **需要哪些顧問師支援**：
   - 根據任務性質提出需要 R1/R2/R4 等顧問師
   - 說明需要顧問師提供什麼內容

2. **需要哪些文件或資料**：
   - 如果任務包中缺少必要信息，可以提出
   - 總指揮會補充相關文件

3. **需要討論的事項**：
   - 對於不確定的部分，可以提出討論
   - 總指揮會提供指導或採納建議

---

## 顧問師的職責

### 核心職責
1. **根據任務包產出內容**：
   - R1：題目設計
   - R2：敘事文案、隱喻設計
   - R4：安全稽核、風險控制

2. **遵守約束條件**：
   - 遵守硬性限制
   - 遵守參考規範
   - 不觸碰禁區

3. **產出可追溯的輸出**：
   - 所有輸出必須存檔（`docs/gem/runs/`）
   - 可追溯、可審核

---

## 總指揮的職責（Cursor）

### 核心職責
1. **掌控總進度**：
   - 以最終目標為最上層概念
   - 任何任務都不違背最終目標的達成
   - 決定接下來該做什麼

2. **決定任務優先級**：
   - 決定階段性目標
   - 決定臨時性目標
   - 根據資料完善程度結合最終目標指引前進

3. **產出任務包**：
   - 產出最完整、最詳細的任務包
   - 包含所有必要的背景資料
   - 分派給對應的角色（副指揮官或顧問師）

4. **整合與管理**：
   - 接收副指揮官和顧問師的輸出
   - 將資料寫入正確位置
   - 做好分類和管理

5. **主動檢查**：
   - 主動檢查文件結構
   - 驗證規範遵守
   - 做健康檢查

### 可以主動提出的內容
1. **提議和想法**：
   - 總指揮依然有提議的權利
   - 可以提出自己的想法和建議

2. **需要討論的事項**：
   - 對於不確定的部分，可以提出討論
   - 副指揮官可以提出建議
   - 總指揮可以採納並執行

---

## 任務包範例

```markdown
# 任務包：P0-4 Facet Portability - R2 主隱喻設計

## 任務目標
為 `relationship_imbalance` facet 設計主隱喻（1 個）和次隱喻白名單（可機器檢查），驗證 P0-3 的引擎結構可以搬移到新的 facet。

## 專案歷史摘要

### 過去執行歷史
- **最近完成的任務**：
  - **P0-3 Narrative Sharpness**（✅ READY_FOR_FREEZE）：
    - 關鍵成果：R1 敘事銳利度指標、R2 L1-L4 敘事骨架、R4 安全稽核清單
    - 關鍵決策：採用「歲時農耕・倉廩觀」作為主隱喻、建立次隱喻白名單和機器化檢查規則
    - 詳細記錄：`docs/ops/TASK_RECORDS_SUMMARY.md`、`P0-3/P0-3_COMPLETE_STATUS.md`
  - **P0-2 Output Contract**（✅ COMPLETED）：
    - 關鍵成果：引擎只判斷「狀態」，不判斷「人生」
    - 詳細記錄：`docs/ops/TASK_RECORDS_INDEX.md`
- **關鍵決策點**：
  - P0-3 明確排除 R3 和 R5（具體行動建議內容不在 P0-3 範圍內）
  - P0-4 目標是驗證 P0-3 的結構可以搬移到新 Facet

### 專案整體狀態
- **整體進度**：Phase 0 - Facet 基礎建設階段，已完成 P0-1、P0-2、P0-3，進行中 P0-4
- **階段性目標**：
  - 當前階段：P0-4 Facet Portability & Stress Test
  - 已完成：P0-1（Facet 選定）、P0-2（Output Contract）、P0-3（Narrative Sharpness）
  - 待完成：P0-4（可移植性驗證）、P0-5（最小 UI 串接，占位）
- **整體決策脈絡**：P0-4 是為了驗證 P0-3 建立的結構可以在第二個 Facet 上「零改動搬移」且不崩壞，這對於未來擴充到更多 Facet 至關重要
- **風險與挑戰**：
  - 結構搬移可能遇到隱喻不兼容問題
  - 需要確保新 Facet 的輸出無現代污染詞

### 未來規劃摘要
- **短期任務清單**（接下來 1-2 週）：
  - P0-4：完成 R2 主隱喻設計 + R4 禁用詞擴充（P0，阻斷封板）
  - P0-4：完成 Golden Tests 規格（P1）
- **階段性規劃**：
  - 當前階段：P0-4 Facet Portability
  - 下一個階段：P0-5 最小 UI 串接（占位，不優化）
  - 目標：驗證引擎結構的可移植性
- **決策點**：
  - P0-4 封板決策：需要確認 Golden Tests 是否通過（預計 2-3 週後）

## 背景資料
- **參考 Facet**：P0-3 `income_expansion_pressure`（歲時農耕・倉廩觀）
- **目標 Facet**：P0-4 `relationship_imbalance`（關係失衡）
- **核心文件**：
  - `P0-3/P0-3_CHARTER.md`（P0-3 的結構定義）
  - `P0-4/P0-4_FACET_BRIEF.md`（P0-4 的 Facet 定義）
  - `docs/domain/advisory/R2/P0-3_SECONDARY_METAPHOR_WHITELIST.md`（P0-3 的次隱喻白名單範例）
- **相關任務**：
  - **上游任務**：P0-3（已完成，提供結構參考）
  - **下游任務**：P0-5（待執行，需要 P0-4 完成後）
  - **並行任務**：無

## 任務內容
1. **設計主隱喻**：
   - 符合「關係失衡」的概念
   - 符合東方玄學體系
   - 可與 P0-3 的「歲時農耕・倉廩觀」區分

2. **建立次隱喻白名單**：
   - 可機器檢查（grep/regex）
   - 每段最多 1 個次隱喻
   - 不得出現句型限制

3. **產出交付物**：
   - `docs/domain/advisory/R2/P0-4_SECONDARY_METAPHOR_WHITELIST.md`
   - `docs/domain/advisory/R2/P0-4_SECONDARY_METAPHOR_RULES.md`

## 約束條件
- **硬性限制**：
  - 不得使用現代心理/醫療/法律/管理術語
  - 不得推斷具體事件
  - 不得下具體決策指令
- **參考規範**：
  - `docs/governance/GOVERNANCE_METAPHOR_COMPATIBILITY_RULE.md`
  - `P0-3/P0-3_FINAL_CHECKLIST.md`
- **禁區**：
  - 不得暴露心理學原理
  - 不得用診斷語氣

## 資源需求
- **顧問師**：R2（Narrative Designer）
- **參考文件**：見「背景資料」部分

## 優先級與時程
- **優先級**：P0（阻斷 P0-4 封板）
- **預計時程**：2-3 天
- **依賴關係**：依賴 P0-3 完成（已完成）

## 驗收標準
- ✅ 主隱喻符合「關係失衡」概念
- ✅ 次隱喻白名單可機器檢查（grep/regex）
- ✅ 符合所有約束條件
- ✅ 交付物已寫入正確的 Canon 路徑
```

---

## 資訊分類規則（重要｜2026-01-10 更新）

### 任務包資訊分配規則
根據 Cursor 架構，資訊分類如下：

**任務包內容（完整背景資料｜一次任務包解決）**：
- 專案歷史摘要（最近完成的任務、關鍵決策點、項目整體狀態）
- 背景資料（相關文件路徑和內容摘要、現狀分析、相關任務）
- 任務內容（具體步驟、交付物、驗收標準）
- 約束條件（硬性限制、參考規範、禁區）
- 必要的規範摘要（摘要版本，不超過 50 行）
- 基本制度規範（摘要版本）
- 顧問師角色系統（完整定義）
- 當前任務摘要（簡要版本 + 路徑引用）

**任務包內容（單次任務判斷和執行）**：
- 專案歷史摘要（過去執行歷史、專案整體狀態、未來規劃）
- 當前任務詳細資訊（任務目標、背景資料、任務內容、約束條件、資源需求、優先級與時程）

**詳細規則**：見 `docs/governance/INFORMATION_CLASSIFICATION_RULE.md`

---

## 狀態
- ACTIVE（自 2026-01-10 起生效）
- EDITABLE · NOT FROZEN（可隨時修正）
- Cursor 在產出任務包時，必須遵守此規則
- 必須遵守資訊分類規則（`INFORMATION_CLASSIFICATION_RULE.md`）

