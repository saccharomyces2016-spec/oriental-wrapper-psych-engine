[FULL_ONLY]

# Lessons Learned（失敗案例→治理規則）

<!-- XUANCE_LESSONS_FAILCASES_BEGIN -->
## 失敗案例 A：不使用文本（對話內版本漂移）
現象：
- 同一個 GPT 對話串跑到後期，出現 4 個題型版本共存
- 版本之間引用路徑互相衝突
- 即使第 4 版表現不錯，最後因整包重做而汰除，只能封存

根因（工程語言）：
- 沒有 SSOT（Single Source of Truth）
- 版本與引用關係不受控（無 manifest / 無明確生效規則）
- 「看起來可用」但不可回溯、不可維護

本專案對策（已採用/必維持）：
- ROADMAP/CURRENT/ADR 為唯一主線事實來源（未寫入視為不存在）
- domain 外置化 + schema 版本化 + golden tests（避免行為漂移）
- MASTER_SYNC_PACKET 作為「同步快照」，但 SSOT 仍是原檔

驗收點：
- 同一時間只允許一個「生效的題型版本」
- 引用路徑必須可由 manifest/compile 推導且能測試

---

## 失敗案例 B：文本治理「寫死」導致上層不可改、下層不合目標
現象：
- 有用文本紀錄作唯一依據
- 但上層規定寫得太死，後期發現不符合目標也不能改
- 下層設定又無法滿足功能需求，造成雙向卡死而失敗

根因（工程語言）：
- 治理規則缺少「合法變更機制」（缺少可回滾、可覆蓋的改規則路徑）
- 上層規則與目標沒有保留「使用者最終修正權」的操作層落地

本專案對策（必採用/本輪新增強調）：
- 使用者最高主權（CHARTER）+ 可回滾（checkpoint）= 永遠可改
- 規則/架構變更走 ADR + 使用者批准（不是不能改，是要能審計地改）
- 若發現規則不再服務目標：允許「新 checkpoint 覆蓋進度」而非硬扛

驗收點：
- 任一規則都能用「新增 ADR + checkpoint」合法修正，不會卡死

---

## 本輪討論結論（要寫進治理層的共同約束）
- 為避免偏離 NORTH_STAR Canon，題目設計階段必須顧問介入（R1 題目設計 + R4 風險鏈）
- 顧問輸出只能是建議稿：docs/gem/runs/；採納後才可落盤 domain

---

## 失敗案例 C：2026-01 Governance Hardening Incident

### 現象
- 健康檢查發現大量結構性問題：
  - Canon Path 違規：2 個（repo-root 層級的 ./docs, ./tmp）
  - 單源規則違規：1 個（COMMON_PACKET.md 多份）
  - 影子路徑引用：260 個
  - 未索引治理文件：42 個
  - 重複檔名：44 個

### 根因（工程語言）
**本次修復量偏大，原因不是人為疏失，而是：**
> 「制度早期偏重『生成與推進』，對『結構健康』缺乏持續約束」

具體表現：
- 缺乏「寫入時驗證」機制（文件寫入時未檢查 Canon 路徑）
- 缺乏「索引強制」機制（治理文件未強制要求索引）
- 缺乏「引用檢查」機制（相對路徑引用未被阻止）
- 健康檢查工具建立較晚，問題累積後才發現

### 本專案對策（已採用/必維持）
- 建立健康檢查機制（HEALTH_CHECK_PLAN.md）
- 健康檢查 = 治理結構全面盤點（Governance Inventory）
- FULL 快照必須引用健康檢查結果
- 啟動制度改進提案機制（GOVERNANCE_IMPROVEMENT_PROPOSAL）

### 驗收點
- 健康檢查定期執行（每週一次）
- 硬性指標（canon_path_violations, single_source_violations）必須為 0
- 未來減少 80% 大型返工

---
- 舊版本題庫/題型應進 archive/legacy 層：只做「反例與訊號萃取」，不得直接貼進 domain
<!-- XUANCE_LESSONS_FAILCASES_END -->

---

## 失敗案例補充：my-first-app（早期封存）

問題：
- 題目版本多線並存，無唯一真相來源
- 無研究層，直接把題目當結果
- UI 與命題邏輯耦合

改善原則：
- 強制 Research → Brief → Advisor → Domain
- 題目必須可被替換，不可綁死敘事
- 治理層允許「使用者最終覆寫」
