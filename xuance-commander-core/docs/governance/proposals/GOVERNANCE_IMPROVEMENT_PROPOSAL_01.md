# GOVERNANCE_IMPROVEMENT_PROPOSAL_01
> 總工程師（Cursor）制度改進提案  
> 生成時間：2026-01-08  
> 狀態：IN_PROGRESS

## 提案背景
基於 2026-01 Governance Hardening Incident 的修復經驗，提出制度層改進方案，目標是「未來減少 80% 大型返工」。

---

## 一、哪些問題應該「永遠不再出現」

### 1.1 Canon Path 漂移
**問題**：文件被寫入錯誤的路徑（如 repo-root 的 ./docs, ./tmp）

**改進方案**：
- **建議新增**：`docs/governance/CANON_PATH_ENFORCEMENT_RULE.md`
  - 定義：所有文件寫入前必須驗證路徑是否符合 Canon
  - 執行：在文件寫入腳本中加入路徑檢查
  - 違規處理：自動拒絕寫入，並提示正確路徑

- **建議新增**：Git pre-commit hook 檢查
  - 檢查新增文件是否在 Canon 路徑外
  - 違規時阻止 commit

### 1.2 治理文件未索引
**問題**：治理文件寫入後未在 GOVERNANCE_INDEX.md 中索引

**改進方案**：
- **建議新增**：`docs/governance/INDEX_MANDATORY_RULE.md`
  - 定義：所有 `docs/governance/*.md` 必須在 GOVERNANCE_INDEX.md 中索引
  - 執行：健康檢查工具已可檢測，但需前移到「寫入時」
  - 違規處理：警告並要求補索引

- **建議修改**：健康檢查工具
  - 增加「寫入時檢查」模式（非僅定期掃描）
  - 在文件寫入後立即檢查索引完整性

### 1.3 單源規則違規
**問題**：關鍵文件（如 COMMON_PACKET.md）出現多份

**改進方案**：
- **建議保持不動**：現有 SINGLE_SOURCE_RULES.md 已定義規則
- **建議新增**：自動檢測機制
  - 在文件寫入時檢查是否違反單源規則
  - 對已知的單源文件（COMMON_PACKET.md, CHAT_PACKET.md）進行特殊檢查

---

## 二、哪些檢查應該前移

### 2.1 寫入時驗證（Write-Time Validation）
**當前問題**：問題在累積後才被發現

**改進方案**：
- **建議新增**：`docs/governance/WRITE_TIME_VALIDATION_RULE.md`
  - 定義：文件寫入時必須通過以下檢查：
    1. Canon 路徑驗證
    2. 索引完整性檢查（治理文件）
    3. 單源規則檢查（關鍵文件）
    4. 相對路徑引用檢查（禁止 out/, tmp/, logs/）

- **建議新增**：工具層支持
  - 建立 `tools/validate_write.sh` 腳本
  - 在文件寫入前/後自動執行驗證
  - 可整合到 Git pre-commit hook

### 2.2 引用檢查前移
**當前問題**：相對路徑引用在健康檢查時才發現

**改進方案**：
- **建議修改**：健康檢查工具
  - 增加「即時檢查模式」：在文件寫入後立即檢查
  - 提供「修復建議」：自動提示正確的 Canon 路徑

- **建議新增**：編輯器/IDE 插件（可選）
  - 在編輯時提示相對路徑引用
  - 自動補全 Canon 路徑

---

## 三、哪些規則現在太晚才發現

### 3.1 健康檢查機制建立較晚
**問題**：健康檢查工具在問題累積後才建立

**改進方案**：
- **建議保持不動**：HEALTH_CHECK_PLAN.md 已定義機制
- **建議修改**：觸發頻率
  - 當前：每週一次
  - 建議：每週一次 + 每次治理文件變更後自動觸發

### 3.2 缺乏「寫入即驗證」的 Gate
**問題**：文件寫入時沒有自動驗證機制

**改進方案**：
- **建議新增**：`docs/governance/WRITE_GATE_RULES.md`
  - 定義：所有文件寫入必須通過 Gate 檢查
  - Gate 項目：
    1. Canon 路徑檢查
    2. 索引完整性（治理文件）
    3. 單源規則（關鍵文件）
    4. 引用確定性（禁止相對路徑）

- **建議新增**：自動化工具
  - `tools/write_gate.sh`：文件寫入前檢查
  - 整合到現有工具鏈（如 build_master_sync_packet.sh）

---

## 四、對現有 HEALTH_CHECK 的改良建議

### 4.1 頻率調整
**當前**：每週一次（建議週五或週日）

**建議修改**：
- 保持每週一次定期檢查
- **新增**：每次治理文件變更後自動觸發
- **新增**：每次大量路徑變更後自動觸發

### 4.2 項目擴充
**當前**：5 類盤點（Canon 路徑、單源規則、索引完整性、引用確定性、歷史邊界）

**建議保持不動**：5 類已足夠，無需擴充

**建議新增**：
- 檢查結果自動分類（PASS / NEED_FIX / BLOCK）
- 提供修復建議（而非僅報告問題）

### 4.3 輸出格式調整
**當前**：報告目錄 + 指標檔

**建議修改**：
- **保持**：報告目錄結構
- **新增**：JSON 格式輸出（便於自動化處理）
- **新增**：修復建議清單（針對每個問題提供具體修復步驟）

### 4.4 整合到 FULL 快照
**當前**：健康檢查結果獨立存在

**建議修改**：
- **已實施**：FULL_SNAPSHOT_RULES.md 已定義引用規則
- **建議新增**：自動整合機制
  - 在生成 FULL 快照時自動引用最新健康檢查結果
  - 確保快照包含治理狀態

---

## 五、實施優先序

### P0（立即實施）
1. 建立 WRITE_TIME_VALIDATION_RULE.md
2. 建立 write_gate.sh 工具
3. 更新健康檢查工具，增加即時檢查模式

### P1（近期實施）
1. 建立 CANON_PATH_ENFORCEMENT_RULE.md
2. 建立 INDEX_MANDATORY_RULE.md
3. 整合 Git pre-commit hook

### P2（長期優化）
1. 建立編輯器/IDE 插件（可選）
2. 健康檢查結果 JSON 格式輸出
3. 自動修復建議生成

---

## 六、風險評估

### 低風險
- 健康檢查機制改進（已有基礎）
- FULL 快照整合（已有規則）

### 中風險
- 寫入時驗證（可能影響現有工作流）
- Git pre-commit hook（需要團隊適應）

### 高風險
- 無（所有改進都是增量式，不破壞現有機制）

---

## 七、預期效果

### 短期（1-2 週）
- 寫入時驗證機制建立
- 問題發現時間從「累積後」提前到「寫入時」

### 中期（1-2 月）
- 健康檢查自動化程度提升
- 大型返工減少 50%

### 長期（3-6 月）
- 制度健康度持續改善
- 大型返工減少 80%（目標）

---

## 八、結論

### 建議新增
1. WRITE_TIME_VALIDATION_RULE.md
2. CANON_PATH_ENFORCEMENT_RULE.md
3. INDEX_MANDATORY_RULE.md
4. WRITE_GATE_RULES.md
5. write_gate.sh 工具
6. 健康檢查工具即時檢查模式

### 建議修改
1. 健康檢查觸發頻率（增加自動觸發）
2. 健康檢查輸出格式（增加 JSON 和修復建議）

### 建議保持不動
1. HEALTH_CHECK_PLAN.md 的核心機制
2. SINGLE_SOURCE_RULES.md 的規則定義
3. 5 類盤點項目（無需擴充）

---

## 狀態
- 提案狀態：IN_PROGRESS
- 等待：指揮官（GPT）審核與裁決
- 執行者：總工程師（Cursor）待指令



