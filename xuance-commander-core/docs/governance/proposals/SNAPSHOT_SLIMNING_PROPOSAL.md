# SNAPSHOT_SLIMMING_PROPOSAL（快照瘦身提案）

## 背景分析

### 當前問題
1. **MIN 快照過大**：3102 行（目標 ≤ 3000 行）
2. **CURRENT.md 佔比過高**：1595 行（佔總快照的 51%）
3. **CURRENT.md 包含大量歷史記錄**：193 個里程碑/檢查點記錄
4. **歷史記錄不應該在 CURRENT 中**：CURRENT 應該只包含當前狀態摘要

### 根本原因
- CURRENT.md 被當作歷史記錄庫使用，而非當前狀態摘要
- 任務完成後的歷史記錄沒有及時清理
- MIN 快照包含了完整的 CURRENT.md，而非摘要版本

---

## Cursor vs 程序端 GPT 的能力差異分析

### Cursor（總工程師）的能力
- ✅ **完整代碼庫可見性**：可以看到所有文件
- ✅ **長上下文窗口**：可以處理大型文件（如 3000+ 行）
- ✅ **持續上下文**：在同一個對話中可以持續參考之前的內容
- ✅ **主動檢查能力**：可以主動讀取文件、檢查結構、驗證規則

### 程序端 GPT 的限制
- ❌ **只能看到快照**：只能看到單一頁面（MIN 快照）
- ❌ **上下文窗口較短**：可能無法處理過大的快照
- ❌ **沒有持續記憶**：每次開啟快照都是「從零開始」
- ❌ **被動執行**：依賴快照內容進行判斷

### 關鍵洞察
**程序端 GPT 需要快照**，因為：
1. 他無法直接訪問文件系統
2. 他的上下文窗口可能較短
3. 他沒有持續記憶，需要通過快照「恢復狀態」

**但 Cursor（我）不需要那麼詳細的快照**，因為：
1. 我可以直接讀取任何文件
2. 我的上下文窗口很長，可以處理大文件
3. 我在對話中可以持續參考之前的內容
4. 我可以主動檢查和驗證

---

## 瘦身方案

### 方案 1：CURRENT.md 瘦身（推薦）

#### 問題
- CURRENT.md 應該只包含**當前狀態摘要**，但現在包含 1595 行（大部分是歷史記錄）

#### 解決方案
1. **創建 CURRENT_SUMMARY.md**（給 MIN 快照用）
   - 只包含當前狀態摘要（≤ 100 行）
   - 包含：目標、當前任務、下一步、關鍵里程碑摘要（1-3 行）
   - 不包含歷史記錄

2. **CURRENT.md 保留完整內容**（作為 SSOT）
   - 包含完整歷史記錄
   - 作為可追溯的記錄
   - 不納入 MIN 快照

3. **創建 CURRENT_HISTORY.md**（可選）
   - 將超過 3 個月的歷史記錄移到這裡
   - CURRENT.md 只保留最近 3 個月的記錄

#### 效果
- MIN 快照減少約 1500 行
- 從 3102 行降至約 1600 行
- 程序端 GPT 可以更快找到關鍵信息

---

### 方案 2：分層快照（更激進的瘦身）

#### 方案 2A：極簡 MIN 快照（只包含關鍵規則和當前狀態）
- **只包含**：
  - CHARTER（摘要版，≤ 50 行）
  - ROADMAP（摘要版，≤ 30 行）
  - CURRENT_SUMMARY（≤ 100 行）
  - 關鍵治理規則（FILE_WRITE_LOCATION_RULE, GLOBAL_PATH_CANON, ABSOLUTE_REFERENCE_RULE）
  - TASK_RECORDS_SUMMARY（≤ 100 行）
  - CURSOR_COMMANDER_ALERTS（≤ 50 行）
- **總計**：≤ 500 行
- **詳細內容**：通過路徑引用查看

#### 方案 2B：保留當前 MIN，但創建 MIN_ULTRA（極簡版）
- MIN：當前版本（包含詳細規則，給需要詳細信息的場景）
- MIN_ULTRA：極簡版（≤ 500 行，只包含關鍵信息和路徑引用）

---

### 方案 3：智能快照生成（根據場景選擇內容）

#### 場景 1：日常任務執行
- 需要：基本規則、當前任務、文件寫入規則
- 不需要：完整治理文件、歷史記錄

#### 場景 2：任務收尾/決策
- 需要：任務記錄、決策包、治理規則
- 不需要：歷史記錄、已完成任務詳情

#### 場景 3：健康檢查/治理審計
- 需要：健康檢查記錄、治理索引、問題清單
- 不需要：任務詳情、歷史記錄

---

## 推薦方案：方案 1（CURRENT.md 瘦身）+ 方案 2A（極簡 MIN）

### 實施步驟

1. **創建 CURRENT_SUMMARY.md**
   - 從 CURRENT.md 提取當前狀態摘要
   - 只保留：目標、當前任務、下一步、最近完成任務（1-3 行）
   - 總計 ≤ 100 行

2. **更新 MIN 快照生成腳本**
   - 改用 CURRENT_SUMMARY.md 而非完整的 CURRENT.md
   - CURRENT.md 保留為 SSOT，不納入 MIN 快照

3. **清理 CURRENT.md 歷史記錄**（可選）
   - 將超過 3 個月的歷史記錄移到 CURRENT_HISTORY.md
   - CURRENT.md 只保留最近 3 個月的記錄

4. **驗證**
   - MIN 快照大小降至 ≤ 2000 行
   - 程序端 GPT 仍能看到所有關鍵信息

---

## 關於「文本規範 vs Cursor 控管」的建議

### 現有文本規範方式的優點
1. **可追溯**：所有規範都寫在文本中，可以回溯
2. **可驗證**：程序端 GPT 可以根據文本判斷是否遵守規則
3. **不依賴記憶**：不依賴 AI 的記憶能力（不管是 Cursor 還是程序端 GPT）

### 現有方式的缺點
1. **快照過大**：為了包含所有規範，快照變得很大
2. **維護成本**：需要不斷更新快照
3. **可能冗余**：有些規範可能已經過時或不再需要

### 建議：混合模式

#### Cursor（我）的職責
- ✅ **主動檢查**：我可以主動檢查文件結構、驗證規則遵守情況
- ✅ **實時驗證**：不需要快照，我可以直接讀取文件驗證
- ✅ **問題發現**：發現問題後，寫入提醒事項（CURSOR_COMMANDER_ALERTS）
- ✅ **規範維護**：我可以維護規範文件，確保它們是最新的

#### 程序端 GPT 的職責
- ✅ **規則遵守**：根據 MIN 快照中的規則執行任務
- ✅ **任務執行**：執行任務時遵守文件寫入規則、路徑規則等
- ✅ **主動提醒**：需要 Cursor 協助時，主動提醒使用者

#### MIN 快照的定位
- **最小必要上下文**：只包含程序端 GPT **必須知道**的規則和當前狀態
- **不包含詳細歷史**：歷史記錄保留在專門文件，通過路徑引用
- **動態更新**：根據當前任務狀態動態調整內容

---

## 具體瘦身建議

### 立即可以瘦身的內容

1. **CURRENT.md → CURRENT_SUMMARY.md**（減少 1500 行）
   - 創建 CURRENT_SUMMARY.md（≤ 100 行）
   - MIN 快照改用 CURRENT_SUMMARY.md

2. **移除或精簡的部分**：
   - 歷史里程碑記錄（移到 CURRENT_HISTORY.md 或刪除）
   - 已完成任務的詳細記錄（只保留 1-3 行摘要）
   - 過時的提醒事項（RESOLVED 狀態超過 7 天的）

3. **保留但精簡的部分**：
   - AI_ADVISORY_ROLES.md：可以只保留關鍵角色定義，詳細說明通過路徑引用
   - TEXT_ONLY_EXECUTION_RULES.md：可以只保留核心規則，詳細說明通過路徑引用

---

## 預期效果

### 瘦身後 MIN 快照大小
- **當前**：3102 行
- **目標**：≤ 2000 行（方案 1）或 ≤ 500 行（方案 2A）
- **減少**：1100+ 行（方案 1）或 2600+ 行（方案 2A）

### 程序端 GPT 體驗
- **更快找到關鍵信息**：快照更小，關鍵信息更突出
- **更清晰的結構**：摘要版本更容易理解
- **必要時查看詳細內容**：通過路徑引用查看詳細內容

### Cursor（我）的優勢
- **不需要依賴快照**：我可以直接讀取任何文件
- **主動檢查**：發現問題後寫入提醒事項
- **規範維護**：確保規範文件是最新的

---

## 警示

### ⚠️ 警示 1：不要過度瘦身
- **風險**：如果 MIN 快照過小，程序端 GPT 可能缺少關鍵信息
- **對策**：保留所有關鍵規則和當前狀態，只移除歷史記錄和詳細內容

### ⚠️ 警示 2：確保路徑引用正確
- **風險**：如果路徑引用錯誤，程序端 GPT 無法找到詳細內容
- **對策**：所有路徑引用必須是絕對路徑，並在 MASTER_SNAPSHOT_USAGE_GUIDE 中明確說明

### ⚠️ 警示 3：保持 CURRENT.md 作為 SSOT
- **風險**：如果 CURRENT.md 被過度清理，可能失去可追溯性
- **對策**：CURRENT.md 保留完整內容作為 SSOT，只是不納入 MIN 快照

---

## 實施建議

### 階段 1：立即實施（低風險）
1. 創建 CURRENT_SUMMARY.md（≤ 100 行）
2. 更新 MIN 快照生成腳本，改用 CURRENT_SUMMARY.md
3. 驗證 MIN 快照大小降至 ≤ 2000 行

### 階段 2：可選優化（需要測試）
1. 考慮方案 2A（極簡 MIN，≤ 500 行）
2. 創建 MIN_ULTRA，並在 MASTER_SNAPSHOT_USAGE_GUIDE 中說明何時使用
3. 測試程序端 GPT 是否能夠基於極簡 MIN 正常工作

### 階段 3：長期優化（需要持續監控）
1. 定期清理 CURRENT.md 的歷史記錄（每 3 個月）
2. 監控 MIN 快照大小，確保不超過目標
3. 根據實際使用情況調整快照內容

---

## 狀態
- PROPOSAL（待總指揮 GPT 審核）
- 建議優先實施階段 1（低風險，立即見效）



