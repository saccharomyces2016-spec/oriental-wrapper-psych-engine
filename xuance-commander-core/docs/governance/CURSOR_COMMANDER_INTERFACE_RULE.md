# CURSOR_COMMANDER_INTERFACE_RULE（Cursor 與總指揮 GPT 接口規範）

## 目的
定義 Cursor（總工程師）與總指揮 GPT 的對口規則，確保重要信息能夠自動傳遞到 MIN 快照，讓總指揮 GPT 即使沒有直接接收消息也能判斷需要協助處理的事項。

---

## 核心原則

### 1. 所有重要信息必須納入快照
**規則**：Cursor 發現的任何需要總指揮 GPT 關注或決策的事項，都必須寫入會被納入 MIN 快照的文件中。

**禁止**：
- ❌ 只寫在臨時文件（tmp/、logs/）中
- ❌ 只通過對話告知，沒有寫入文本
- ❌ 寫入不會被快照引用的文件

**必須**：
- ✅ 寫入會被 MIN 快照引用的文件
- ✅ 寫入後重新生成 MIN 快照
- ✅ 確保信息出現在總指揮 GPT 能看到的快照中

---

## 必須納入 MIN 快照的內容類型

### 1. 任務狀態變更
**觸發條件**：
- 新任務開始
- 任務進度更新（完成里程碑、遇到阻斷）
- 任務完成或取消

**記錄位置**：
- `docs/ops/TASK_RECORDS_SUMMARY.md`（摘要，納入 MIN）
- `docs/ops/TASK_RECORDS_INDEX.md`（完整記錄，通過路徑引用）

**要求**：
- 任務摘要必須包含：狀態、目標、主要成果、待補齊項目、詳細記錄路徑
- 完成後的任務只保留 1-3 行摘要，詳細記錄保留在專門文件

### 2. 健康檢查結果
**觸發條件**：
- 健康檢查執行後
- 發現關鍵問題（Canon 違規、單源違規）

**記錄位置**：
- `docs/ops/HEALTH_CHECK_RECORDS.md`（歷史記錄）
- `tmp/health_check/LATEST_HEALTH_CHECK.md`（最新指標）

**要求**：
- 關鍵問題（Canon 違規、單源違規）必須在 MIN 快照中顯示
- 非關鍵問題（如影子路徑引用）可以只顯示摘要

### 3. 結構性問題發現
**觸發條件**：
- 發現文件結構問題
- 發現路徑違規
- 發現索引缺失

**記錄位置**：
- 寫入對應的治理文件或問題記錄
- 在 `docs/ops/TASK_RECORDS_SUMMARY.md` 中記錄（如果是需要處理的任務）

**要求**：
- 必須明確說明問題、影響、是否需要總指揮 GPT 決策

### 4. 需要總指揮 GPT 決策的事項
**觸發條件**：
- 需要總指揮 GPT 做裁決
- 需要總指揮 GPT 審核
- 發現需要總指揮 GPT 關注的風險

**記錄位置**：
- `docs/ops/CURSOR_COMMANDER_ALERTS.md`（新建，專門用於 Cursor 提醒總指揮 GPT）

**要求**：
- 必須明確標記優先級（P0/P1/P2）
- 必須說明背景、問題、建議行動
- 必須標記是否需要立即處理

---

## 對口文件清單

### MIN 快照必須包含的文件
以下文件必須被納入 MIN 快照生成腳本：

1. **任務記錄摘要**：`docs/ops/TASK_RECORDS_SUMMARY.md`
   - 當前任務狀態
   - 需要總指揮 GPT 關注的事項

2. **健康檢查記錄**：`docs/ops/HEALTH_CHECK_RECORDS.md`（摘要）
   - 最新健康檢查狀態
   - 關鍵問題提醒

3. **Cursor 提醒事項**：`docs/ops/CURSOR_COMMANDER_ALERTS.md`（新建）
   - Cursor 發現的需要總指揮 GPT 決策的事項
   - 優先級標記
   - 建議行動

4. **基本管理制度**（已包含）
   - FILE_WRITE_LOCATION_RULE
   - GLOBAL_PATH_CANON
   - ABSOLUTE_REFERENCE_RULE
   - MASTER_SNAPSHOT_USAGE_GUIDE
   - AI_ADVISORY_ROLES

---

## Cursor 工作流程

### 發現需要總指揮 GPT 關注的事項時

1. **判斷優先級**：
   - P0（立即處理）：Canon 違規、單源違規、任務阻斷
   - P1（建議處理）：健康檢查發現的問題、結構性問題
   - P2（可選處理）：優化建議、改進提案

2. **記錄到對應文件**：
   - P0/P1：寫入 `docs/ops/CURSOR_COMMANDER_ALERTS.md`
   - 任務相關：更新 `docs/ops/TASK_RECORDS_SUMMARY.md`
   - 健康檢查：更新 `docs/ops/HEALTH_CHECK_RECORDS.md`

3. **重新生成 MIN 快照**：
   - 執行 `bash tools/build_master_sync_packet_min.sh`
   - 確保新信息出現在 MIN 快照中

4. **驗證**：
   - 檢查 MIN 快照是否包含新信息
   - 確認總指揮 GPT 能夠看到

---

## 任務記錄強制規則

### 所有任務都必須記錄

**規則**：任何任務（臨時性、階段性、主線任務）都必須：
1. 在 `docs/ops/TASK_RECORDS_INDEX.md` 中登記
2. 在 `docs/ops/TASK_RECORDS_SUMMARY.md` 中寫入摘要（如果正在進行）
3. 詳細記錄寫在專門文件，並在摘要中引用路徑

**記錄要求**：
- **進行中的任務**：
  - 目標（1 行）
  - 主要成果（3-5 條）
  - 待補齊項目（3-5 條）
  - 是否可以收尾（是/否，以及條件）
  - 詳細記錄路徑（1-3 個文件路徑）
  
- **已完成的任務**：
  - 完成日期（1 行）
  - 關鍵成果摘要（1-3 行）
  - 詳細記錄路徑（引用）

---

## MIN 快照內容控制

### 大小控制規則
- **總行數目標**：≤ 3000 行
- **單個任務摘要**：≤ 10 行
- **任務記錄摘要總計**：≤ 100 行
- **已完成任務摘要**：每個 ≤ 3 行

### 內容分層
1. **必須包含**：基本管理制度、當前任務摘要、健康檢查狀態
2. **應該包含**：最近完成的任務摘要（最近 3 個月）
3. **不應該包含**：詳細的任務記錄、超過 3 個月的歷史記錄、完整的治理文件列表

---

## 總指揮 GPT 如何查看

### 查看當前狀態
1. **開啟 MIN 快照**：`memory/briefs/MASTER_MIN_SYNC_PACKET.md`
2. **查看任務記錄摘要**：在快照中搜索 "TASK_RECORDS_SUMMARY"
3. **查看 Cursor 提醒**：在快照中搜索 "CURSOR_COMMANDER_ALERTS"
4. **查看健康檢查狀態**：在快照中搜索 "HEALTH_CHECK"

### 查看詳細記錄
根據 MIN 快照中的路徑引用，開啟對應的詳細記錄文件：
- 任務詳細記錄：見 `docs/ops/TASK_RECORDS_INDEX.md` 中的路徑
- 健康檢查詳細報告：見 `tmp/health_check/LATEST_HEALTH_CHECK.md`
- 任務決策包：見 `P0-*/DECISION_PACKET_*.md`

---

## Cursor 工作原則（重要）

### 我不依賴快照進行檢查
- ✅ **我可以看到完整代碼庫**：不需要快照，可以直接讀取任何文件
- ✅ **我應該主動檢查**：發現問題後寫入提醒事項，而非等待快照更新
- ✅ **我應該直接讀取文件驗證**：不需要依賴快照中的內容

### 但我仍需要基本規範可見
- ✅ **基本規範必須在快照中**：讓程序端 GPT 可以隨時看到並遵守
- ✅ **程序端 GPT 可以引導我**：當程序端 GPT 看到基本規範後，可以向我提出提案或建議，引導我回想起基本制度
- ✅ **混合模式**：基本規範寫在快照中（程序端 GPT 需要），詳細檢查由我直接讀取文件完成

### 我可以主動提出建議
- ✅ **基於專業判斷**：基於對完整代碼庫的了解，對總指揮 GPT 的提案主動提出改進建議
- ✅ **基於文件核對**：發現指揮官提案可能與現有文件衝突或可以改進時，主動提出建議
- ✅ **確保決策更周全**：幫助總指揮 GPT 做出更周全的決策，避免因無法看到完整文件而導致決策不夠周全
- ✅ **建議必須寫入文本**：所有建議必須寫入 `CURSOR_COMMANDER_ALERTS.md` 並納入 MIN 快照
- ✅ **快照會定期清理**：RESOLVED 狀態建議保留 7 天後清理，REJECTED/DEFERRED 狀態建議保留 30 天後清理，確保 MIN 快照不會無限增長

### 我不應該做的事
- ❌ 不應該依賴快照進行檢查（應該直接讀取文件）
- ❌ 不應該假設程序端 GPT 會記住規範（應該寫在快照中）
- ❌ 不應該依賴記憶（規範仍要寫在文本中，我通過讀取文件檢查）

---

## Cursor 主動建議機制補充說明

### 我可以對總指揮 GPT 的提案提出改進建議
**原因**：總指揮 GPT 無法看到完整文件，難免會有決策不夠周全的時候。

**我可以主動提出建議的情況**：
- ✅ 發現指揮官提案可能與現有文件衝突
- ✅ 發現指揮官提案可以採用更好的方案
- ✅ 發現更高效的實施方案（可以複用現有資源、避免重複工作）
- ✅ 發現潛在技術風險或維護困難
- ✅ 發現可能違反治理規則的情況

**建議的處理方式**：
1. **寫入 `CURSOR_COMMANDER_ALERTS.md`**：
   - 標記優先級（P0/P1/P2）
   - 標記狀態（OPEN）
   - 說明問題描述、建議方案、理由
2. **納入 MIN 快照**：
   - 重建 MIN 快照，確保建議出現在快照中
   - 總指揮 GPT 可以通過 MIN 快照看到建議
3. **定期清理**：
   - RESOLVED 狀態建議保留 7 天後清理
   - REJECTED/DEFERRED 狀態建議保留 30 天後清理
   - 確保 MIN 快照不會無限增長

**總指揮 GPT 的處理**：
- 可以採納、拒絕或要求更多資訊
- 處理後通知 Cursor 更新狀態（RESOLVED/REJECTED/DEFERRED）

**詳細規則**：見 `docs/governance/CURSOR_PROACTIVE_SUGGESTION_RULE.md`

---

## 狀態
- ACTIVE
- 必須納入 MIN 快照
- 每次 Cursor 發現需要總指揮 GPT 關注的事項時，必須遵守此規則

