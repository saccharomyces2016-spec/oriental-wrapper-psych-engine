# P0-5 Question Modality Extensibility（P0-5 題型可擴充性設計）

## 狀態
- ACTIVE
- EDITABLE
- 建立日期：2026-01-09

---

## 目的
明確 P0-5 UI 架構必須支持未來題型擴充（如八卦盤、符號多選等），確保當前實作不會阻礙未來改進。

---

## 核心原則

### 數據層與呈現層分離（Data-Presentation Separation）
- **數據層**：compiled facet JSON 結構獨立於 UI 呈現方式
- **呈現層**：UI 組件可替換，不影響數據結構
- **適配層**：UI Adapter 負責將數據映射到不同的呈現方式

### 可擴充性保證（Extensibility Guarantee）
- **當前實作**：P0-5 可能使用基礎的單選/多選形式
- **未來擴充**：必須能夠無縫切換到八卦盤、符號多選等創新 UI
- **架構要求**：UI 架構必須支持題型呈現方式的替換，不影響核心邏輯

---

## 題型設計歷史與未來規劃

### P0-2 決策（ADR_0006）
- **範圍鎖定**：P0-2 期間禁止引入創新 UI 交互（八卦盤、符號多選）
- **保留未來設計空間**：明確批准並保留「符號化多代幣選擇介面（Symbolic multi-token selection）」作為 P0-2 之後的發展方向
- **當前題型**：使用最基礎、無歧義的輸入形式（如 Likert scale 變體或簡單單選/多選）

### 未來題型選項（已明確保留）
- **八卦盤（符號/詞彙多選）**：讓使用者用多個獨立詞彙拼出狀態分佈，可用加權/去相關做收斂
- **方案 A**：先八卦盤多選（掃描）→ 再單選（收斂/確認）
- **方案 B**：先單選（定位類別）→ 再八卦盤（細化強弱/細節）

**詳細文件**：見 `docs/adr/ADR_0006_question_modality_scope_lock.md` 和 `memory/briefs/CURRENT.md`

---

## P0-5 架構設計要求

### 必須支持題型替換
- **UI 組件模組化**：題目呈現組件必須獨立，可替換
- **數據綁定抽象化**：數據綁定邏輯必須抽象化，不依賴特定呈現方式
- **適配層設計**：必須有 UI Adapter 層，負責將數據映射到不同的呈現方式

### 當前實作策略（P0-5 MVP）
- **使用基礎形式**：先使用單選/多選等基礎形式，確保端到端流程可運作
- **保留擴充接口**：架構必須預留接口，支持未來切換到八卦盤等創新 UI
- **明確記錄決策**：在設計文件中明確說明當前使用基礎形式，但架構支持未來擴充

### 未來擴充策略（P0-6 或後續）
- **評估題型效果**：評估基礎形式 vs 八卦盤等創新 UI 的效果
- **逐步遷移**：如果決定採用八卦盤，可以逐步遷移，不影響現有功能
- **保持向後兼容**：新題型必須能夠處理現有的 compiled facet 數據結構

---

## 架構設計建議

### 1. UI 組件分層
```
UI Layer (可替換)
    ├── QuestionRenderer (抽象接口)
    │   ├── RadioQuestionRenderer (當前實作)
    │   ├── CheckboxQuestionRenderer (當前實作)
    │   └── BaguaQuestionRenderer (未來擴充)
    │
    └── AnswerCollector (抽象接口)
        ├── RadioAnswerCollector (當前實作)
        ├── CheckboxAnswerCollector (當前實作)
        └── BaguaAnswerCollector (未來擴充)
```

### 2. 數據綁定抽象化
- **Question Data**：compiled facet 的 questions 結構不變
- **Answer Data**：答案收集格式統一（questionId → answer value）
- **Renderer Selection**：根據題目類型或配置選擇對應的 Renderer

### 3. 配置驅動設計
- **題型配置**：可以在配置文件中指定使用哪種題型呈現方式
- **Facet 級別配置**：不同 Facet 可以使用不同的題型呈現方式
- **向後兼容**：如果配置未指定，使用默認的基礎形式

---

## 實作建議

### P0-5 階段（當前）
- **實作基礎形式**：單選/多選等基礎形式
- **建立抽象接口**：定義 QuestionRenderer 和 AnswerCollector 的抽象接口
- **模組化設計**：將題目呈現邏輯模組化，便於未來替換

### 未來階段（P0-6 或後續）
- **評估需求**：評估是否需要引入八卦盤等創新 UI
- **實作新 Renderer**：如果決定採用，實作新的 Renderer，不影響現有功能
- **逐步遷移**：可以逐步遷移，不影響現有使用者

---

## 風險與緩解

### 風險 1：當前實作過於耦合，未來難以擴充
**緩解**：
- 建立抽象接口，確保數據層與呈現層分離
- 模組化設計，題目呈現組件可獨立替換
- 明確記錄架構設計決策

### 風險 2：未來擴充需要大幅重構
**緩解**：
- 在 P0-5 階段就建立抽象接口和模組化設計
- 預留擴充接口，支持未來切換
- 保持向後兼容，不影響現有功能

### 風險 3：題型選擇影響數據結構
**緩解**：
- 數據結構獨立於呈現方式
- 答案收集格式統一，不依賴特定題型
- 適配層負責將不同題型的答案轉換為統一格式

---

## 與 ADR_0006 的關係

### ADR_0006 明確規定
- **P0-2 期間**：禁止引入創新 UI 交互（八卦盤、符號多選）
- **保留未來設計空間**：明確批准並保留「符號化多代幣選擇介面」作為未來發展方向

### P0-5 的責任
- **不違反 ADR_0006**：P0-5 可以使用基礎形式，不強制引入八卦盤
- **支持未來擴充**：P0-5 的架構必須支持未來引入八卦盤等創新 UI
- **明確記錄決策**：在設計文件中明確說明當前決策和未來規劃

---

## 狀態
- ACTIVE
- EDITABLE
- 必須納入 P0-5 任務包和架構設計



