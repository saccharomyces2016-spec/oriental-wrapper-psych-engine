# ENGINE CORE LOGIC V3 ADR 審核報告

**審核日期**：2026-01-12  
**審核文件**：ENGINE CORE LOGIC V3 — ARCHITECTURAL DECISIONS (FINAL, ENRICHED)  
**審核狀態**：部分符合，部分需追問

---

## 📋 審核摘要

### 整體評估

這份 ADR 文件質量很高，具備了架構決策應有的嚴謹性和可執行性。文件成功地：
- ✅ 明確回答了追問包中的兩個核心問題
- ✅ 提供了技術實作指導
- ✅ 考慮了向後相容性和可演化性
- ✅ 補強了參數配置化、缺失值防禦、可觀測性等關鍵點

**符合度**：約 85% 可直接寫入，15% 需要追問確認

---

## ✅ 符合任務需求的部分（可直接寫入）

### 1. 決策 1：運算模型升級策略

**符合度**：✅ **95% 符合**

**符合的部分**：
- ✅ 選擇「擴充支援」策略，符合追問包中的選項 B
- ✅ 明確了向後相容和向前開放的原則
- ✅ 提供了模型選擇機制（Schema 定義）
- ✅ 補強了參數配置化（volatility_thresholds, rigidity_weight）
- ✅ 補強了缺失值防禦（Rigidity 預設為 0）
- ✅ 補強了可觀測性（Debug Payload / _meta 欄位）
- ✅ 提供了策略模式的實作指示

**寫入位置**：`docs/adr/ADR_0005_vector_state_scoring_engine.md`

---

### 2. 決策 2：風險鏈結構整合

**符合度**：✅ **90% 符合**

**符合的部分**：
- ✅ 選擇「映射整合」策略，符合追問包中的選項 A
- ✅ 明確了 A/B Framework 與三層結構的關係（內外分離）
- ✅ 提供了三層結構 × A/B 映射表
- ✅ 定義了 Facet JSON 強制格式
- ✅ 明確了呈現序列（UI 不可調整）

**寫入位置**：`docs/adr/ADR_0005_vector_state_scoring_engine.md`（與決策 1 合併）

---

### 3. 架構原則和實作指導

**符合度**：✅ **100% 符合**

**符合的部分**：
- ✅ 架構原則清晰（向後相容、向前開放）
- ✅ 程式實作指示明確（策略模式）
- ✅ 後續行動清單完整

---

## ⚠️ 需要追問的部分

### 1. Rigidity Index 的具體計算公式

**問題**：
- 文件中提到「映射邏輯」：`INTERNAL/MIXED → Low/Medium`，`EXTERNAL_FATE → High`
- 但沒有明確說明如何將 `Low/Medium/High` 轉換為數值（0.0-1.0 或具體係數）
- 數學公式中提到 `Rigidity × 0.1`，但 Rigidity 的數值範圍未定義

**追問內容**：
1. Rigidity Index 的數值範圍是什麼？（0.0-1.0？還是 0/1/2？）
2. `Low/Medium/High` 如何映射到具體數值？
3. 是否需要考慮 `attribution_profile.subtype`（如 OVERLOAD vs DEFICIT）？

**影響**：如果沒有明確的數值定義，實作時會產生歧義

---

### 2. Volatility Index 的計算細節

**問題**：
- 文件中提到 `StdDev(normalized_answers)`
- 但沒有明確說明 `normalized_answers` 的具體定義：
  - 是每個答案的標準化值（0.0-1.0）？
  - 還是答案的原始值？
  - 標準化的方式是什麼？

**追問內容**：
1. `normalized_answers` 的具體計算方式？
2. 是否需要考慮不同題目的權重？
3. 標準差的計算是否包含所有題目，還是只包含特定類型的題目？

**影響**：計算方式不明確會導致不同實作產生不同結果

---

### 3. Debug Payload 的完整結構定義

**問題**：
- 文件中提到「Output JSON 必須包含 `_meta` 欄位記錄 Raw Score, Volatility, Rigidity」
- 但沒有提供完整的 JSON Schema 定義
- 沒有說明 `_meta` 欄位的具體結構

**追問內容**：
1. `_meta` 欄位的完整結構是什麼？
2. 是否需要記錄其他中間態數據（如每個題目的分數、權重調整後的數值等）？
3. `_meta` 欄位是否應該對使用者隱藏（僅供開發者調試）？

**影響**：如果結構不明確，不同實作可能產生不同格式的 Debug 數據

---

### 4. 與現有 L1-L4 分層架構的整合說明

**問題**：
- 文件中提到的「Level 1/2/3」是風險鏈的三層結構（身/事/局）
- 但現有系統有「L1-L4 分層架構」（結果呈現：Hexagram Visual, Root Narrative, Flow Analysis, Action & Risk）
- 文件中沒有明確說明這兩者的關係

**追問內容**：
1. 風險鏈的 Level 1/2/3 如何對應到結果呈現的 L1-L4？
2. 風險鏈的內容應該放在 L4（Action & Risk）中嗎？
3. 是否需要調整現有的 L1-L4 結構來容納三層風險鏈？

**影響**：如果關係不明確，UI 實作時可能產生混淆

---

### 5. 參數配置化的預設值處理

**問題**：
- 文件中提到 `volatility_thresholds: [0.15, 0.35]` 和 `rigidity_weight: 0.1` 可配置
- 但沒有說明如果 Facet 沒有提供 `params` 時，應該使用什麼預設值

**追問內容**：
1. 如果 Facet 沒有提供 `params`，是否使用文件中提到的預設值？
2. 預設值是否應該定義在引擎層級（而非 Facet 層級）？
3. 是否需要建立一個「全局預設參數」的配置文件？

**影響**：如果預設值處理不明確，可能導致不同 Facet 使用不同的預設值

---

## 📝 寫入策略

### 策略 1：直接寫入符合的部分

**寫入位置**：`docs/adr/ADR_0005_vector_state_scoring_engine.md`

**寫入內容**：
1. ✅ 決策背景總結
2. ✅ 決策 1：運算模型升級策略（95% 符合）
3. ✅ 決策 2：風險鏈結構整合（90% 符合）
4. ✅ 架構原則和實作指導
5. ✅ 後續行動清單

**狀態標記**：
- 所有內容標記為 `LOCKED · EXECUTABLE · AUDIT-SAFE`
- 明確標註哪些部分需要後續追問確認

---

### 策略 2：建立追問包（需追問的部分）

**追問包位置**：`docs/task_packets/advisor/ENGINE_CORE_LOGIC_V3_ADR_QUESTIONS.md`

**追問內容**：
1. ⚠️ Rigidity Index 的具體計算公式
2. ⚠️ Volatility Index 的計算細節
3. ⚠️ Debug Payload 的完整結構定義
4. ⚠️ 與現有 L1-L4 分層架構的整合說明
5. ⚠️ 參數配置化的預設值處理

---

## 🎯 建議執行順序

1. **立即執行**：寫入符合的部分到 `docs/adr/ADR_0005_vector_state_scoring_engine.md`
2. **建立追問包**：為需追問的部分建立追問包（包含完整背景資料）
3. **更新任務記錄**：記錄審核結果和後續行動

---

**審核完成時間**：2026-01-12  
**審核者**：Cursor（總指揮）
