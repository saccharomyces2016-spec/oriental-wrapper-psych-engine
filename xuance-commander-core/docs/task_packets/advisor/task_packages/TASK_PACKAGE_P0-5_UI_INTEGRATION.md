# TASK_PACKAGE_P0-5_UI_INTEGRATION（P0-5 最小 UI 串接任務包）

**完整任務包**（包含所有必要背景資料）  
**生成時間**：2026-01-09  
**版本**：v1.0  
**批准狀態**：待總指揮批准

---

## 任務資訊
- **Phase**: P0-5 Minimal UI Integration
- **任務性質**: 技術實作任務（非內容創作、非設計優化）
- **優先級**: P0（主線任務）
- **預計時程**: 待定（取決於實作複雜度）

---

## 任務目標（一句話）
建立世界級水準的 UI 串接，能夠收集使用者資訊、展示五行命理世界觀、讀取 compiled facet（`income_expansion_pressure` 和 `relationship_imbalance`），並以豐富的動畫和視覺化方式呈現敘事、建議與風險鏈，驗證端到端流程可運作，達到「全人類、全年齡、全困擾、全困境」的終極目標。

### 預期成果
- ✅ 能夠讀取 compiled facet JSON
- ✅ 能夠正確顯示問題、結果、敘事、建議、風險鏈
- ✅ 能夠正確處理錯誤情況
- ✅ 端到端流程可運作

### 成功定義（不可模糊）
- ✅ 能夠讀取 compiled facet JSON（`income_expansion_pressure` 和 `relationship_imbalance`）
- ✅ 能夠正確顯示問題（questions）
- ✅ 能夠正確顯示結果（narrative、recommendations、risk chains）
- ✅ 能夠正確處理錯誤情況（無法讀取、解析失敗）
- ✅ 端到端流程可運作（從輸入到顯示完整流程）

---

## 項目歷史摘要（簡要版本）

### 最近完成的任務（最近 3-5 個）

#### P0-4 Facet Portability & Stress Test（已完成）
- **狀態**：✅ READY_TO_FREEZE
- **完成日期**：2026-01-09
- **關鍵成果**：
  - 驗證 P0-3 結構可在 `relationship_imbalance` Facet 上零改動搬移
  - R2 交付：主隱喻「月相潮汐・盈虛觀」+ 次隱喻白名單
  - R4 交付：禁用詞擴充 + L4 高風險出口模板
- **詳細記錄**：見 `P0-4/P0-4_FREEZE_READINESS.md`

#### P0-3 Narrative Sharpness / Esoteric Precision（已完成）
- **狀態**：✅ READY_TO_FREEZE
- **完成日期**：2026-01-09
- **關鍵成果**：
  - 為 `income_expansion_pressure` 建立完整的敘事骨架與安全邊界
  - R1 交付：敘事銳利度指標 M1–M4 + Critical Fail 規則
  - R2 交付：L1–L4 敘事骨架 + 次隱喻白名單
  - R4 交付：禁用詞表 + L4 高風險出口模板
- **詳細記錄**：見 `P0-3/P0-3_FREEZE_READINESS.md`

#### P0-2 Output Contract（已完成）
- **狀態**：✅ COMPLETED
- **完成日期**：2026-01-07
- **關鍵成果**：定義系統級輸出合約（允許/禁止輸出、抽象層級、翻譯邊界、安全 fallback）

### 關鍵決策點
- **P0-3 決策**：採用「歲時農耕・倉廩觀」作為 `income_expansion_pressure` 的主隱喻
- **P0-4 決策**：採用「月相潮汐・盈虛觀」作為 `relationship_imbalance` 的主隱喻
- **架構決策**：採用「核心引擎穩定、內容外置化、schema 版本化」架構

### 項目整體狀態
- **當前階段**：P0-5（最小 UI 串接）
- **整體完成度**：約 60%（P0-1 到 P0-4 已完成，P0-5 進行中）
- **階段性目標**：完成 MVP（最小可行產品）的端到端流程
- **整體決策脈絡**：先建立核心引擎和內容規範，再建立 UI 串接，最後建立付費/權限策略

### 未來規劃摘要
- **短期任務清單**：
  - P0-5：最小 UI 串接（當前任務）
  - P0-6：最小付費/權限策略（占位，不優化）
- **階段性規劃**：完成 Phase 0 MVP 後，進入 Phase 1（多 Facet 支援、進階 UX 功能）
- **決策點**：P0-5 完成後，評估是否需要調整 UI 架構或數據格式

---

## 背景資料（完整內容）

### 最終目標（系統 North Star）【必須強調】
**核心目標**：
「打造一個以心理學、行為科學與認知結構為底層引擎，
以東方命理、玄學、象數與隱喻作為人類可理解介面，
能夠適用於全世界、全文化、全人類、全問題場景的
解析、引導與連鎖互動系統。」

**關鍵特徵**：
- ✅ **世界級水準**：必須達到世界級水準，能夠接軌國際市場
- ✅ **全人類**：能夠服務所有使用者（不同年齡、性別、文化背景）
- ✅ **全年齡**：能夠服務所有年齡層的使用者
- ✅ **全困擾**：能夠處理各種困擾問題
- ✅ **全困境**：能夠處理各種困境場景
- ✅ **全文化**：能夠適應不同文化背景的使用者
- ✅ **全問題場景**：能夠處理各種問題場景

**這不是一個簡單的原型或 MVP，而是一個具有崇高理想的世界級產品。**

### 專案目標
- **主目標**：打造可長期運作、可維護、可收費、可持續擴充的**世界級**互動式網頁產品
- **核心策略**：核心引擎可審計；外層以東方命理敘事呈現；對使用者提供可執行建議與風險鏈
- **品質要求**：必須達到世界級水準（質感、互動、敘事、穩定、可維護）
- **市場定位**：可直接接軌國際市場，支援 CN/EN 雙語切換

### 不可觸碰限制
1. 主進度/主目標以文本為準，不以對話上下文為準
2. 未寫入文本的結論視為不存在
3. 任何結構性變更（schema/domain/governance/charter）必須 ADR + 使用者批准
4. 指揮官必須白話回報、短句直白

### 成功定義（必須達成）
本專案在**使用者的認知與體驗中**，是一個**完整的玄學系統**。

使用者只會、也只需要感知到：
- 這是一個玄學網站
- 這是一套命理／神秘系統
- 這個系統非常準
- 這個系統對自己很有幫助

使用者**不需要、也不應該**被告知：
- 任何心理學名詞
- 任何現代科學背景
- 任何「其實這不是玄學」的說明

### 相關文件路徑和內容摘要

#### P0-3 輸出文件
- **主隱喻**：`docs/domain/advisory/R2/P0-3_SECONDARY_METAPHOR_WHITELIST.md`
  - 主隱喻：歲時農耕・倉廩觀
  - 次隱喻白名單和機器化檢查規則
- **禁用詞表**：`docs/domain/advisory/R4/P0-3_NARRATIVE_BLACKLIST_SSOT.json`
  - 機器可讀的禁用詞表（JSON 格式）
- **L4 高風險出口模板**：`docs/domain/advisory/R4/P0-3_L4_HIGH_RISK_EXIT_TEMPLATES.md`
  - 模板 A：過熱/強耕/過度消耗場景
  - 模板 B：枯竭/絕望/資源見底場景

#### P0-4 輸出文件
- **主隱喻**：`docs/domain/advisory/R2/P0-4_SECONDARY_METAPHOR_WHITELIST.md`
  - 主隱喻：月相潮汐・盈虛觀
  - 次隱喻白名單和機器化檢查規則
- **禁用詞表**：`docs/domain/advisory/R4/P0-4_NARRATIVE_BLACKLIST_SSOT.json`
  - 機器可讀的禁用詞表（JSON 格式）
- **L4 高風險出口模板**：`docs/domain/advisory/R4/P0-4_L4_HIGH_RISK_EXIT_TEMPLATES.md`
  - 模板 A：過熱/衝突/劇烈消耗場景
  - 模板 B：枯竭/冷凍/失去連結場景

#### 現狀分析
- **當前狀態**：
  - P0-3 和 P0-4 已完成，提供了完整的 Facet 定義和輸出規範
  - 已有 prototype 目錄（`xuance-commander-core/prototype/`），包含基本的 HTML/CSS/JS 結構
  - 需要建立從 compiled facet 到 UI 顯示的完整流程
- **已完成項目**：
  - ✅ 兩個 Facet 的完整定義（`income_expansion_pressure` 和 `relationship_imbalance`）
  - ✅ 敘事骨架和安全邊界（L1–L4 cadence、禁用詞表、L4 高風險出口模板）
  - ✅ 基本的 prototype 結構
- **待完成項目**：
  - ❌ UI 串接規格文件
  - ❌ 最小 UI 實作
  - ❌ 端到端測試規格
  - ❌ 數據綁定邏輯

#### 相關任務
- **上游任務**：P0-3（提供 `income_expansion_pressure` 的完整輸出）、P0-4（提供 `relationship_imbalance` 的完整輸出）
- **下游任務**：P0-6（最小付費/權限策略，占位）
- **並行任務**：無

---

## 任務內容（必須逐條符合）

### 1. 分析現有 Prototype 結構與設計需求
**要求**：
- 檢查 `xuance-commander-core/prototype/` 目錄的現有結構
- 分析現有的 HTML/CSS/JS 代碼
- 閱讀 `docs/domain/design/P0-5_UI_DESIGN_REQUIREMENTS.md`（UI 設計需求文件）
- 識別需要修改或擴充的部分
- **特別注意**：需要實作使用者資訊收集、開場動畫、世界觀說明、轉場動畫、豐富的結果呈現

**交付物**：
- 分析報告（簡要，1-2 頁）
- 設計方案（如何實作上述功能）

### 2. 定義 Compiled Facet JSON 結構
**要求**：
- 定義 compiled facet 的 JSON 結構（包含問題、結果、敘事、建議、風險鏈）
- 確保結構能夠支援 `income_expansion_pressure` 和 `relationship_imbalance` 兩個 Facet
- 提供 JSON Schema 或範例文件

**交付物**：
- `P0-5/P0-5_COMPILED_FACET_SCHEMA.json`（JSON Schema）
- `P0-5/P0-5_COMPILED_FACET_EXAMPLE.json`（範例文件）

### 3. 建立 UI 串接規格文件
**要求**：
- 定義輸入格式（compiled facet JSON 結構）
- 定義輸出格式（UI 顯示結構）
- 定義數據流（從 compiled facet 到 UI 顯示的完整流程）
- 定義錯誤處理（無法讀取或解析失敗時的處理方式）

**交付物**：
- `P0-5/P0-5_UI_INTEGRATION_SPEC.md`

### 4. 實作完整 UI（包含所有設計要素）
**要求**：
- **使用者資訊收集**：
  - 實作性別、姓名、出生年月日的收集表單
  - 實作表單驗證和錯誤處理
- **開場動畫與世界觀說明**：
  - 實作五行命理概念的動畫說明
  - 實作世界觀的文字和視覺說明
- **困境選擇與轉場動畫**：
  - 實作困境選擇 UI（顯示可用的 Facet）
  - 實作轉場動畫（從選擇到問題、從問題到結果）
- **問題顯示（重要：必須支持題型擴充）**：
  - 實作問題顯示組件（**必須模組化，支持未來替換**）
  - 實作答案收集邏輯（**必須抽象化，不依賴特定題型**）
  - **當前實作**：使用基礎的單選/多選形式（符合 ADR_0006）
  - **架構要求**：必須建立抽象接口（QuestionRenderer、AnswerCollector），支持未來切換到八卦盤等創新 UI
  - **詳細說明**：見 `docs/domain/design/P0-5_QUESTION_MODALITY_EXTENSIBILITY.md`
- **豐富的結果呈現**：
  - 實作能夠讀取 compiled facet JSON 的邏輯
  - 實作結果顯示組件（敘事、建議、風險鏈）
  - 實作視覺化、分層、互動的結果呈現
  - 實作個人化稱呼（使用收集的姓名）
- **錯誤處理**：
  - 實作錯誤處理邏輯
  - 實作無法讀取或解析失敗時的處理方式

**交付物**：
- 更新的 `xuance-commander-core/prototype/` 文件
- `P0-5/P0-5_UI_IMPLEMENTATION.md`（實作說明文件）
- **必須包含**：題型可擴充性設計說明（如何支持未來切換到八卦盤等創新 UI）

### 5. 建立端到端測試規格
**要求**：
- 定義測試場景（正常流程、錯誤處理、邊界情況）
- 定義測試數據（使用 P0-3 和 P0-4 的 golden test 數據）
- 定義驗收標準（UI 必須正確顯示的內容）

**交付物**：
- `P0-5/P0-5_E2E_TEST_SPEC.md`

### 6. 執行端到端測試
**要求**：
- 使用測試數據執行端到端測試
- 驗證 UI 正確顯示所有內容
- 驗證錯誤處理邏輯正確運作

**交付物**：
- 測試報告（簡要，1-2 頁）

---

## 約束條件

### 硬性限制（已更新）
- ✅ **必須優化視覺設計**：UI 必須達到世界級水準的視覺質感
- ✅ **必須實作動畫效果**：UI 必須包含開場動畫、轉場動畫、結果呈現動畫
- ✅ **必須收集使用者資訊**：必須收集性別、姓名、出生年月日
- ✅ **必須實作世界觀說明**：必須在開始時展示五行命理概念和世界觀
- ✅ **必須實作困境選擇 UI**：必須讓使用者選擇要解決的困境問題
- ✅ **必須豐富的結果呈現**：結果必須以視覺化、分層、互動的方式呈現
- ❌ **不實作用戶認證**：P0-5 不需要用戶登入或註冊功能（可選）
- ❌ **不實作付費功能**：P0-5 僅占位，不實作付費功能
- ❌ **不優化響應式設計**：P0-5 優先考慮桌面瀏覽器，響應式設計可後續優化

### 參考規範
- **P0-3 輸出規範**：見 `P0-3/P0-3_HANDOFF_SUMMARY.md`
- **P0-4 輸出規範**：見 `P0-4/P0-4_HANDOFF_SUMMARY.md`
- **UI 設計需求**：見 `docs/domain/design/P0-5_UI_DESIGN_REQUIREMENTS.md`（**必須閱讀**）
- **題型可擴充性設計**：見 `docs/domain/design/P0-5_QUESTION_MODALITY_EXTENSIBILITY.md`（**必須閱讀**）
- **題型設計範圍鎖定**：見 `docs/adr/ADR_0006_question_modality_scope_lock.md`（P0-2 期間禁止創新 UI，但保留未來設計空間）
- **治理規範**：見 `docs/governance/` 目錄
- **世界級水準要求**：見 `docs/adr/ADR_0003_world_class_bilingual_global_market.md`

### 禁區
- ❌ 不得暴露內部結構（severity、coping、attribution 等內部欄位名）
- ❌ 不得使用現代心理/醫療/法律/管理術語（必須使用玄學語感）
- ❌ 不得下具體決策指令（分手/離婚/搬家/提告/就醫/投資等）

---

## 資源需求

### 需要哪些顧問師
- **R2（玄學敘事顧問）**：可能需要協助設計世界觀說明的文案
- **R5（CN/EN 原生語感校對）**：可能需要協助確保多語言版本的文案品質
- **可選**：如果副指揮官認為需要其他顧問師支援，可以提出請求

### 需要哪些文件
- **UI 設計需求**：`docs/domain/design/P0-5_UI_DESIGN_REQUIREMENTS.md`（**必須閱讀**）
- **P0-3 和 P0-4 的輸出文件**：見「相關文件路徑和內容摘要」
- **現有的 prototype 文件**：`xuance-commander-core/prototype/`
- **世界級水準要求**：`docs/adr/ADR_0003_world_class_bilingual_global_market.md`
- **最終目標**：`FULL/NORTH_STAR.md`

### 需要哪些工具
- 文本編輯器（用於編寫代碼和文件）
- 瀏覽器（用於測試 UI）
- JSON 驗證工具（用於驗證 compiled facet JSON 結構）

---

## 優先級與時程

### 優先級
- **P0**：主線任務，必須完成

### 預計時程
- **待定**：取決於實作複雜度和可用時間

### 依賴關係
- **前置任務**：P0-3（已完成）、P0-4（已完成）
- **後續任務**：P0-6（最小付費/權限策略，占位）

---

## 必要的快照內容（簡要版本）

### 最終目標（核心內容）
「打造一個以心理學、行為科學與認知結構為底層引擎，
以東方命理、玄學、象數與隱喻作為人類可理解介面，
能夠適用於全世界、全文化、全人類、全問題場景的
解析、引導與連鎖互動系統。」

### 角色定位（核心職責）
- **總指揮 + 總工程師（Cursor）**：
  - 掌控總進度和所有任務的達成情況
  - 以最終目標為最上層概念，決定接下來該做什麼
  - 產出任務包，分派給副指揮官或顧問師
  - 接收輸出，將資料寫入正確位置，做好分類和管理
  - 擁有完整代碼庫可見性，負責所有代碼與文件結構相關的決策

- **副指揮官（GPT）**：
  - 執行總指揮產出的任務包
  - 提供專業意見和建議
  - 審核顧問師的輸出
  - 可以提出需要哪些顧問師支援

### 基本制度規範（摘要版本）
- **文件寫入位置規則**：所有文件必須寫入 Canon 路徑（`xuance-commander-core/` 下）
- **任務包執行規則**：副指揮官必須根據任務包內容執行任務，不得自行修改任務範圍
- **顧問師使用規範**：顧問師輸出必須經過總指揮審核後才能寫入正式文件

---

## 驗收標準

### 必須通過的驗收標準（阻斷封板）
- ✅ **使用者資訊收集**：能夠收集性別、姓名、出生年月日
- ✅ **開場動畫與世界觀說明**：能夠展示五行命理概念和世界觀
- ✅ **困境選擇**：能夠讓使用者選擇要解決的困境問題
- ✅ **轉場動畫**：能夠在關鍵轉場點展示動畫效果
- ✅ **問題顯示**：能夠正確顯示問題（questions）
- ✅ **結果呈現**：能夠以豐富、視覺化、分層、互動的方式顯示結果（narrative、recommendations、risk chains）
- ✅ **個人化**：能夠使用收集的姓名進行個人化稱呼
- ✅ **多語言支援**：能夠支援 CN/EN 切換
- ✅ **世界級水準**：UI 必須達到世界級水準的質感
- ✅ **錯誤處理**：能夠正確處理錯誤情況（無法讀取、解析失敗）
- ✅ **端到端流程**：端到端流程可運作（從使用者資訊收集 → 世界觀說明 → 困境選擇 → 問題回答 → 結果顯示）

### 驗收檢查清單
- [ ] `docs/domain/design/P0-5_UI_DESIGN_REQUIREMENTS.md` 已閱讀並理解
- [ ] `P0-5/P0-5_UI_INTEGRATION_SPEC.md` 已創建
- [ ] `P0-5/P0-5_COMPILED_FACET_SCHEMA.json` 已創建
- [ ] `P0-5/P0-5_COMPILED_FACET_EXAMPLE.json` 已創建
- [ ] `P0-5/P0-5_UI_IMPLEMENTATION.md` 已創建
- [ ] `P0-5/P0-5_E2E_TEST_SPEC.md` 已創建
- [ ] 更新的 `xuance-commander-core/prototype/` 文件已實作
- [ ] **使用者資訊收集功能**已實作
- [ ] **開場動畫與世界觀說明**已實作
- [ ] **困境選擇 UI**已實作
- [ ] **轉場動畫**已實作
- [ ] **豐富的結果呈現**已實作
- [ ] **多語言支援（CN/EN）**已實作
- [ ] 端到端測試已執行並通過
- [ ] UI 能夠正確顯示 P0-3 和 P0-4 的輸出
- [ ] UI 達到世界級水準的質感

---

## 注意事項

### 關鍵提醒
1. **遵循最終目標（North Star）**：
   - **這不是一個簡單的原型，而是一個具有崇高理想的世界級產品**
   - 必須達到「全人類、全年齡、全困擾、全困境」的目標
   - 必須達到世界級水準，能夠接軌國際市場

2. **遵循 P0-3 和 P0-4 的輸出規範**：
   - UI 必須正確顯示敘事、建議、風險鏈
   - UI 不得暴露內部結構（severity、coping、attribution 等）
   - UI 必須使用玄學語感，不得使用現代術語

3. **必須實作所有設計要素**：
   - **使用者資訊收集**：性別、姓名、出生年月日
   - **開場動畫與世界觀說明**：五行命理概念、世界觀說明
   - **困境選擇 UI**：讓使用者選擇要解決的困境問題
   - **轉場動畫**：關鍵轉場點的動畫效果
   - **豐富的結果呈現**：視覺化、分層、互動的結果呈現

4. **題型可擴充性設計（重要）**：
   - **當前實作**：P0-5 使用基礎的單選/多選形式（符合 ADR_0006）
   - **架構要求**：必須建立抽象接口（QuestionRenderer、AnswerCollector），支持未來切換到八卦盤等創新 UI
   - **數據層與呈現層分離**：compiled facet JSON 結構獨立於 UI 呈現方式
   - **未來擴充**：架構必須支持未來無縫切換到八卦盤、符號多選等創新 UI，不影響現有功能
   - **詳細說明**：見 `docs/domain/design/P0-5_QUESTION_MODALITY_EXTENSIBILITY.md`

5. **世界級水準要求**：
   - UI 必須達到世界級水準的質感
   - 動畫必須流暢、自然
   - 視覺設計必須專業、可信
   - 必須支援 CN/EN 雙語切換

6. **錯誤處理**：
   - UI 必須能夠處理無法讀取或解析失敗的情況
   - 錯誤訊息必須符合「純玄學體驗」要求

7. **顧問師支援**：
   - 如果需要協助設計世界觀說明的文案，可以請求 R2 顧問師支援
   - 如果需要確保多語言版本的文案品質，可以請求 R5 顧問師支援
   - **副指揮官應該主動提出需要哪些顧問師支援**

---

## 常見問題（FAQ）

### Q1: 如果 compiled facet JSON 結構與現有 prototype 不匹配怎麼辦？
**A**: 需要調整 prototype 的代碼，使其能夠正確讀取和顯示新的 JSON 結構。如果結構差異太大，可能需要重新設計數據綁定邏輯。

### Q2: 如果 UI 無法正確顯示某些內容怎麼辦？
**A**: 需要檢查數據綁定邏輯和 UI 組件，確保能夠正確處理所有類型的內容。如果問題持續，可能需要調整 JSON 結構或 UI 組件。

### Q3: 如果端到端測試失敗怎麼辦？
**A**: 需要分析測試失敗的原因，修正相關代碼或規格，然後重新執行測試。

---

## 聯繫方式

### 總指揮（Cursor）
- **角色**：總指揮 + 總工程師（Commander-in-Chief + Chief Engineer）
- **職責**：產出任務包、接收輸出、將資料寫入正確位置、驗證驗收標準

### 副指揮官（GPT）
- **角色**：副指揮官（Deputy Commander）
- **職責**：執行任務包、提供專業意見和建議、審核顧問師的輸出

---

## 狀態更新

### 當前狀態
- **任務狀態**：OPEN（等待副指揮官執行）
- **最後更新**：2026-01-09

---

**任務包生成時間**：2026-01-09  
**任務包版本**：v1.0  
**任務包狀態**：待總指揮批准

