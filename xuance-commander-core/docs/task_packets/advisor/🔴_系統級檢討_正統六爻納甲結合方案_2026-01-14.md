# ğŸ”´ ç³»çµ±ç´šæª¢è¨ï¼šæ­£çµ±å…­çˆ»ç´ç”²çµåˆæ–¹æ¡ˆ

**å»ºç«‹æ—¥æœŸ**ï¼š2026-01-14  
**ä»»å‹™æ€§è³ª**ï¼šğŸ”´ CRITICAL - å®Œæ•´ç³»çµ±é‡æ§‹  
**ç›®çš„**ï¼šæ ¹æ“š GPT æä¾›çš„æ­£çµ±å…­çˆ»ç´ç”²ç¨‹åºï¼Œé‡æ–°è¨­è¨ˆæ•´åˆæ–¹æ¡ˆ

---

## ğŸ¯ é—œéµç™¼ç¾ï¼šå…­è¦ªæ˜¯è¨ˆç®—çµæœï¼Œä¸æ˜¯é¸é …ï¼

### âŒ ä¹‹å‰çš„èª¤è§£

æˆ‘ä¹‹å‰èªç‚ºï¼š
```
ä½¿ç”¨è€…é¸æ“‡å…­è¦ª â†’ ğŸ’° è³‡æºèˆ‡é—œä¿‚ï¼ˆå¦»è²¡ï¼‰
ç³»çµ±è¨˜éŒ„ï¼šcontext = SpouseWealth
```

### âœ… GPT çš„æ­£çµ±èªªæ˜

**STEP 6ï½œå…­è¦ªç”Ÿæˆï¼ˆRelative Function Derivationï¼‰**
```
ä¾ã€Œä¸–çˆ»äº”è¡Œã€èˆ‡ã€Œå…¶ä»–çˆ»äº”è¡Œã€çš„ç”Ÿå‰‹é—œä¿‚ï¼Œè‡ªå‹•ç”Ÿæˆå…­è¦ªã€‚

äº”è¡Œé—œä¿‚ â†’ å…­è¦ª
åŒæˆ‘     â†’ å…„å¼Ÿ
æˆ‘ç”Ÿ     â†’ å­å­«
ç”Ÿæˆ‘     â†’ çˆ¶æ¯
æˆ‘å…‹     â†’ å¦»è²¡
å…‹æˆ‘     â†’ å®˜é¬¼

âš ï¸ å…­è¦ªä¸æ˜¯é¸é …ï¼Œæ˜¯è¨ˆç®—çµæœ
```

**STEP 7ï½œç”¨ç¥é¸å–ï¼ˆFocus Target Selectionï¼‰**
```
æ ¹æ“šã€Œå å•ä¸»é¡Œã€ï¼Œæ±ºå®šé€™æ¬¡åˆ†æçš„ä¸»è¦è§€æ¸¬å°è±¡ã€‚
- ä¸»é¡Œ â†’ å°æ‡‰å…­è¦ªé¡å‹
- åœ¨ç›¤ä¸­æ‰¾å‡ºè©²å…­è¦ªæ‰€åœ¨çˆ»
```

**æ ¸å¿ƒé‚è¼¯**ï¼š
1. ä½¿ç”¨è€…åªé¸ã€Œå å•ä¸»é¡Œã€ï¼ˆå•äº‹æ¥­ã€å•æ„Ÿæƒ…...ï¼‰
2. ç³»çµ±æ ¹æ“šèµ·å¦çµæœè¨ˆç®—å‡ºå…­è¦ª
3. ç³»çµ±æ ¹æ“šä¸»é¡Œé¸å–å°æ‡‰çš„ç”¨ç¥

---

## ğŸ“Š ç¾æœ‰è³‡æ–™åº«ç›¤é»

### åº•å±¤å¼•æ“è³‡ç”¢

**Facets**ï¼š23 å€‹
- chronic_depletion, stress_recovery, loss_of_agency...
- æ¯å€‹ Facet æœ‰ scoring.jsonï¼ˆV3 å¼•æ“é…ç½®ï¼‰

**Questions**ï¼š30 å€‹ï¼ˆæ¯å€‹ Facet 7-8 é¡Œï¼‰
- ç¸½é¡Œæ•¸ï¼šç´„ 210 é¡Œ
- é¡å‹ï¼šlikert_5ï¼ˆ4 å€‹é¸é …ï¼‰
- ç¯„ä¾‹ï¼šã€Œä½ æ¯å¤©é†’ä¾†çš„ç¬¬ä¸€å€‹å¿µé ­æ˜¯ï¼Ÿã€

**V3 å¼•æ“**ï¼šscore_facet.py
- è¨ˆç®—é‚è¼¯ï¼šnormalize_0_4, calculate_rigidity
- è¼¸å‡ºï¼šSeverity (0-1), Rigidity, Volatility

**å„ªå‹¢**ï¼š
- âœ… è¨ºæ–·é‚è¼¯æˆç†Ÿ
- âœ… é¡Œç›®å“è³ªé«˜
- âœ… è¦†è“‹åº¦å»£ï¼ˆ23 å€‹ Facetï¼‰

**å•é¡Œ**ï¼š
- âŒ è¡¨é”å½¢å¼æ˜¯å¿ƒç†æ¸¬é©—ï¼ˆABC å››é¸ä¸€ï¼‰
- âŒ ç„¡æ³•ç›´æ¥å°æ‡‰å…­çˆ»ç´ç”²æµç¨‹

---

## ğŸ”„ å®Œå…¨é‡æ–°è¨­è¨ˆçš„çµåˆæ–¹æ¡ˆ

### æ ¸å¿ƒåŸå‰‡

> **å…­çˆ»ç´ç”²æä¾›è¡¨å±¤çµæ§‹ï¼Œç¾ä»£å¼•æ“æä¾›åº•å±¤è¨ºæ–·ï¼Œ
> å…©è€…é€éã€Œç¬¦è™Ÿç›¤å¤šé …é‡åŠ æ¬Šã€å¯¦ç¾ç¥ç§˜ä¸­çš„ç²¾æº–ã€‚**

---

## ğŸ“ ä¹æ­¥æµç¨‹è¨­è¨ˆ

### STEP 0ï¼šå å•ä¸»é¡Œè¨­å®šï¼ˆä½¿ç”¨è€…åƒèˆ‡ï¼‰

**è¡¨å±¤ï¼ˆä½¿ç”¨è€…çœ‹åˆ°çš„ï¼‰**ï¼š
```
ã€å•äº‹ã€‘
è«‹é¸æ“‡ä½ æƒ³äº†è§£çš„é ˜åŸŸï¼š

ğŸ’¼ äº‹æ¥­å‰ç¨‹
ğŸ’° è²¡å¯Œè³‡æº
â¤ï¸ æ„Ÿæƒ…å©šå§»
ğŸ›ï¸ æ¬Šå¨é—œä¿‚
ğŸŒ± å‰µä½œè¡¨é”
```

**åº•å±¤ï¼ˆç³»çµ±è¨˜éŒ„ï¼‰**ï¼š
```python
question_context = {
    "theme": "career",      # äº‹æ¥­å‰ç¨‹
    "yongshen_type": "å®˜é¬¼"  # ç”¨ç¥é¡å‹ï¼ˆè‡ªå‹•å°æ‡‰ï¼‰
}
```

---

### STEP 1ï¼šèµ·å¦ï¼ˆä½¿ç”¨è€…åƒèˆ‡ - ç¬¦è™Ÿç›¤ï¼‰

**è¡¨å±¤ï¼ˆä½¿ç”¨è€…çœ‹åˆ°çš„ï¼‰**ï¼š
```
ã€èµ·å¿ƒå‹•å¿µã€‘

è«‹åœ¨ç¬¦è™Ÿç›¤ä¸­é¸æ“‡ 6 å€‹è§¸å‹•ä½ çš„ç¬¦è™Ÿï¼ˆä¾ç›´è¦ºï¼Œç„¡éœ€æ€è€ƒï¼‰

ç¬¦è™Ÿç›¤ï¼ˆ36 å€‹ç¬¦è™Ÿï¼Œéš¨æ©Ÿæ’åˆ—ï¼‰ï¼š

å›°  æ“¾  è‰±  æ»¯  ç‡ƒ  æ•£  è¡  ç©©  ç©º  å¯¦  å¡  é‡
æ‡¼  è²¬  å…§  åš´  å£“  ç½ª  é€ƒ  å†·  ä¾  æ’  èº²  é¿
ç´¯  ç–²  è€—  æ¯  ç«­  ç™±  éº»  æ‚¶  æ€’  æ¨  æ€¨  ç«
```

**ä½¿ç”¨è€…é»æ“Š 6 æ¬¡**ï¼šå›°ã€å…§ã€åš´ã€å£“ã€ç´¯ã€é€ƒ

**åº•å±¤ï¼ˆç³»çµ±é‹ç®—ï¼‰**ï¼š
```python
# æ¯å€‹ç¬¦è™Ÿæ˜ å°„åˆ°ä¸€å€‹ã€Œçˆ»ã€çš„å±¬æ€§
symbols_to_lines = {
    "å›°": {"yinyang": "yin", "moving": True, "element": "Water"},
    "å…§": {"yinyang": "yin", "moving": False, "element": "Earth"},
    "åš´": {"yinyang": "yang", "moving": True, "element": "Metal"},
    "å£“": {"yinyang": "yin", "moving": False, "element": "Earth"},
    "ç´¯": {"yinyang": "yin", "moving": False, "element": "Water"},
    "é€ƒ": {"yinyang": "yin", "moving": True, "element": "Wind"}
}

# ç”Ÿæˆå…­çˆ»çµæ§‹
hexagram_lines = [
    {"position": 1, "yin_yang": "yin", "moving": True, "element": "Water"},  # å›°
    {"position": 2, "yin_yang": "yin", "moving": False, "element": "Earth"}, # å…§
    {"position": 3, "yin_yang": "yang", "moving": True, "element": "Metal"}, # åš´
    {"position": 4, "yin_yang": "yin", "moving": False, "element": "Earth"}, # å£“
    {"position": 5, "yin_yang": "yin", "moving": False, "element": "Water"}, # ç´¯
    {"position": 6, "yin_yang": "yin", "moving": True, "element": "Wind"}    # é€ƒ
]

# åŒæ™‚è¨ˆç®—åˆæ­¥ Severityï¼ˆå¤šé …é‡åŠ æ¬Šï¼‰
severity_weights = [0.7, 0.6, 0.8, 0.7, 0.6, 0.6]  # æ¯å€‹ç¬¦è™Ÿçš„æ¬Šé‡
initial_severity = mean(severity_weights) = 0.67
```

**UI å‘ˆç¾**ï¼š
- å…­çˆ»åœ–åƒç·©æ…¢é¡¯åŒ–ï¼ˆå¾ä¸‹åˆ°ä¸Šï¼‰
- å‹•çˆ»ç™¼å…‰ï¼ˆå›°ã€åš´ã€é€ƒä¸‰å€‹ç¬¦è™Ÿå°æ‡‰çš„çˆ»ï¼‰

**é—œéµé­”è¡“**ï¼š
- âœ… ä½¿ç”¨è€…åªé¸äº† 6 å€‹å­—
- âœ… ç³»çµ±å»ç”Ÿæˆäº†å®Œæ•´çš„å…­çˆ»å¦è±¡
- âœ… åŒæ™‚è¨ˆç®—äº† Severityï¼ˆä½¿ç”¨è€…ä¸çŸ¥é“ï¼‰

---

### STEP 2ï¼šè®Šå¦ç”Ÿæˆï¼ˆç³»çµ±è‡ªå‹•ï¼‰

**ç³»çµ±é‹ç®—**ï¼š
```python
# å°‡å‹•çˆ»åè½‰
changed_hexagram = transform_moving_lines(hexagram_lines)
# ä½ç½® 1, 3, 6 çš„çˆ»åè½‰é™°é™½
```

**UI å‘ˆç¾**ï¼š
- å‹•çˆ»ç·©æ…¢è®ŠåŒ–ï¼ˆé™°è®Šé™½ï¼Œé™½è®Šé™°ï¼‰
- é¡¯ç¤ºã€Œæœ¬å¦ â†’ è®Šå¦ã€

---

### STEP 3ï¼šæ‹†å¦ï¼ˆç³»çµ±è‡ªå‹•ï¼‰

**ç³»çµ±é‹ç®—**ï¼š
```python
lower_trigram = lines[0:3]  # åˆçˆ»ï½ä¸‰çˆ»
upper_trigram = lines[3:6]  # å››çˆ»ï½ä¸Šçˆ»

# è­˜åˆ¥å…«å¦
lower_bagua = identify_trigram(lower_trigram)  # ä¾‹å¦‚ï¼šå
upper_bagua = identify_trigram(upper_trigram)  # ä¾‹å¦‚ï¼šè‰®

# å¾—åˆ° 64 å¦
hexagram_64 = get_hexagram_id(lower_bagua, upper_bagua)  # ä¾‹å¦‚ï¼šå±±æ°´è’™
```

---

### STEP 4ï¼šç´ç”²ï¼ˆç³»çµ±è‡ªå‹•ï¼‰

**ç³»çµ±é‹ç®—**ï¼š
```python
# æ ¹æ“šå…«å¦ï¼Œåˆ†é…åœ°æ”¯å’Œäº”è¡Œ
line_meta = assign_najia(lower_bagua, upper_bagua)

# ç¯„ä¾‹è¼¸å‡º
[
  {"position": 1, "branch": "å­", "element": "Water"},
  {"position": 2, "branch": "å¯…", "element": "Wood"},
  ...
]
```

---

### STEP 5ï¼šä¸–æ‡‰çˆ»ï¼ˆç³»çµ±è‡ªå‹•ï¼‰

**ç³»çµ±é‹ç®—**ï¼š
```python
# æ ¹æ“šå¦å®®è¦å‰‡ï¼Œç¢ºå®šä¸–æ‡‰çˆ»ä½ç½®
shi_line = determine_shi_line(hexagram_64)  # ä¾‹å¦‚ï¼šç¬¬ 3 çˆ»
ying_line = determine_ying_line(shi_line)   # ä¾‹å¦‚ï¼šç¬¬ 6 çˆ»

# ä¸–çˆ»äº”è¡Œ
shi_element = line_meta[shi_line]["element"]  # ä¾‹å¦‚ï¼šMetal
```

---

### STEP 6ï¼šå…­è¦ªç”Ÿæˆï¼ˆç³»çµ±è‡ªå‹•ï¼Œé—œéµï¼ï¼‰

**ç³»çµ±é‹ç®—**ï¼š
```python
# ä»¥ä¸–çˆ»äº”è¡Œç‚ºåŸºæº–ï¼Œè¨ˆç®—æ¯ä¸€çˆ»çš„å…­è¦ª
six_kin = {}
for line in line_meta:
    line_element = line["element"]
    relation = wuxing_relation(shi_element, line_element)
    
    if relation == "same":
        six_kin[line["position"]] = "å…„å¼Ÿ"
    elif relation == "i_å…‹":
        six_kin[line["position"]] = "å¦»è²¡"
    elif relation == "å…‹_i":
        six_kin[line["position"]] = "å®˜é¬¼"
    elif relation == "i_ç”Ÿ":
        six_kin[line["position"]] = "å­å­«"
    elif relation == "ç”Ÿ_i":
        six_kin[line["position"]] = "çˆ¶æ¯"

# ç¯„ä¾‹è¼¸å‡º
{
  1: "çˆ¶æ¯",
  2: "å…„å¼Ÿ",
  3: "å®˜é¬¼",  # ä¸–çˆ»
  4: "å¦»è²¡",
  5: "å­å­«",
  6: "çˆ¶æ¯"   # æ‡‰çˆ»
}
```

**é—œéµ**ï¼š
- âœ… å…­è¦ªå®Œå…¨æ˜¯è¨ˆç®—çµæœ
- âœ… ä¸éœ€è¦ä½¿ç”¨è€…é¸æ“‡
- âœ… ç¬¦åˆæ­£çµ±å…­çˆ»é‚è¼¯

---

### STEP 7ï¼šç”¨ç¥é¸å–ï¼ˆç³»çµ±è‡ªå‹•ï¼‰

**ç³»çµ±é‹ç®—**ï¼š
```python
# æ ¹æ“š STEP 0 çš„å å•ä¸»é¡Œï¼Œé¸å–ç”¨ç¥
theme_to_yongshen = {
    "career": "å®˜é¬¼",    # äº‹æ¥­çœ‹å®˜é¬¼
    "wealth": "å¦»è²¡",    # è²¡é‹çœ‹å¦»è²¡
    "relationship": "å¦»è²¡",  # æ„Ÿæƒ…çœ‹å¦»è²¡
    "authority": "çˆ¶æ¯",  # æ¬Šå¨çœ‹çˆ¶æ¯
    "creativity": "å­å­«"  # å‰µä½œçœ‹å­å­«
}

yongshen_type = theme_to_yongshen[question_context["theme"]]  # "å®˜é¬¼"

# åœ¨å…­è¦ªä¸­æ‰¾åˆ°å®˜é¬¼çˆ»
yongshen_lines = [pos for pos, kin in six_kin.items() if kin == yongshen_type]
# ä¾‹å¦‚ï¼š[3]ï¼ˆç¬¬ 3 çˆ»æ˜¯å®˜é¬¼ï¼‰

# ç”¨ç¥å¼·å¼±ï¼ˆé€£çµåˆ°ç¾ä»£å¼•æ“ï¼‰
yongshen_strength = calculate_yongshen_strength(
    yongshen_lines, 
    severity=initial_severity,  # å¾ç¬¦è™Ÿæ¬Šé‡è¨ˆç®—å‡ºä¾†çš„
    agency=calculate_agency(selected_symbols)  # å¾ç¬¦è™Ÿè¨ˆç®—å‡ºä¾†çš„
)
```

**é€£çµç¾ä»£å¼•æ“**ï¼š
```python
# ç¬¦è™Ÿç›¤é¸æ“‡ â†’ è¨ˆç®— Severity å’Œ Agency
selected_symbols = ["å›°", "å…§", "åš´", "å£“", "ç´¯", "é€ƒ"]

# è¨ˆç®— Severityï¼ˆå¤šé …é‡åŠ æ¬Šï¼‰
severity = mean([sym_db[s]["weight"] for s in selected_symbols])
# = mean([0.7, 0.6, 0.8, 0.7, 0.6, 0.6]) = 0.67

# è¨ˆç®— Attributionï¼ˆæ­¸å› å‚¾å‘ï¼‰
internal = sum([1 for s in selected_symbols if sym_db[s]["attribution"] == "internal"])
external = sum([1 for s in selected_symbols if sym_db[s]["attribution"] == "external"])
attribution_score = internal - external  # 2 - 4 = -2ï¼ˆåå¤–éƒ¨ï¼‰

# è¨ˆç®— Agencyï¼ˆèƒ½å‹•æ€§ï¼‰
action_symbols = [s for s in selected_symbols if s in ["è¡", "æ’", "èº²", "é€ƒ", "é¿"]]
agency = 1.0 - (len(action_symbols) / 6.0)  # é€ƒé¿é¡ç¬¦è™Ÿè¶Šå¤šï¼Œèƒ½å‹•æ€§è¶Šä½
# = 1.0 - (1/6) = 0.83ï¼ˆæœ‰é€ƒï¼Œä½†èƒ½å‹•æ€§é‚„å¯ä»¥ï¼‰
```

---

### STEP 8ï¼šæ™‚é–“æ¬Šé‡è¨ˆç®—ï¼ˆç³»çµ±è‡ªå‹•ï¼‰

**ç³»çµ±é‹ç®—**ï¼š
```python
# ä½¿ç”¨èµ·å¦æ™‚é–“ï¼ˆtimestampï¼‰
timestamp = datetime.now()
month = timestamp.month  # æœˆå»º
day = timestamp.day      # æ—¥è¾°

# è¨ˆç®—æ¯çˆ»çš„å¼·å¼±
line_strength = calculate_time_strength(
    line_meta,
    month,
    day
)

# ç¯„ä¾‹è¼¸å‡º
{
  1: {"level": "weak", "interactions": ["æ²–"]},
  2: {"level": "strong", "interactions": []},
  3: {"level": "medium", "interactions": ["åˆ"]}
}
```

---

### STEP 9ï¼šç¶œåˆåˆ¤è®€ï¼ˆç³»çµ±è‡ªå‹• + AI æ½¤é£¾ï¼‰

**ç³»çµ±é‹ç®—**ï¼š
```python
# æ•´åˆæ‰€æœ‰è³‡è¨Š
inference = {
    "hexagram_id": "å±±æ°´è’™",
    "hexagram_narrative": "åä¸‹è‰®ä¸Šï¼Œè’™æ˜§ä¸æ˜...",
    "state_analysis": {
        "shi_strength": 0.5,        # ä¸–çˆ»ä¸­ç­‰
        "yongshen_strength": 0.3,   # ç”¨ç¥ï¼ˆå®˜é¬¼ï¼‰å¼±
        "moving_lines": [1, 3, 6],  # å‹•çˆ»ä½ç½®
        "severity": 0.67,           # å¾ç¬¦è™Ÿè¨ˆç®—
        "attribution": "external",  # å¾ç¬¦è™Ÿè¨ˆç®—
        "agency": 0.83              # å¾ç¬¦è™Ÿè¨ˆç®—
    },
    "narrative": generate_narrative(...),
    "activities": select_activities(...),
    "riskchain": generate_riskchain(...)
}
```

**AI æ½¤é£¾**ï¼ˆä½¿ç”¨ APIï¼‰ï¼š
```python
# å‚³çµ¦ AI çš„çµæ§‹åŒ–è³‡æ–™
ai_input = {
    "hexagram": "å±±æ°´è’™",
    "context": "career",
    "yongshen": "å®˜é¬¼",
    "yongshen_strength": "weak",
    "moving_lines": [1, 3, 6],
    "severity": 0.67,
    "attribution": "external",
    "selected_symbols": ["å›°", "å…§", "åš´", "å£“", "ç´¯", "é€ƒ"]
}

# AI ç”Ÿæˆçš„æ•˜äº‹ï¼ˆç„å­¸èªå¢ƒï¼‰
ai_output = """
å¦è±¡ï¼šå±±æ°´è’™ã€‚è‰®ä¸Šåä¸‹ï¼Œè’™æ˜§ä¸æ˜ä¹‹è±¡ã€‚

ä½ ç¾åœ¨çš„ç‹€æ…‹ï¼š
å®˜é¬¼æŒä¸–è€Œä¼‘å›šï¼Œäº‹æ¥­ä¹‹è·¯å¦‚å±¥è–„å†°ã€‚ä½ æ„Ÿåˆ°å£“åŠ›ï¼ˆåš´ã€å£“ï¼‰ï¼Œ
å…§åœ¨ä¹Ÿæœ‰è‡ªè²¬ï¼ˆå…§ï¼‰ï¼Œæƒ³è¦é€ƒé›¢ï¼ˆé€ƒï¼‰ï¼Œå»åˆå›°ä½ç„¡æ³•å‹•å½ˆï¼ˆå›°ï¼‰ã€‚

é€™æ˜¯å› ç‚ºï¼š
å¤–åœ¨ç’°å¢ƒå°ä½ éæ–¼è‹›åˆ»ï¼ˆæ­¸å› =externalï¼‰ï¼Œä½ æ—¢æ€•åˆç´¯ï¼Œ
ä½†ä»ä¿æœ‰æ”¹è®Šçš„èƒ½åŠ›ï¼ˆagency=0.83ï¼‰ã€‚

å»ºè­°ï¼š
å®œå®ˆä¸å®œé€²ï¼Œå…ˆå›ºæœ¬åŸ¹å…ƒï¼ˆæ¨è–¦æ´»å‹•ï¼šéœå¿ƒæ•´ç†ã€æ£®æ—æ•£æ­¥ï¼‰ã€‚

é¢¨éšªï¼š
è‹¥ä¸èª¿æ•´ï¼Œææœ‰é€²ä¸€æ­¥è€—ç«­ä¹‹è™ï¼ˆseverity=0.67, rigidity=Lockedï¼‰ã€‚
"""
```

---

## ğŸ¨ å‰ç«¯äº’å‹•è¨­è¨ˆï¼ˆç¬¦è™Ÿç›¤ï¼‰

### ç¬¦è™Ÿç›¤è¨­è¨ˆ

**æ ¸å¿ƒç†å¿µ**ï¼šç”¨ç¬¦è™Ÿç›¤çš„å¤šé …é‡é¸æ“‡ï¼Œå–ä»£ ABC å››é¸ä¸€

**ç•«é¢**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     ã€ç¬¦è™Ÿç›¤ã€‘                â”‚
â”‚                              â”‚
â”‚   è«‹é¸æ“‡ 6 å€‹è§¸å‹•ä½ çš„ç¬¦è™Ÿ     â”‚
â”‚   ï¼ˆç„¡éœ€æ€è€ƒï¼Œæ†‘ç›´è¦ºï¼‰        â”‚
â”‚                              â”‚
â”‚   å›°  æ“¾  è‰±  æ»¯  ç‡ƒ  æ•£      â”‚
â”‚   è¡  ç©©  ç©º  å¯¦  å¡  é‡      â”‚
â”‚   æ‡¼  è²¬  å…§  åš´  å£“  ç½ª      â”‚
â”‚   é€ƒ  å†·  ä¾  æ’  èº²  é¿      â”‚
â”‚   ç´¯  ç–²  è€—  æ¯  ç«­  ç™±      â”‚
â”‚   éº»  æ‚¶  æ€’  æ¨  æ€¨  ç«      â”‚
â”‚                              â”‚
â”‚   å·²é¸ 3/6ï¼šå›° å…§ åš´         â”‚
â”‚                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**äº’å‹•é‚è¼¯**ï¼š
1. ç¬¦è™Ÿç›¤é¡¯ç¤º 36 å€‹ç¬¦è™Ÿï¼ˆå¾ 100 å€‹è¾­è±¡åº«ä¸­éš¨æ©Ÿé¸å–ï¼‰
2. ä½¿ç”¨è€…é»æ“Š 6 å€‹ç¬¦è™Ÿ
3. æ¯é»æ“Šä¸€å€‹ï¼Œç¬¦è™Ÿæ”¾å¤§ä¸¦ç™¼å…‰
4. é¸æ»¿ 6 å€‹å¾Œï¼Œè‡ªå‹•é€²å…¥ä¸‹ä¸€æ­¥

**ç¥ç§˜æ„Ÿç‡Ÿé€ **ï¼š
- âœ… ç¬¦è™Ÿéš¨æ©Ÿæ’åˆ—ï¼ˆæ¯æ¬¡ä¸åŒï¼‰
- âœ… ç„¡éœ€æ€è€ƒï¼ˆæ†‘ç›´è¦ºï¼‰
- âœ… å¤šé …é‡é¸æ“‡ï¼ˆä¸æ˜¯å–®é¸ï¼‰
- âœ… ç„¡å¼·åº¦æ„Ÿï¼ˆä¸æ˜¯é¸ 0-4 åˆ†ï¼‰

---

### å¤šé …é‡åŠ æ¬Šè¨ˆç®—

**ä½¿ç”¨è€…é¸æ“‡**ï¼šå›°ã€å…§ã€åš´ã€å£“ã€ç´¯ã€é€ƒ

**ç³»çµ±è¨ˆç®—**ï¼ˆå¤šå€‹ç¶­åº¦åŒæ™‚è¨ˆç®—ï¼‰ï¼š

#### 1. Severity è¨ˆç®—
```python
weights = [0.7, 0.6, 0.8, 0.7, 0.6, 0.6]
severity = mean(weights) = 0.67
```

#### 2. Attribution è¨ˆç®—
```python
attributions = ["mixed", "internal", "external", "external", "mixed", "internal"]
internal_count = 2
external_count = 2
mixed_count = 2
attribution_score = (internal - external) / 6 = 0
# çµè«–ï¼šæ··åˆæ­¸å› ï¼Œç„¡æ˜é¡¯å‚¾å‘
```

#### 3. äº”è¡Œåˆ†ä½ˆè¨ˆç®—
```python
elements = ["Water", "Earth", "Metal", "Earth", "Water", "Wind"]
element_distribution = {
    "Water": 2,
    "Earth": 2,
    "Metal": 1,
    "Wind": 1
}
# æ°´åœŸè¼ƒå¤š â†’ æ²‰é‡ã€ä¸‹é™·çš„èƒ½é‡æ¨¡å¼
```

#### 4. å…«å¦è¦ªå’ŒåŠ›è¨ˆç®—
```python
bagua_affinity = {
    "Kan": 3,    # å›°ã€ç´¯ã€é€ƒéƒ½è¦ªå’Œå
    "Kun": 2,    # å…§ã€å£“è¦ªå’Œå¤
    "Gen": 1,    # åš´è¦ªå’Œè‰®
    "Qian": 1    # åš´è¦ªå’Œä¹¾
}
# ä¸»è¦å…«å¦ï¼šåï¼ˆWaterï¼‰
```

#### 5. Facet é–å®š
```python
# æ ¹æ“šç¬¦è™Ÿçš„ candidate_facetsï¼Œè¨ˆç®—æœ€å¯èƒ½çš„ Facet
facet_scores = {}
for symbol in selected_symbols:
    for facet in symbol_db[symbol]["candidate_facets"]:
        facet_scores[facet] = facet_scores.get(facet, 0) + 1

# ç¯„ä¾‹è¼¸å‡º
{
    "chronic_depletion": 3,     # å›°ã€ç´¯ã€å£“éƒ½æŒ‡å‘é€™å€‹
    "shame_spiral": 2,          # å…§ã€å£“æŒ‡å‘é€™å€‹
    "avoidance_coping": 2       # é€ƒã€èº²æŒ‡å‘é€™å€‹
}

dominant_facet = "chronic_depletion"
```

**é—œéµé­”è¡“**ï¼š
- âœ… ä½¿ç”¨è€…åªé¸äº† 6 å€‹å­—
- âœ… ç³»çµ±è¨ˆç®—äº† 5 å€‹ç¶­åº¦
- âœ… ç²¾æº–åº¦ä¸ä½æ–¼å‚³çµ± OCTET_8
- âœ… ä½†ä½¿ç”¨è€…å®Œå…¨æ„Ÿå—ä¸åˆ°ã€Œå¿ƒç†æ¸¬é©—ã€

---

## ğŸ¯ å®Œæ•´äº’å‹•æµç¨‹ï¼ˆæœ€çµ‚ç‰ˆï¼‰

### æµç¨‹ç¸½è¦½

```
1. å å•ä¸»é¡Œï¼ˆä½¿ç”¨è€…é¸æ“‡ï¼‰
   ğŸ’¼ äº‹æ¥­å‰ç¨‹
   â†“

2. ç¬¦è™Ÿç›¤èµ·å¦ï¼ˆä½¿ç”¨è€…é¸ 6 å€‹ç¬¦è™Ÿï¼‰
   å›°  å…§  åš´  å£“  ç´¯  é€ƒ
   â†“
   
3. ç³»çµ±è¨ˆç®—ï¼ˆéš±æ€§ï¼‰
   - ç”Ÿæˆå…­çˆ»å¦è±¡
   - è¨ˆç®— Severity, Attribution, Agency
   - é–å®š Facet
   - ç”Ÿæˆå…­è¦ªï¼ˆè‡ªå‹•ï¼‰
   - é¸å–ç”¨ç¥ï¼ˆè‡ªå‹•ï¼‰
   â†“

4. å¦è±¡é¡¯åŒ–ï¼ˆå‹•ç•«ï¼‰
   - å…­çˆ»åœ–åƒæµ®ç¾
   - å‹•çˆ»ç™¼å…‰
   - æœ¬å¦ â†’ è®Šå¦
   â†“

5. è§£è®€å‘ˆç¾
   - å¦åï¼šå±±æ°´è’™
   - å¦è¾­ï¼šåä¸‹è‰®ä¸Šï¼Œè’™æ˜§ä¸æ˜...
   - ç‹€æ…‹åˆ†æï¼šå®˜é¬¼ä¼‘å›šï¼Œäº‹æ¥­å—é˜»...
   - å»ºè­°ï¼šéœå¿ƒæ•´ç†ã€æ£®æ—æ•£æ­¥
   - é¢¨éšªï¼šè‹¥ä¸èª¿æ•´ï¼Œææœ‰é€²ä¸€æ­¥è€—ç«­ä¹‹è™
```

**ç¸½æ™‚é–“**ï¼š5-8 åˆ†é˜  
**ä½¿ç”¨è€…æ“ä½œ**ï¼š2 æ¬¡ï¼ˆé¸ä¸»é¡Œ + é¸ 6 å€‹ç¬¦è™Ÿï¼‰  
**ç³»çµ±è¨ˆç®—**ï¼š9 æ­¥ï¼ˆå®Œå…¨éš±æ€§ï¼‰

---

## ğŸ“Š èˆ‡ç¾æœ‰è³‡æ–™åº«çš„çµåˆ

### ä¿ç•™ä¸¦åˆ©ç”¨ç¾æœ‰è³‡ç”¢

**Facetsï¼ˆ23 å€‹ï¼‰**ï¼š
- âœ… å®Œå…¨ä¿ç•™
- âœ… ä½œç‚º Facet å€™é¸é›†åˆ
- âœ… æ¯å€‹ç¬¦è™Ÿæ˜ å°„åˆ° 1-3 å€‹ Facet

**Questionsï¼ˆ210 é¡Œï¼‰**ï¼š
- âš ï¸ ä¸ç›´æ¥ä½¿ç”¨
- âœ… ä½œç‚ºåƒè€ƒï¼Œæç…‰è¾­è±¡å±¬æ€§
- âœ… ç¯„ä¾‹ï¼šã€Œå……æ»¿ç½ªæƒ¡æ„Ÿï¼Œä¸æ•¢åœä¸‹ä¾†ã€â†’ æç…‰å‡ºã€Œç½ªã€ã€ã€Œæ’ã€ç­‰è¾­è±¡

**V3 å¼•æ“ï¼ˆscore_facet.pyï¼‰**ï¼š
- âœ… å®Œå…¨ä¿ç•™
- âœ… è¨ˆç®—é‚è¼¯ä¸è®Š
- âœ… è¼¸å…¥å¾ã€Œanswersã€è®Šæˆã€Œsymbol_weightsã€

**å„ªå‹¢**ï¼š
- âœ… åº•å±¤è¨ºæ–·é‚è¼¯å®Œå…¨ä¿ç•™ï¼ˆç²¾æº–åº¦ä¸è®Šï¼‰
- âœ… è¡¨å±¤äº’å‹•å®Œå…¨æ”¹è®Šï¼ˆä¸æ˜¯å¿ƒç†æ¸¬é©—ï¼‰
- âœ… ç¾æœ‰è³‡ç”¢å……åˆ†åˆ©ç”¨ï¼ˆFacets, Engineï¼‰

---

## ğŸ› ï¸ æŠ€è¡“å¯¦ä½œé‡é»

### ç¬¦è™Ÿåˆ°è¨ºæ–·çš„æ˜ å°„å¼•æ“

```python
class SymbolDiagnosticEngine:
    def __init__(self):
        self.symbol_db = load_symbol_library()  # 100 å€‹è¾­è±¡
        self.facet_db = load_facet_library()    # 23 å€‹ Facets
        
    def diagnose(self, theme, selected_symbols):
        """
        è¼¸å…¥ï¼šå å•ä¸»é¡Œ + 6 å€‹ç¬¦è™Ÿ
        è¼¸å‡ºï¼šå®Œæ•´è¨ºæ–·çµæœ
        """
        # Step 1: ç”Ÿæˆå…­çˆ»å¦è±¡
        hexagram = self.generate_hexagram(selected_symbols)
        
        # Step 2: è¨ˆç®—è¨ºæ–·ç¶­åº¦
        severity = self.calculate_severity(selected_symbols)
        attribution = self.calculate_attribution(selected_symbols)
        agency = self.calculate_agency(selected_symbols)
        
        # Step 3: é–å®š Facet
        dominant_facet = self.select_facet(selected_symbols)
        
        # Step 4: ç”Ÿæˆå…­è¦ªï¼ˆæ ¹æ“šå¦è±¡äº”è¡Œï¼‰
        six_kin = self.generate_six_kin(hexagram)
        
        # Step 5: é¸å–ç”¨ç¥
        yongshen = self.select_yongshen(theme, six_kin)
        
        # Step 6: ç”Ÿæˆè§£è®€
        narrative = self.generate_narrative(
            hexagram, yongshen, severity, attribution
        )
        
        return {
            "hexagram": hexagram,
            "severity": severity,
            "attribution": attribution,
            "agency": agency,
            "facet": dominant_facet,
            "six_kin": six_kin,
            "yongshen": yongshen,
            "narrative": narrative
        }
```

---

## ğŸŠ æœ€çµ‚æ•ˆæœ

### ä½¿ç”¨è€…é«”é©—

```
1. æˆ‘é¸äº†ã€Œäº‹æ¥­å‰ç¨‹ã€
2. æˆ‘åœ¨ç¬¦è™Ÿç›¤ä¸Šæ†‘ç›´è¦ºé»äº† 6 å€‹å­—ï¼šå›°ã€å…§ã€åš´ã€å£“ã€ç´¯ã€é€ƒ
3. ç³»çµ±é¡¯ç¤ºå¦è±¡ï¼šå±±æ°´è’™
4. ç³»çµ±èªªï¼šå®˜é¬¼ä¼‘å›šï¼Œäº‹æ¥­å—é˜»ï¼Œä½ æ„Ÿåˆ°å£“åŠ›å’Œç–²ç´¯...

â†’ ã€Œå¥½æº–ï¼å®Œå…¨ä¸åƒå¿ƒç†æ¸¬é©—ï¼é€™çœŸçš„æ˜¯å…­çˆ»ç´ç”²ï¼ã€
```

### ç³»çµ±é‹ç®—ï¼ˆéš±æ€§ï¼‰

```python
{
    "hexagram": "å±±æ°´è’™ï¼ˆâ˜¶â˜µï¼‰",
    "severity": 0.67,
    "attribution": "mixed (ç•¥åå¤–éƒ¨)",
    "agency": 0.83,
    "facet": "chronic_depletion",
    "six_kin": {1: "çˆ¶æ¯", 2: "å…„å¼Ÿ", 3: "å®˜é¬¼"...},
    "yongshen": "å®˜é¬¼ï¼ˆç¬¬ 3 çˆ»ï¼‰",
    "yongshen_strength": "weak"
}
```

### é—œéµé­”è¡“

- âœ… è¡¨å±¤ï¼šå®Œå…¨æ˜¯æ­£çµ±å…­çˆ»ç´ç”²ï¼ˆèµ·å¦ã€ç´ç”²ã€å…­è¦ªã€ç”¨ç¥ï¼‰
- âœ… åº•å±¤ï¼šå®Œå…¨æ˜¯ç¾ä»£ç§‘å­¸è¨ºæ–·ï¼ˆSeverity, Facet, Agencyï¼‰
- âœ… äº’å‹•ï¼šç¬¦è™Ÿç›¤å¤šé …é‡é¸æ“‡ï¼ˆç¥ç§˜ä¸”ç²¾æº–ï¼‰
- âœ… ä½¿ç”¨è€…ï¼šå®Œå…¨ç„¡æ„Ÿï¼ˆä¸çŸ¥é“è¢«è¨ºæ–·ï¼‰

---

## ğŸ“‹ éœ€è¦åŸ·è¡Œçš„ä»»å‹™åŒ…

### æ–°ä»»å‹™åŒ…ï¼ˆ3 å€‹ï¼‰

1. **NEW-TP1**ï¼šè¾­è±¡åº«è¨­è¨ˆï¼ˆ100 å€‹è¾­è±¡ Ã— 4 å±¬æ€§ï¼‰â±ï¸ 7-10 å¤©
2. **NEW-TP2**ï¼šç¬¦ç¢¼æ˜ å°„é‚è¼¯ï¼ˆç¬¦è™Ÿ â†’ å…­çˆ» + è¨ºæ–·ï¼‰â±ï¸ 5-7 å¤©
3. **NEW-TP3**ï¼šç¬¦è™Ÿç›¤äº’å‹•è¨­è¨ˆï¼ˆå‰ç«¯ UIï¼‰â±ï¸ 10-14 å¤©

### ä¿®æ”¹ä»»å‹™åŒ…ï¼ˆ2 å€‹ï¼‰

4. **INTEGRATION-2ï¼ˆä¿®è¨‚ç‰ˆï¼‰**ï¼šé‡å¯« STEP 6-9ï¼ˆå…­è¦ªã€ç”¨ç¥ã€è¨ˆç®—ï¼‰â±ï¸ 3-5 å¤©
5. **INTEGRATION-5ï¼ˆä¿®è¨‚ç‰ˆï¼‰**ï¼šèª¿æ•´ API èˆ‡å‰ç«¯é‚è¼¯â±ï¸ 5-7 å¤©

### ä¿ç•™ä»»å‹™åŒ…ï¼ˆ2 å€‹ï¼‰

6. **INTEGRATION-1**ï¼šå®Œå…¨ä¿ç•™ï¼ˆåº•å±¤å¼•æ“ï¼‰
7. **INTEGRATION-6**ï¼šå®Œå…¨ä¿ç•™ï¼ˆä¸Šç·šæª¢æŸ¥ï¼‰

---

## ğŸ¯ ç¸½æ™‚é–“ä¼°ç®—

**ä¸²è¡ŒåŸ·è¡Œ**ï¼š30-43 å¤©  
**ä¸¦è¡ŒåŸ·è¡Œ**ï¼š22-31 å¤©ï¼ˆNEW-TP1+TP2 å¯ä¸¦è¡Œï¼‰

---

**äº¤ä»˜æ—¥æœŸ**ï¼š2026-01-14  
**ä»»å‹™ç‹€æ…‹**ï¼šâœ… å®Œæ•´æ–¹æ¡ˆå·²è¨­è¨ˆ  
**ä¸‹ä¸€æ­¥**ï¼šå‘é¡§å•åœ˜éšŠç™¼å‡ºæ–°ä»»å‹™åŒ…
