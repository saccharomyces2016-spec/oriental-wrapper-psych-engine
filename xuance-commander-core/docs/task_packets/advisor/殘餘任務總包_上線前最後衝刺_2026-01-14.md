# 殘餘任務總包：上線前最後衝刺

**建立日期**：2026-01-14  
**任務類型**：整合性任務包  
**目的**：補齊系統缺口，準備上線  
**基於報告**：`系統全面審查報告_運算引擎完整度與上線準備度_2026-01-14.md`

---

## 🎯 任務總覽

根據系統全面審查，當前系統狀態：
- ✅ 架構 100% 完成
- ✅ V3 引擎 100% 完成
- ✅ 玄學元素 100% 正統
- ⚠️ 內容覆蓋率 60-70%
- ⚠️ 缺少 7-17 個 Facet
- ⚠️ 缺少 P2 系列優化

**距離上線差距**：⏱️ **7-14 天**（補充 Facet）+ 前端整合

---

## 📊 任務優先級分類

### 🔴 P0 任務：必須完成（上線前）

| 任務 | 內容 | 預估時間 | 狀態 |
|------|------|---------|------|
| **P0-4** | 補充 7 個核心 Facet | 7-10 天 | ⏳ 待執行 |
| **P0-5** | 前端整合準備 | 3-5 天 | ⏳ 待執行 |
| **P0-6** | API 整合測試 | 2-3 天 | ⏳ 待執行 |

**總計**：12-18 天

---

### 🟡 P1 任務：強烈建議（上線後優化）

| 任務 | 內容 | 預估時間 | 狀態 |
|------|------|---------|------|
| **P1-4** | 補充至 40 個 Facet | 7-14 天 | ⏸️ 可延後 |
| **P2-3** | 動態追問系統 | 14-21 天 | ⏸️ 可延後 |

**總計**：21-35 天

---

### 🟢 P2 任務：優化項目（長期擴展）

| 任務 | 內容 | 預估時間 | 狀態 |
|------|------|---------|------|
| **P2-1** | 年齡適應版本 | 14-21 天 | ⏸️ 可延後 |
| **P2-2** | 文化適應版本 | 21-28 天 | ⏸️ 可延後 |

**總計**：35-49 天

---

## 🔴 P0-4：補充 7 個核心 Facet

### 任務目標

**補充 Facet 至 30 個**，提升題目覆蓋率至 75-80%

### 背景說明

**當前狀態**：
- ✅ 已完成：23 個 Facet（P0-3 完成）
- ⚠️ 已建立但未編譯：7 個 Facet
- ⚠️ 題目覆蓋率：約 60%

**已建立但未編譯的 Facet**：
1. **emotional_permeability**（情緒滲透）- 坎/水
2. **avoidance_coping**（迴避應對）- 艮/山
3. **social_comparison**（社交比較）- 離/火
4. **lamp_oil_exhaustion**（燈油耗盡）- 乾/天
5. **void_drifting**（虛空漂流）- 巽/風
6. **resource_anxiety**（資源焦慮）- 坤/地  
   ⚠️ 需修正命名（anxiety 違規）
7. **creative_blockage**（創意阻塞）- 震/雷

---

### 交付物清單

#### 第一階段：編譯已有 Facet（5-7 天）

**任務 4.1：編譯 7 個 Facet 的完整檔案**

**每個 Facet 需要**：
1. `domain/questions/[facet_id].questions.v1.0.json`（8 題 OCTET_8）
2. `domain/facets/[facet_id].scoring.v1.0.json`（分數計算）
3. `domain/manifests/[facet_id].v1.0.json`（整合檔案）
4. `domain/recommendations/[facet_id].reco.v1.0.json`（解法建議）
5. `domain/narratives/[facet_id].narr.v1.0.json`（玄學敘事）
6. `domain/riskchains/[facet_id].risk.v1.0.json`（風險預測）

**總計**：7 × 6 = **42 個檔案**

---

#### 第二階段：驗證與編譯（2-3 天）

**任務 4.2：執行 compile_facets.sh**

**驗證項目**：
- ✅ JSON 格式正確
- ✅ L4 Safety 100% 合規
- ✅ OCTET_8 結構完整
- ✅ 五行映射正確
- ✅ 八卦領域正確

**編譯輸出**：
- `compiled/[facet_id].compiled.v1.0.json`

**總計**：7 個 compiled 檔案

---

### 詳細需求：7 個 Facet

#### Facet 1：emotional_permeability（情緒滲透）

**八卦領域**：坎（Kan）- 流動資源  
**五行失衡**：Water_Excessive（水過多）  
**核心描述**：
```
就像水無孔不入，你的內在界限過於鬆散，外界的氣場、情緒、
能量都會滲透進來，讓你分不清哪些是自己的，哪些是別人的。
```

**OCTET_8 題目範例**：
```
Q1 (核心)：你是否經常分不清「這是我的感受」還是「這是別人的感受」？
Q2 (核心)：當身邊的人情緒低落時，你是否也會跟著低落，即使那不是你的事？
Q3 (反應)：當你進入一個緊張的環境，你是否會立刻感到全身緊繃？
Q4 (反應)：你是否經常在人多的地方感到能量被抽乾？
Q5 (外顯)：你是否會刻意避開情緒濃烈的人或場合？
Q6 (外顯)：你是否經常需要獨處來「清空」自己？
Q7 (能動性)：當你感受到別人的情緒滲入時，你能否主動設立界限？
Q8 (能動性)：你是否覺得自己無法控制這種「被影響」的狀態？
```

**五行活動**：Exhaust_Water_to_Wood（水洩木）  
**卦象**：坎為水（習坎）  
**風險鏈**：情緒滲透 → 界限消失 → 能量耗竭 → 自我模糊

---

#### Facet 2：avoidance_coping（迴避應對）

**八卦領域**：艮（Gen）- 界限穩定  
**五行失衡**：Earth_Excessive（土過多，停滯）  
**核心描述**：
```
像山一樣靜止不動，你選擇「不面對」作為應對方式。
困難的事情推到明天，痛苦的感受壓到心底，
如同在山腳築起高牆，卻忘了山本身就是障礙。
```

**OCTET_8 題目範例**：
```
Q1 (核心)：當遇到困難的問題時，你是否傾向先放著、晾著、拖著？
Q2 (核心)：你是否經常用「忙」來逃避真正需要面對的事？
Q3 (反應)：當不得不面對時，你是否會感到極度不適或抗拒？
Q4 (反應)：你是否會用其他活動（追劇、遊戲、滑手機）來轉移注意力？
Q5 (外顯)：你是否經常「假裝問題不存在」？
Q6 (外顯)：你是否會刻意避開會讓你想起問題的人、事、物？
Q7 (能動性)：當你意識到自己在迴避時，你能否主動面對？
Q8 (能動性)：你是否覺得「迴避是唯一的辦法」？
```

**五行活動**：Overcome_Wood_to_Earth（木剋土，打破停滯）  
**卦象**：艮為山（艮卦）  
**風險鏈**：迴避應對 → 問題累積 → 爆發危機 → 全面崩潰

---

#### Facet 3：social_comparison（社交比較）

**八卦領域**：離（Li）- 表達展現  
**五行失衡**：Fire_Excessive（火過旺，外耗）  
**核心描述**：
```
你的火氣不是向內燃燒，而是向外照射，
不斷與他人比較、競爭、攀比。
如同火焰必須有燃料才能持續，
你的自我價值感也必須從「勝過他人」中獲得。
```

**OCTET_8 題目範例**：
```
Q1 (核心)：你是否經常拿自己跟別人比較（外貌、成就、生活）？
Q2 (核心)：當看到別人過得比你好時，你是否會感到不舒服？
Q3 (反應)：你是否會因為「比不上別人」而感到失落？
Q4 (反應)：你是否會刻意展現自己的成就來證明「我不差」？
Q5 (外顯)：你是否會迴避那些「比你優秀」的人？
Q6 (外顯)：你是否經常關注社交媒體上別人的生活？
Q7 (能動性)：當你發現自己在比較時，你能否停止這個念頭？
Q8 (能動性)：你是否覺得「不比較就無法知道自己的價值」？
```

**五行活動**：Exhaust_Fire_to_Earth（火洩土，收斂外耗）  
**卦象**：離為火（離卦）  
**風險鏈**：社交比較 → 自我貶低 → 能量外耗 → 永不滿足

---

#### Facet 4：lamp_oil_exhaustion（燈油耗盡）

**八卦領域**：乾（Qian）- 主導創始  
**五行失衡**：Fire_Low（火不足，燈油乾）  
**核心描述**：
```
如同燈油將盡的油燈，你的內在火焰越來越微弱。
不是沒有意志，而是燃料已經耗盡，
即使想要行動，也只是微弱的閃爍，隨時可能熄滅。
```

**OCTET_8 題目範例**：
```
Q1 (核心)：你是否感到「內在的火焰快要熄滅了」？
Q2 (核心)：你是否覺得自己「再也燃不起來了」？
Q3 (反應)：當面對需要衝勁的事情時，你是否只能勉強應付？
Q4 (反應)：你是否經常感到「只想躺著，什麼都不做」？
Q5 (外顯)：你是否已經放棄了很多原本重要的目標？
Q6 (外顯)：你是否經常「開始了但無法持續」？
Q7 (能動性)：當你想要重新點燃時，你能否找到燃料？
Q8 (能動性)：你是否覺得「已經回不去了」？
```

**五行活動**：Generate_Wood_to_Fire（木生火，重新點燃）  
**卦象**：乾卦（潛龍勿用）  
**風險鏈**：燈油耗盡 → 意志消失 → 全面停擺 → 難以恢復

---

#### Facet 5：void_drifting（虛空漂流）

**八卦領域**：巽（Xun）- 關係溝通  
**五行失衡**：Wood_Low（木不足，失去方向）  
**核心描述**：
```
如同風中的浮萍，你失去了根，失去了方向，
在虛空中漂流。不是沒有移動，而是不知道往哪裡移動，
所有的努力都像是風吹過，留不下痕跡。
```

**OCTET_8 題目範例**：
```
Q1 (核心)：你是否經常感到「不知道自己在做什麼」？
Q2 (核心)：你是否覺得「人生沒有方向，只是隨波逐流」？
Q3 (反應)：當別人問你「你想要什麼」時，你是否答不出來？
Q4 (反應)：你是否經常做事只是「因為該做」而非「因為想做」？
Q5 (外顯)：你是否經常換目標、換方向，卻從未真正投入？
Q6 (外顯)：你是否覺得「做什麼都一樣」？
Q7 (能動性)：當你想要找到方向時，你能否主動探索？
Q8 (能動性)：你是否覺得「找不到方向是註定的」？
```

**五行活動**：Generate_Water_to_Wood（水生木，培養根基）  
**卦象**：巽為風（巽卦）  
**風險鏈**：虛空漂流 → 失去意義 → 存在虛無 → 自我消散

---

#### Facet 6：resource_scarcity_mode（資源匱乏模式）

**⚠️ 原名 resource_anxiety 違規，已修正**

**八卦領域**：坤（Kun）- 承載滋養  
**五行失衡**：Earth_Low（土不足，失去滋養）  
**核心描述**：
```
如同乾涸的土地，你的內在感到匱乏，
無論擁有多少，都覺得「不夠」。
這不是貪婪，而是深層的不安全感，
讓你不斷囤積、抓取、守護，卻依然感到空虛。
```

**OCTET_8 題目範例**：
```
Q1 (核心)：你是否經常擔心「資源不夠」（時間、金錢、能量）？
Q2 (核心)：你是否覺得「再多也不夠，隨時可能用完」？
Q3 (反應)：當需要付出資源時，你是否會感到極度不安？
Q4 (反應)：你是否經常計算、比較、擔心「划不划算」？
Q5 (外顯)：你是否會囤積東西，即使用不到也不願丟棄？
Q6 (外顯)：你是否會刻意節省，即使沒有必要？
Q7 (能動性)：當你意識到這種匱乏感時，你能否放鬆？
Q8 (能動性)：你是否覺得「不這樣就會失去一切」？
```

**五行活動**：Generate_Fire_to_Earth（火生土，滋養內在）  
**卦象**：坤為地（坤卦）  
**風險鏈**：匱乏模式 → 過度囤積 → 能量阻塞 → 無法流動

---

#### Facet 7：creative_blockage（創意阻塞）

**八卦領域**：震（Zhen）- 行動決策  
**五行失衡**：Wood_Low（木不足，失去生發）  
**核心描述**：
```
如同春天卻不發芽的種子，你的創意被阻塞了。
不是沒有想法，而是想法無法流動、無法成形，
就像被困在土裡的種子，用盡力氣也破不了土。
```

**OCTET_8 題目範例**：
```
Q1 (核心)：你是否經常感到「想法卡住了，無法繼續」？
Q2 (核心)：你是否覺得「靈感枯竭，腦袋一片空白」？
Q3 (反應)：當需要創意時，你是否會感到極度挫折？
Q4 (反應)：你是否會因為「想不出來」而自我懷疑？
Q5 (外顯)：你是否會一直重複同樣的方法，即使無效？
Q6 (外顯)：你是否會迴避需要創意的任務？
Q7 (能動性)：當你感到阻塞時，你能否主動尋找突破？
Q8 (能動性)：你是否覺得「創意是天生的，我就是沒有」？
```

**五行活動**：Generate_Water_to_Wood（水生木，滋潤根基）  
**卦象**：震為雷（震卦）  
**風險鏈**：創意阻塞 → 自我懷疑 → 放棄創造 → 內在枯竭

---

### 交付標準

#### 必須達成

1. ✅ 所有 JSON 格式正確
2. ✅ 100% L4 Safety 合規（0% 心理學/醫療詞彙）
3. ✅ OCTET_8 結構完整（2+2+2+2）
4. ✅ 五行映射正確（基於失衡類型）
5. ✅ 八卦領域正確（基於困擾類型）
6. ✅ 中英雙語完整

#### 品質標準

1. ✅ 題目具有區辨度（能有效區分不同 Severity）
2. ✅ 玄學敘事深刻（不俗套、不雞湯）
3. ✅ 解法可執行（10-30 分鐘，具體步驟）
4. ✅ 風險預測合理（2-3 stage，邏輯連貫）

---

## 🔴 P0-5：前端整合準備

### 任務目標

**準備系統與前端整合所需的介面與文檔**

### 交付物

#### 交付物 5.1：API 規格文檔（1 天）

**檔案**：`docs/integration/api_specification.v1.0.md`

**內容**：
1. **Endpoint 定義**
   ```
   POST /api/v1/diagnose
   - 輸入：answers (array)
   - 輸出：diagnosis_result (json)
   ```

2. **請求格式**
   ```json
   {
     "primary_domain": "Kan",
     "facet_id": "chronic_depletion",
     "answers": [3, 4, 2, 3, 3, 2, 1, 2],
     "context": {
       "age_group": "adult",
       "language": "zh"
     }
   }
   ```

3. **回應格式**
   ```json
   {
     "severity": 0.70,
     "rigidity_state": "Locked",
     "agency_score": 0.625,
     "safety_mode": "L3",
     "hexagram": {
       "id": "hexagram_29_kan",
       "narrative": "坎，習坎。水流不息，卻困於深淵...",
       "action_guidance": "...",
       "expected_state": "..."
     },
     "recommendation": {
       "activity": "靜心整理",
       "steps": [...],
       "duration": "15 分鐘"
     },
     "riskchain": {
       "short_chain": [...],
       "long_chain": [...]
     }
   }
   ```

---

#### 交付物 5.2：前端整合範例（2 天）

**檔案**：`examples/frontend_integration/`

**內容**：
1. `example_request.js`（請求範例）
2. `example_response.json`（回應範例）
3. `integration_guide.md`（整合指南）

---

#### 交付物 5.3：錯誤處理規範（1 天）

**檔案**：`docs/integration/error_handling.v1.0.md`

**內容**：
1. **錯誤代碼定義**
   ```
   400: Invalid Request（無效請求）
   404: Facet Not Found（Facet 不存在）
   500: Engine Error（引擎錯誤）
   ```

2. **錯誤回應格式**
   ```json
   {
     "error": true,
     "code": 400,
     "message": "Invalid answers format",
     "details": "Answers must be array of 8 integers (0-4)"
   }
   ```

---

## 🔴 P0-6：API 整合測試

### 任務目標

**測試 OpenAI API 整合，驗證 AI 潤飾方案可行性**

### 交付物

#### 交付物 6.1：AI 潤飾腳本（1 天）

**檔案**：`tools/ai_narrative_polish.py`

**功能**：
```python
def polish_narrative(diagnosis_result, api_key):
    """
    使用 OpenAI API 潤飾診斷敘事
    
    輸入：diagnosis_result (dict)
    輸出：polished_narrative (str)
    """
    prompt = generate_prompt(diagnosis_result)
    response = call_openai_api(prompt, api_key)
    return response
```

---

#### 交付物 6.2：Prompt 範例庫（1 天）

**檔案**：`prompts/narrative_polish_prompts.v1.0.json`

**內容**：
```json
{
  "diagnostic_insight": {
    "system_prompt": "你是東方玄學大師，精通易經、五行...",
    "user_prompt_template": "請根據以下診斷結果生成診斷洞察（150-200 字）...",
    "constraints": [
      "100% 玄學語境",
      "禁止心理學詞彙",
      "使用隱喻和情境描述"
    ]
  }
}
```

---

#### 交付物 6.3：測試報告（1 天）

**檔案**：`tests/ai_integration_test_report.md`

**內容**：
1. 測試 10 個不同 Facet 的 AI 潤飾結果
2. L4 Safety 合規性驗證
3. 敘事品質評估
4. 成本分析（API 費用）

---

## 📊 交付物總覽

### P0 任務（必須完成）

| 任務 | 交付物數量 | 預估時間 | 優先級 |
|------|-----------|---------|--------|
| P0-4 | 42 個 JSON + 7 個 compiled | 7-10 天 | 🔴 Critical |
| P0-5 | 3 個文檔 | 3-5 天 | 🔴 Critical |
| P0-6 | 3 個檔案 + 測試報告 | 2-3 天 | 🔴 Critical |
| **總計** | **55 個檔案** | **12-18 天** | - |

---

## 📋 執行建議

### 階段 1：補充 Facet（7-10 天）

**優先順序**：
1. emotional_permeability（情緒滲透）- 最常見
2. avoidance_coping（迴避應對）- 最常見
3. resource_scarcity_mode（資源匱乏）- 最常見
4. lamp_oil_exhaustion（燈油耗盡）- 高嚴重度
5. social_comparison（社交比較）- 中嚴重度
6. void_drifting（虛空漂流）- 中嚴重度
7. creative_blockage（創意阻塞）- 特定領域

---

### 階段 2：前端整合準備（3-5 天）

**並行執行**：
- 可與階段 1 並行
- 由不同團隊執行

---

### 階段 3：API 整合測試（2-3 天）

**依賴階段 2 完成**

---

## 🎯 成功指標

### 量化指標

- ✅ Facet 數量：23 → 30 個
- ✅ 題目覆蓋率：60% → 75-80%
- ✅ 編譯檔案：23 → 30 個
- ✅ API 文檔：完整
- ✅ AI 整合：測試通過

### 質化指標

- ✅ 題目品質：維持 A+ 水準
- ✅ 玄學語境：100% 合規
- ✅ 系統可靠性：90%+ 準確度
- ✅ 前端整合：文檔清晰

---

## 🚀 下一步建議

### 立即執行（本週）

1. ✅ **開始 P0-4**（補充 7 個 Facet）
2. ✅ **開始 P0-5**（前端整合準備，並行執行）

### 下週執行

3. ✅ **執行 P0-6**（API 整合測試）
4. ✅ **準備上線測試版本**

### 後續優化（上線後）

5. ⏸️ **P1-4**（補充至 40 個 Facet）
6. ⏸️ **P2-3**（動態追問系統）
7. ⏸️ **P2-1**（年齡適應）
8. ⏸️ **P2-2**（文化適應）

---

**建立日期**：2026-01-14  
**任務包版本**：v1.0  
**狀態**：✅ 準備執行  
**預計完成時間**：12-18 天後可上線測試版本
